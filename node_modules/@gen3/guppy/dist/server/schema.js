"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.getTypesSchemas = exports.getQuerySchema = exports.getMappingSchema = exports.getHistogramSchemas = exports.getAggregationSchemaForEachType = exports.getAggregationSchemaForEachNestedType = exports.getAggregationSchema = exports.default = exports.buildSchemaString = void 0;var _logger = _interopRequireDefault(require("./logger"));
var _utils = require("./utils/utils");function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}

const esgqlTypeMapping = {
  text: 'String',
  keyword: 'String',
  integer: 'Int',
  long: 'Float',
  short: 'Int',
  byte: 'Int',
  double: 'Float',
  float: 'Float',
  half_float: 'Float',
  scaled_float: 'Float',
  array: 'Object',
  nested: 'Object'
};

const histogramTypePrefix = 'RegularAccess';

const getGQLType = (esInstance, esIndex, field, esFieldType) => {
  const gqlType = esgqlTypeMapping[esFieldType];
  if (!gqlType) {
    throw new Error(`Invalid type ${esFieldType} for field ${field} in index ${esIndex}`);
  }
  const isArrayField = esInstance.isArrayField(esIndex, field);
  if (isArrayField && esFieldType !== 'nested') {
    return `[${gqlType}]`;
  }
  if (esFieldType === 'nested') {
    if (isArrayField) {
      return `[${field}]`;
    }
    return `${field}`;
  }
  return gqlType;
};

const EnumAggsHistogramName = {
  HISTOGRAM_FOR_STRING: 'HistogramForString',
  HISTOGRAM_FOR_NUMBER: 'HistogramForNumber'
};
const gqlTypeToAggsHistogramName = {
  String: EnumAggsHistogramName.HISTOGRAM_FOR_STRING,
  Int: EnumAggsHistogramName.HISTOGRAM_FOR_NUMBER,
  Float: EnumAggsHistogramName.HISTOGRAM_FOR_NUMBER,
  '[String]': EnumAggsHistogramName.HISTOGRAM_FOR_STRING,
  '[Int]': EnumAggsHistogramName.HISTOGRAM_FOR_NUMBER,
  '[Float]': EnumAggsHistogramName.HISTOGRAM_FOR_NUMBER
};

const getAggsHistogramName = (gqlType) => {
  if (!gqlTypeToAggsHistogramName[gqlType]) {
    throw new Error(`Invalid elasticsearch type ${gqlType}`);
  }
  return gqlTypeToAggsHistogramName[gqlType];
};

const getQuerySchemaForType = (esType) => {
  const esTypeObjName = (0, _utils.firstLetterUpperCase)(esType);
  return `${esType} (
    offset: Int,
    first: Int,
    filter: JSON,
    sort: JSON,
    accessibility: Accessibility=all,
    format: Format=json,
    ): [${esTypeObjName}]`;
};

const getFieldGQLTypeMapForProperties = (esInstance, esIndex, properties) => {
  const result = Object.keys(properties).map((field) => {
    const esFieldType = properties[field].esType ?
    properties[field].esType : properties[field].type;
    const gqlType = getGQLType(esInstance, esIndex, field, esFieldType);

    return {
      field, type: gqlType, esType: esFieldType, properties: properties[field].properties
    };
  });
  return result;
};

const getFieldGQLTypeMapForOneIndex = (esInstance, esIndex) => {
  const fieldESTypeMap = esInstance.getESFieldTypeMappingByIndex(esIndex);
  return getFieldGQLTypeMapForProperties(esInstance, esIndex, fieldESTypeMap);
};

const getArgsByField = (fieldType, props) => {
  const keys = Object.keys(props);
  const baseProps = [];
  keys.forEach((k) => {
    if (props[k].type !== 'nested') baseProps.push({ field: k, type: esgqlTypeMapping[props[k].type] });
  });
  return `(${baseProps.map((entry) => `${entry.field}: [${entry.type}]`).join(',')})`;
};

const getSchemaType = (fieldType) => `${fieldType.field}: ${fieldType.type}`;

const getTypeSchemaForOneIndex = (esInstance, esIndex, esType) => {
  const fieldGQLTypeMap = getFieldGQLTypeMapForOneIndex(esInstance, esIndex);
  const fieldESTypeMap = esInstance.getESFieldTypeMappingByIndex(esIndex);
  const esTypeObjName = (0, _utils.firstLetterUpperCase)(esType);
  const existingFields = new Set([]);
  const fieldToArgs = {};

  const queueTypes = [];
  Object.keys(fieldESTypeMap).forEach((fieldKey) => {
    const esFieldType = fieldESTypeMap[fieldKey].type;
    if (esFieldType === 'nested' && !existingFields.has(fieldKey)) {
      const { properties } = fieldESTypeMap[fieldKey];
      queueTypes.push({ type: `${fieldKey}`, properties });
      existingFields.add(fieldKey);
    }
  });

  let sTypeSchema = `
    type ${esTypeObjName} {
      ${fieldGQLTypeMap.map((entry) => `${getSchemaType(entry)},`).join('\n')}
      _matched: [MatchedItem]
    }
  `;

  while (queueTypes.length > 0) {
    const t = queueTypes.shift();
    const gqlTypes = getFieldGQLTypeMapForProperties(esInstance, esIndex, t.properties);
    gqlTypes.forEach((entry) => {
      if (entry.esType === 'nested' && !existingFields.has(entry.field)) {
        queueTypes.push({ type: `${entry.field}`, properties: entry.properties });
        existingFields.add(entry.field);
        fieldToArgs[entry.field] = getArgsByField(entry.field, entry.properties);
      }
    });
    sTypeSchema += `
      type ${t.type} {
        ${gqlTypes.map((entry) => `${getSchemaType(entry)},`).join('\n')}
      }
    `;
  }
  return sTypeSchema;
};

const getAggregationType = (entry) => {
  if (entry.aggType !== '') {
    return `${entry.field}: ${entry.aggType},`;
  }
  return '';
};

const getAggregationSchemaForOneIndex = (esInstance, esConfigElement) => {
  const esIndex = esConfigElement.index;
  const esType = esConfigElement.type;
  const includeHistogramPrefix = Object.prototype.hasOwnProperty.call(esConfigElement, 'tier_access_level') && esConfigElement.tier_access_level === 'regular';
  const esTypeObjName = (0, _utils.firstLetterUpperCase)(esType);
  const fieldGQLTypeMap = getFieldGQLTypeMapForOneIndex(esInstance, esIndex);
  const fieldAggsTypeMap = fieldGQLTypeMap.filter((f) => f.esType !== 'nested').map((entry) => ({
    field: entry.field,
    aggType: (includeHistogramPrefix ? histogramTypePrefix : '') + getAggsHistogramName(entry.type)
  }));
  const fieldAggsNestedTypeMap = fieldGQLTypeMap.filter((f) => f.esType === 'nested');
  return `type ${esTypeObjName}Aggregation {
    _totalCount: Int,
    ${fieldAggsTypeMap.map((entry) => `${getAggregationType(entry)}`).join('\n')}
    ${fieldAggsNestedTypeMap.map((entry) => `${entry.field}: NestedHistogramFor${(0, _utils.firstLetterUpperCase)(entry.field)}`).join('\n')}
  }`;
};

const getQuerySchema = (esConfig) => `
    type Query {
      ${esConfig.indices.map((cfg) => getQuerySchemaForType(cfg.type)).join('\n')}
      _aggregation: Aggregation
      _mapping: Mapping
    }
  `;exports.getQuerySchema = getQuerySchema;

const getTypesSchemas = (esConfig, esInstance) => esConfig.indices.map((cfg) => getTypeSchemaForOneIndex(esInstance, cfg.index, cfg.type)).join('\n');exports.getTypesSchemas = getTypesSchemas;

const getAggregationSchema = (esConfig) => `
    type Aggregation {
      ${esConfig.indices.map((cfg) => `${cfg.type} (
        filter: JSON,
        filterSelf: Boolean=true,
        nestedAggFields: JSON,
        """Only used when it's regular level data commons, if set, returns aggregation data within given accessibility"""
        accessibility: Accessibility=all
      ): ${(0, _utils.firstLetterUpperCase)(cfg.type)}Aggregation`).join('\n')}
    }
  `;

/**
 * This is the function for getting schemas for a single nested index.
 * Multi-level nested fields are "flattened" level by level.
 * For each level of nested field a new type in schema is created.
 */exports.getAggregationSchema = getAggregationSchema;
const getAggregationSchemaForOneNestedIndex = (esInstance, esDict) => {
  const esIndex = esDict.index;
  const fieldGQLTypeMap = getFieldGQLTypeMapForOneIndex(esInstance, esIndex);
  const fieldAggsNestedTypeMap = fieldGQLTypeMap.filter((f) => f.esType === 'nested');
  const includeHistogramPrefix = Object.prototype.hasOwnProperty.call(esDict, 'tier_access_level') && esDict.tier_access_level === 'regular';
  let AggsNestedTypeSchema = '';
  while (fieldAggsNestedTypeMap.length > 0) {
    const entry = fieldAggsNestedTypeMap.shift();
    if (entry.field && entry.properties) {
      AggsNestedTypeSchema += `type NestedHistogramFor${(0, _utils.firstLetterUpperCase)(entry.field)} {${Object.keys(entry.properties).map((propsKey) => {
        const entryType = entry.properties[propsKey].type;
        if (entryType === 'nested') {
          fieldAggsNestedTypeMap.push({
            field: propsKey,
            properties: entry.properties[propsKey].properties
          });
          return `
      ${propsKey}: NestedHistogramFor${(0, _utils.firstLetterUpperCase)(propsKey)}`;
        }
        return `
    ${propsKey}: ${(includeHistogramPrefix ? histogramTypePrefix : '') + getAggsHistogramName(esgqlTypeMapping[entryType])}`;
      })}
}`;
    }
  }
  _logger.default.debug('[SCHEMA] AggsNestedTypeSchema: ', AggsNestedTypeSchema);
  return AggsNestedTypeSchema;
};

const getAggregationSchemaForEachType = (esConfig, esInstance) => esConfig.indices.map((cfg) => getAggregationSchemaForOneIndex(esInstance, cfg)).join('\n');exports.getAggregationSchemaForEachType = getAggregationSchemaForEachType;

const getAggregationSchemaForEachNestedType = (esConfig, esInstance) => esConfig.indices.map((cfg) => getAggregationSchemaForOneNestedIndex(esInstance, cfg)).join('\n');exports.getAggregationSchemaForEachNestedType = getAggregationSchemaForEachNestedType;

const getNumberHistogramSchema = (isRegularAccess) => `
    type ${(isRegularAccess ? histogramTypePrefix : '') + EnumAggsHistogramName.HISTOGRAM_FOR_NUMBER} {
      _totalCount: Int,
      _cardinalityCount(precision_threshold: Int = 3000): Int,
      histogram(
        rangeStart: Int,
        rangeEnd: Int,
        rangeStep: Int,
        binCount: Int,
      ): [BucketsForNestedNumberAgg],
      asTextHistogram: [BucketsForNestedStringAgg]
    }
  `;

const getTextHistogramSchema = (isRegularAccess) => `
    type ${(isRegularAccess ? histogramTypePrefix : '') + EnumAggsHistogramName.HISTOGRAM_FOR_STRING} {
      _totalCount: Int,
      _cardinalityCount(precision_threshold: Int = 3000): Int,
      histogram: [BucketsForNestedStringAgg],
      asTextHistogram: [BucketsForNestedStringAgg]
    }
  `;

const getMappingSchema = (esConfig) => `
    type Mapping {
      ${esConfig.indices.map((cfg) => `${cfg.type} (
        searchInput: String
      ): [String]`).join('\n')}
    }
  `;exports.getMappingSchema = getMappingSchema;

const getHistogramSchemas = () => {
  const textHistogramSchema = getTextHistogramSchema(false);

  const regularAccessTextHistogramSchema = getTextHistogramSchema(true);

  const numberHistogramSchema = getNumberHistogramSchema(false);

  const regularAccessNumberHistogramSchema = getNumberHistogramSchema(true);

  const histogramSchemas = [textHistogramSchema, regularAccessTextHistogramSchema, numberHistogramSchema, regularAccessNumberHistogramSchema].join('\n');

  return histogramSchemas;
};exports.getHistogramSchemas = getHistogramSchemas;

const buildSchemaString = (esConfig, esInstance) => {
  const querySchema = getQuerySchema(esConfig);

  const matchedItemSchema = `
    type MatchedItem {
      field: String
      highlights: [String]
    }
  `;

  const typesSchemas = getTypesSchemas(esConfig, esInstance);

  const accessibilityEnum = `
    enum Accessibility {
      all
      accessible
      unaccessible
    }
  `;

  const formatEnum = `
    enum Format {
      json
      tsv
      csv
    }
  `;

  const aggregationSchema = getAggregationSchema(esConfig);

  const aggregationSchemasForEachType = getAggregationSchemaForEachType(esConfig, esInstance);

  const aggregationSchemasForEachNestedType = getAggregationSchemaForEachNestedType(
    esConfig,
    esInstance
  );

  const histogramSchemas = getHistogramSchemas();

  const textHistogramBucketSchema = `
    type BucketsForNestedStringAgg {
      key: String
      count: Int
      missingFields: [BucketsForNestedMissingFields]
      termsFields: [BucketsForNestedTermsFields]
    }
  `;

  const numberHistogramBucketSchema = `
    type BucketsForNestedNumberAgg {
      """Lower and higher bounds for this bucket"""
      key: [Float]
      min: Float
      max: Float
      avg: Float
      sum: Float
      count: Int
      missingFields: [BucketsForNestedMissingFields]
      termsFields: [BucketsForNestedTermsFields]
    }
  `;

  const nestedMissingFieldsBucketSchema = `
    type BucketsForNestedMissingFields {
      field: String
      count: Int
    }
  `;

  const nestedTermsFieldsBucketSchema = `
    type BucketsForNestedTermsFields {
      field: String
      count: Int
      terms: [BucketsForString]
    }
  `;

  const stringBucketSchema = `
    type BucketsForString {
      key: String
      count: Int
    }
  `;

  const mappingSchema = getMappingSchema(esConfig);

  const schemaStr = `
  scalar JSON
  ${matchedItemSchema}
  ${querySchema}
  ${accessibilityEnum}
  ${formatEnum}
  ${typesSchemas}
  ${aggregationSchema}
  ${aggregationSchemasForEachType}
  ${aggregationSchemasForEachNestedType}
  ${histogramSchemas}
  ${textHistogramBucketSchema}
  ${nestedMissingFieldsBucketSchema}
  ${nestedTermsFieldsBucketSchema}
  ${stringBucketSchema}
  ${numberHistogramBucketSchema}
  ${mappingSchema}
`;
  _logger.default.info('[schema] graphql schema generated.');
  _logger.default.info('[schema] graphql schema', schemaStr);
  return schemaStr;
};exports.buildSchemaString = buildSchemaString;var _default = exports.default =

buildSchemaString;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9nZ2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfdXRpbHMiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJlc2dxbFR5cGVNYXBwaW5nIiwidGV4dCIsImtleXdvcmQiLCJpbnRlZ2VyIiwibG9uZyIsInNob3J0IiwiYnl0ZSIsImRvdWJsZSIsImZsb2F0IiwiaGFsZl9mbG9hdCIsInNjYWxlZF9mbG9hdCIsImFycmF5IiwibmVzdGVkIiwiaGlzdG9ncmFtVHlwZVByZWZpeCIsImdldEdRTFR5cGUiLCJlc0luc3RhbmNlIiwiZXNJbmRleCIsImZpZWxkIiwiZXNGaWVsZFR5cGUiLCJncWxUeXBlIiwiRXJyb3IiLCJpc0FycmF5RmllbGQiLCJFbnVtQWdnc0hpc3RvZ3JhbU5hbWUiLCJISVNUT0dSQU1fRk9SX1NUUklORyIsIkhJU1RPR1JBTV9GT1JfTlVNQkVSIiwiZ3FsVHlwZVRvQWdnc0hpc3RvZ3JhbU5hbWUiLCJTdHJpbmciLCJJbnQiLCJGbG9hdCIsImdldEFnZ3NIaXN0b2dyYW1OYW1lIiwiZ2V0UXVlcnlTY2hlbWFGb3JUeXBlIiwiZXNUeXBlIiwiZXNUeXBlT2JqTmFtZSIsImZpcnN0TGV0dGVyVXBwZXJDYXNlIiwiZ2V0RmllbGRHUUxUeXBlTWFwRm9yUHJvcGVydGllcyIsInByb3BlcnRpZXMiLCJyZXN1bHQiLCJPYmplY3QiLCJrZXlzIiwibWFwIiwidHlwZSIsImdldEZpZWxkR1FMVHlwZU1hcEZvck9uZUluZGV4IiwiZmllbGRFU1R5cGVNYXAiLCJnZXRFU0ZpZWxkVHlwZU1hcHBpbmdCeUluZGV4IiwiZ2V0QXJnc0J5RmllbGQiLCJmaWVsZFR5cGUiLCJwcm9wcyIsImJhc2VQcm9wcyIsImZvckVhY2giLCJrIiwicHVzaCIsImVudHJ5Iiwiam9pbiIsImdldFNjaGVtYVR5cGUiLCJnZXRUeXBlU2NoZW1hRm9yT25lSW5kZXgiLCJmaWVsZEdRTFR5cGVNYXAiLCJleGlzdGluZ0ZpZWxkcyIsIlNldCIsImZpZWxkVG9BcmdzIiwicXVldWVUeXBlcyIsImZpZWxkS2V5IiwiaGFzIiwiYWRkIiwic1R5cGVTY2hlbWEiLCJsZW5ndGgiLCJ0Iiwic2hpZnQiLCJncWxUeXBlcyIsImdldEFnZ3JlZ2F0aW9uVHlwZSIsImFnZ1R5cGUiLCJnZXRBZ2dyZWdhdGlvblNjaGVtYUZvck9uZUluZGV4IiwiZXNDb25maWdFbGVtZW50IiwiaW5kZXgiLCJpbmNsdWRlSGlzdG9ncmFtUHJlZml4IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwidGllcl9hY2Nlc3NfbGV2ZWwiLCJmaWVsZEFnZ3NUeXBlTWFwIiwiZmlsdGVyIiwiZiIsImZpZWxkQWdnc05lc3RlZFR5cGVNYXAiLCJnZXRRdWVyeVNjaGVtYSIsImVzQ29uZmlnIiwiaW5kaWNlcyIsImNmZyIsImV4cG9ydHMiLCJnZXRUeXBlc1NjaGVtYXMiLCJnZXRBZ2dyZWdhdGlvblNjaGVtYSIsImdldEFnZ3JlZ2F0aW9uU2NoZW1hRm9yT25lTmVzdGVkSW5kZXgiLCJlc0RpY3QiLCJBZ2dzTmVzdGVkVHlwZVNjaGVtYSIsInByb3BzS2V5IiwiZW50cnlUeXBlIiwibG9nIiwiZGVidWciLCJnZXRBZ2dyZWdhdGlvblNjaGVtYUZvckVhY2hUeXBlIiwiZ2V0QWdncmVnYXRpb25TY2hlbWFGb3JFYWNoTmVzdGVkVHlwZSIsImdldE51bWJlckhpc3RvZ3JhbVNjaGVtYSIsImlzUmVndWxhckFjY2VzcyIsImdldFRleHRIaXN0b2dyYW1TY2hlbWEiLCJnZXRNYXBwaW5nU2NoZW1hIiwiZ2V0SGlzdG9ncmFtU2NoZW1hcyIsInRleHRIaXN0b2dyYW1TY2hlbWEiLCJyZWd1bGFyQWNjZXNzVGV4dEhpc3RvZ3JhbVNjaGVtYSIsIm51bWJlckhpc3RvZ3JhbVNjaGVtYSIsInJlZ3VsYXJBY2Nlc3NOdW1iZXJIaXN0b2dyYW1TY2hlbWEiLCJoaXN0b2dyYW1TY2hlbWFzIiwiYnVpbGRTY2hlbWFTdHJpbmciLCJxdWVyeVNjaGVtYSIsIm1hdGNoZWRJdGVtU2NoZW1hIiwidHlwZXNTY2hlbWFzIiwiYWNjZXNzaWJpbGl0eUVudW0iLCJmb3JtYXRFbnVtIiwiYWdncmVnYXRpb25TY2hlbWEiLCJhZ2dyZWdhdGlvblNjaGVtYXNGb3JFYWNoVHlwZSIsImFnZ3JlZ2F0aW9uU2NoZW1hc0ZvckVhY2hOZXN0ZWRUeXBlIiwidGV4dEhpc3RvZ3JhbUJ1Y2tldFNjaGVtYSIsIm51bWJlckhpc3RvZ3JhbUJ1Y2tldFNjaGVtYSIsIm5lc3RlZE1pc3NpbmdGaWVsZHNCdWNrZXRTY2hlbWEiLCJuZXN0ZWRUZXJtc0ZpZWxkc0J1Y2tldFNjaGVtYSIsInN0cmluZ0J1Y2tldFNjaGVtYSIsIm1hcHBpbmdTY2hlbWEiLCJzY2hlbWFTdHIiLCJpbmZvIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VydmVyL3NjaGVtYS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGZpcnN0TGV0dGVyVXBwZXJDYXNlIH0gZnJvbSAnLi91dGlscy91dGlscyc7XG5cbmNvbnN0IGVzZ3FsVHlwZU1hcHBpbmcgPSB7XG4gIHRleHQ6ICdTdHJpbmcnLFxuICBrZXl3b3JkOiAnU3RyaW5nJyxcbiAgaW50ZWdlcjogJ0ludCcsXG4gIGxvbmc6ICdGbG9hdCcsXG4gIHNob3J0OiAnSW50JyxcbiAgYnl0ZTogJ0ludCcsXG4gIGRvdWJsZTogJ0Zsb2F0JyxcbiAgZmxvYXQ6ICdGbG9hdCcsXG4gIGhhbGZfZmxvYXQ6ICdGbG9hdCcsXG4gIHNjYWxlZF9mbG9hdDogJ0Zsb2F0JyxcbiAgYXJyYXk6ICdPYmplY3QnLFxuICBuZXN0ZWQ6ICdPYmplY3QnLFxufTtcblxuY29uc3QgaGlzdG9ncmFtVHlwZVByZWZpeCA9ICdSZWd1bGFyQWNjZXNzJztcblxuY29uc3QgZ2V0R1FMVHlwZSA9IChlc0luc3RhbmNlLCBlc0luZGV4LCBmaWVsZCwgZXNGaWVsZFR5cGUpID0+IHtcbiAgY29uc3QgZ3FsVHlwZSA9IGVzZ3FsVHlwZU1hcHBpbmdbZXNGaWVsZFR5cGVdO1xuICBpZiAoIWdxbFR5cGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdHlwZSAke2VzRmllbGRUeXBlfSBmb3IgZmllbGQgJHtmaWVsZH0gaW4gaW5kZXggJHtlc0luZGV4fWApO1xuICB9XG4gIGNvbnN0IGlzQXJyYXlGaWVsZCA9IGVzSW5zdGFuY2UuaXNBcnJheUZpZWxkKGVzSW5kZXgsIGZpZWxkKTtcbiAgaWYgKGlzQXJyYXlGaWVsZCAmJiBlc0ZpZWxkVHlwZSAhPT0gJ25lc3RlZCcpIHtcbiAgICByZXR1cm4gYFske2dxbFR5cGV9XWA7XG4gIH1cbiAgaWYgKGVzRmllbGRUeXBlID09PSAnbmVzdGVkJykge1xuICAgIGlmIChpc0FycmF5RmllbGQpIHtcbiAgICAgIHJldHVybiBgWyR7ZmllbGR9XWA7XG4gICAgfVxuICAgIHJldHVybiBgJHtmaWVsZH1gO1xuICB9XG4gIHJldHVybiBncWxUeXBlO1xufTtcblxuY29uc3QgRW51bUFnZ3NIaXN0b2dyYW1OYW1lID0ge1xuICBISVNUT0dSQU1fRk9SX1NUUklORzogJ0hpc3RvZ3JhbUZvclN0cmluZycsXG4gIEhJU1RPR1JBTV9GT1JfTlVNQkVSOiAnSGlzdG9ncmFtRm9yTnVtYmVyJyxcbn07XG5jb25zdCBncWxUeXBlVG9BZ2dzSGlzdG9ncmFtTmFtZSA9IHtcbiAgU3RyaW5nOiBFbnVtQWdnc0hpc3RvZ3JhbU5hbWUuSElTVE9HUkFNX0ZPUl9TVFJJTkcsXG4gIEludDogRW51bUFnZ3NIaXN0b2dyYW1OYW1lLkhJU1RPR1JBTV9GT1JfTlVNQkVSLFxuICBGbG9hdDogRW51bUFnZ3NIaXN0b2dyYW1OYW1lLkhJU1RPR1JBTV9GT1JfTlVNQkVSLFxuICAnW1N0cmluZ10nOiBFbnVtQWdnc0hpc3RvZ3JhbU5hbWUuSElTVE9HUkFNX0ZPUl9TVFJJTkcsXG4gICdbSW50XSc6IEVudW1BZ2dzSGlzdG9ncmFtTmFtZS5ISVNUT0dSQU1fRk9SX05VTUJFUixcbiAgJ1tGbG9hdF0nOiBFbnVtQWdnc0hpc3RvZ3JhbU5hbWUuSElTVE9HUkFNX0ZPUl9OVU1CRVIsXG59O1xuXG5jb25zdCBnZXRBZ2dzSGlzdG9ncmFtTmFtZSA9IChncWxUeXBlKSA9PiB7XG4gIGlmICghZ3FsVHlwZVRvQWdnc0hpc3RvZ3JhbU5hbWVbZ3FsVHlwZV0pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZWxhc3RpY3NlYXJjaCB0eXBlICR7Z3FsVHlwZX1gKTtcbiAgfVxuICByZXR1cm4gZ3FsVHlwZVRvQWdnc0hpc3RvZ3JhbU5hbWVbZ3FsVHlwZV07XG59O1xuXG5jb25zdCBnZXRRdWVyeVNjaGVtYUZvclR5cGUgPSAoZXNUeXBlKSA9PiB7XG4gIGNvbnN0IGVzVHlwZU9iak5hbWUgPSBmaXJzdExldHRlclVwcGVyQ2FzZShlc1R5cGUpO1xuICByZXR1cm4gYCR7ZXNUeXBlfSAoXG4gICAgb2Zmc2V0OiBJbnQsXG4gICAgZmlyc3Q6IEludCxcbiAgICBmaWx0ZXI6IEpTT04sXG4gICAgc29ydDogSlNPTixcbiAgICBhY2Nlc3NpYmlsaXR5OiBBY2Nlc3NpYmlsaXR5PWFsbCxcbiAgICBmb3JtYXQ6IEZvcm1hdD1qc29uLFxuICAgICk6IFske2VzVHlwZU9iak5hbWV9XWA7XG59O1xuXG5jb25zdCBnZXRGaWVsZEdRTFR5cGVNYXBGb3JQcm9wZXJ0aWVzID0gKGVzSW5zdGFuY2UsIGVzSW5kZXgsIHByb3BlcnRpZXMpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gT2JqZWN0LmtleXMocHJvcGVydGllcykubWFwKChmaWVsZCkgPT4ge1xuICAgIGNvbnN0IGVzRmllbGRUeXBlID0gKHByb3BlcnRpZXNbZmllbGRdLmVzVHlwZSlcbiAgICAgID8gcHJvcGVydGllc1tmaWVsZF0uZXNUeXBlIDogcHJvcGVydGllc1tmaWVsZF0udHlwZTtcbiAgICBjb25zdCBncWxUeXBlID0gZ2V0R1FMVHlwZShlc0luc3RhbmNlLCBlc0luZGV4LCBmaWVsZCwgZXNGaWVsZFR5cGUpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpZWxkLCB0eXBlOiBncWxUeXBlLCBlc1R5cGU6IGVzRmllbGRUeXBlLCBwcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzW2ZpZWxkXS5wcm9wZXJ0aWVzLFxuICAgIH07XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0O1xufTtcblxuY29uc3QgZ2V0RmllbGRHUUxUeXBlTWFwRm9yT25lSW5kZXggPSAoZXNJbnN0YW5jZSwgZXNJbmRleCkgPT4ge1xuICBjb25zdCBmaWVsZEVTVHlwZU1hcCA9IGVzSW5zdGFuY2UuZ2V0RVNGaWVsZFR5cGVNYXBwaW5nQnlJbmRleChlc0luZGV4KTtcbiAgcmV0dXJuIGdldEZpZWxkR1FMVHlwZU1hcEZvclByb3BlcnRpZXMoZXNJbnN0YW5jZSwgZXNJbmRleCwgZmllbGRFU1R5cGVNYXApO1xufTtcblxuY29uc3QgZ2V0QXJnc0J5RmllbGQgPSAoZmllbGRUeXBlLCBwcm9wcykgPT4ge1xuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocHJvcHMpO1xuICBjb25zdCBiYXNlUHJvcHMgPSBbXTtcbiAga2V5cy5mb3JFYWNoKChrKSA9PiB7XG4gICAgaWYgKHByb3BzW2tdLnR5cGUgIT09ICduZXN0ZWQnKSBiYXNlUHJvcHMucHVzaCh7IGZpZWxkOiBrLCB0eXBlOiBlc2dxbFR5cGVNYXBwaW5nW3Byb3BzW2tdLnR5cGVdIH0pO1xuICB9KTtcbiAgcmV0dXJuIGAoJHtiYXNlUHJvcHMubWFwKChlbnRyeSkgPT4gYCR7ZW50cnkuZmllbGR9OiBbJHtlbnRyeS50eXBlfV1gKS5qb2luKCcsJyl9KWA7XG59O1xuXG5jb25zdCBnZXRTY2hlbWFUeXBlID0gKGZpZWxkVHlwZSkgPT4gYCR7ZmllbGRUeXBlLmZpZWxkfTogJHtmaWVsZFR5cGUudHlwZX1gO1xuXG5jb25zdCBnZXRUeXBlU2NoZW1hRm9yT25lSW5kZXggPSAoZXNJbnN0YW5jZSwgZXNJbmRleCwgZXNUeXBlKSA9PiB7XG4gIGNvbnN0IGZpZWxkR1FMVHlwZU1hcCA9IGdldEZpZWxkR1FMVHlwZU1hcEZvck9uZUluZGV4KGVzSW5zdGFuY2UsIGVzSW5kZXgpO1xuICBjb25zdCBmaWVsZEVTVHlwZU1hcCA9IGVzSW5zdGFuY2UuZ2V0RVNGaWVsZFR5cGVNYXBwaW5nQnlJbmRleChlc0luZGV4KTtcbiAgY29uc3QgZXNUeXBlT2JqTmFtZSA9IGZpcnN0TGV0dGVyVXBwZXJDYXNlKGVzVHlwZSk7XG4gIGNvbnN0IGV4aXN0aW5nRmllbGRzID0gbmV3IFNldChbXSk7XG4gIGNvbnN0IGZpZWxkVG9BcmdzID0ge307XG5cbiAgY29uc3QgcXVldWVUeXBlcyA9IFtdO1xuICBPYmplY3Qua2V5cyhmaWVsZEVTVHlwZU1hcCkuZm9yRWFjaCgoZmllbGRLZXkpID0+IHtcbiAgICBjb25zdCBlc0ZpZWxkVHlwZSA9IGZpZWxkRVNUeXBlTWFwW2ZpZWxkS2V5XS50eXBlO1xuICAgIGlmIChlc0ZpZWxkVHlwZSA9PT0gJ25lc3RlZCcgJiYgIWV4aXN0aW5nRmllbGRzLmhhcyhmaWVsZEtleSkpIHtcbiAgICAgIGNvbnN0IHsgcHJvcGVydGllcyB9ID0gZmllbGRFU1R5cGVNYXBbZmllbGRLZXldO1xuICAgICAgcXVldWVUeXBlcy5wdXNoKHsgdHlwZTogYCR7ZmllbGRLZXl9YCwgcHJvcGVydGllcyB9KTtcbiAgICAgIGV4aXN0aW5nRmllbGRzLmFkZChmaWVsZEtleSk7XG4gICAgfVxuICB9KTtcblxuICBsZXQgc1R5cGVTY2hlbWEgPSBgXG4gICAgdHlwZSAke2VzVHlwZU9iak5hbWV9IHtcbiAgICAgICR7ZmllbGRHUUxUeXBlTWFwLm1hcCgoZW50cnkpID0+IGAke2dldFNjaGVtYVR5cGUoZW50cnkpfSxgKS5qb2luKCdcXG4nKX1cbiAgICAgIF9tYXRjaGVkOiBbTWF0Y2hlZEl0ZW1dXG4gICAgfVxuICBgO1xuXG4gIHdoaWxlIChxdWV1ZVR5cGVzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCB0ID0gcXVldWVUeXBlcy5zaGlmdCgpO1xuICAgIGNvbnN0IGdxbFR5cGVzID0gZ2V0RmllbGRHUUxUeXBlTWFwRm9yUHJvcGVydGllcyhlc0luc3RhbmNlLCBlc0luZGV4LCB0LnByb3BlcnRpZXMpO1xuICAgIGdxbFR5cGVzLmZvckVhY2goKGVudHJ5KSA9PiB7XG4gICAgICBpZiAoZW50cnkuZXNUeXBlID09PSAnbmVzdGVkJyAmJiAhZXhpc3RpbmdGaWVsZHMuaGFzKGVudHJ5LmZpZWxkKSkge1xuICAgICAgICBxdWV1ZVR5cGVzLnB1c2goeyB0eXBlOiBgJHtlbnRyeS5maWVsZH1gLCBwcm9wZXJ0aWVzOiBlbnRyeS5wcm9wZXJ0aWVzIH0pO1xuICAgICAgICBleGlzdGluZ0ZpZWxkcy5hZGQoZW50cnkuZmllbGQpO1xuICAgICAgICBmaWVsZFRvQXJnc1tlbnRyeS5maWVsZF0gPSBnZXRBcmdzQnlGaWVsZChlbnRyeS5maWVsZCwgZW50cnkucHJvcGVydGllcyk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgc1R5cGVTY2hlbWEgKz0gYFxuICAgICAgdHlwZSAke3QudHlwZX0ge1xuICAgICAgICAke2dxbFR5cGVzLm1hcCgoZW50cnkpID0+IGAke2dldFNjaGVtYVR5cGUoZW50cnkpfSxgKS5qb2luKCdcXG4nKX1cbiAgICAgIH1cbiAgICBgO1xuICB9XG4gIHJldHVybiBzVHlwZVNjaGVtYTtcbn07XG5cbmNvbnN0IGdldEFnZ3JlZ2F0aW9uVHlwZSA9IChlbnRyeSkgPT4ge1xuICBpZiAoZW50cnkuYWdnVHlwZSAhPT0gJycpIHtcbiAgICByZXR1cm4gYCR7ZW50cnkuZmllbGR9OiAke2VudHJ5LmFnZ1R5cGV9LGA7XG4gIH1cbiAgcmV0dXJuICcnO1xufTtcblxuY29uc3QgZ2V0QWdncmVnYXRpb25TY2hlbWFGb3JPbmVJbmRleCA9IChlc0luc3RhbmNlLCBlc0NvbmZpZ0VsZW1lbnQpID0+IHtcbiAgY29uc3QgZXNJbmRleCA9IGVzQ29uZmlnRWxlbWVudC5pbmRleDtcbiAgY29uc3QgZXNUeXBlID0gZXNDb25maWdFbGVtZW50LnR5cGU7XG4gIGNvbnN0IGluY2x1ZGVIaXN0b2dyYW1QcmVmaXggPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZXNDb25maWdFbGVtZW50LCAndGllcl9hY2Nlc3NfbGV2ZWwnKSAmJiBlc0NvbmZpZ0VsZW1lbnQudGllcl9hY2Nlc3NfbGV2ZWwgPT09ICdyZWd1bGFyJztcbiAgY29uc3QgZXNUeXBlT2JqTmFtZSA9IGZpcnN0TGV0dGVyVXBwZXJDYXNlKGVzVHlwZSk7XG4gIGNvbnN0IGZpZWxkR1FMVHlwZU1hcCA9IGdldEZpZWxkR1FMVHlwZU1hcEZvck9uZUluZGV4KGVzSW5zdGFuY2UsIGVzSW5kZXgpO1xuICBjb25zdCBmaWVsZEFnZ3NUeXBlTWFwID0gZmllbGRHUUxUeXBlTWFwLmZpbHRlcigoZikgPT4gZi5lc1R5cGUgIT09ICduZXN0ZWQnKS5tYXAoKGVudHJ5KSA9PiAoe1xuICAgIGZpZWxkOiBlbnRyeS5maWVsZCxcbiAgICBhZ2dUeXBlOiAoaW5jbHVkZUhpc3RvZ3JhbVByZWZpeCA/IGhpc3RvZ3JhbVR5cGVQcmVmaXggOiAnJykgKyBnZXRBZ2dzSGlzdG9ncmFtTmFtZShlbnRyeS50eXBlKSxcbiAgfSkpO1xuICBjb25zdCBmaWVsZEFnZ3NOZXN0ZWRUeXBlTWFwID0gZmllbGRHUUxUeXBlTWFwLmZpbHRlcigoZikgPT4gZi5lc1R5cGUgPT09ICduZXN0ZWQnKTtcbiAgcmV0dXJuIGB0eXBlICR7ZXNUeXBlT2JqTmFtZX1BZ2dyZWdhdGlvbiB7XG4gICAgX3RvdGFsQ291bnQ6IEludCxcbiAgICAke2ZpZWxkQWdnc1R5cGVNYXAubWFwKChlbnRyeSkgPT4gYCR7Z2V0QWdncmVnYXRpb25UeXBlKGVudHJ5KX1gKS5qb2luKCdcXG4nKX1cbiAgICAke2ZpZWxkQWdnc05lc3RlZFR5cGVNYXAubWFwKChlbnRyeSkgPT4gYCR7ZW50cnkuZmllbGR9OiBOZXN0ZWRIaXN0b2dyYW1Gb3Ike2ZpcnN0TGV0dGVyVXBwZXJDYXNlKGVudHJ5LmZpZWxkKX1gKS5qb2luKCdcXG4nKX1cbiAgfWA7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0UXVlcnlTY2hlbWEgPSAoZXNDb25maWcpID0+IGBcbiAgICB0eXBlIFF1ZXJ5IHtcbiAgICAgICR7ZXNDb25maWcuaW5kaWNlcy5tYXAoKGNmZykgPT4gZ2V0UXVlcnlTY2hlbWFGb3JUeXBlKGNmZy50eXBlKSkuam9pbignXFxuJyl9XG4gICAgICBfYWdncmVnYXRpb246IEFnZ3JlZ2F0aW9uXG4gICAgICBfbWFwcGluZzogTWFwcGluZ1xuICAgIH1cbiAgYDtcblxuZXhwb3J0IGNvbnN0IGdldFR5cGVzU2NoZW1hcyA9IChlc0NvbmZpZywgZXNJbnN0YW5jZSkgPT4gZXNDb25maWcuaW5kaWNlcy5tYXAoKGNmZykgPT4gZ2V0VHlwZVNjaGVtYUZvck9uZUluZGV4KGVzSW5zdGFuY2UsIGNmZy5pbmRleCwgY2ZnLnR5cGUpKS5qb2luKCdcXG4nKTtcblxuZXhwb3J0IGNvbnN0IGdldEFnZ3JlZ2F0aW9uU2NoZW1hID0gKGVzQ29uZmlnKSA9PiBgXG4gICAgdHlwZSBBZ2dyZWdhdGlvbiB7XG4gICAgICAke2VzQ29uZmlnLmluZGljZXMubWFwKChjZmcpID0+IGAke2NmZy50eXBlfSAoXG4gICAgICAgIGZpbHRlcjogSlNPTixcbiAgICAgICAgZmlsdGVyU2VsZjogQm9vbGVhbj10cnVlLFxuICAgICAgICBuZXN0ZWRBZ2dGaWVsZHM6IEpTT04sXG4gICAgICAgIFwiXCJcIk9ubHkgdXNlZCB3aGVuIGl0J3MgcmVndWxhciBsZXZlbCBkYXRhIGNvbW1vbnMsIGlmIHNldCwgcmV0dXJucyBhZ2dyZWdhdGlvbiBkYXRhIHdpdGhpbiBnaXZlbiBhY2Nlc3NpYmlsaXR5XCJcIlwiXG4gICAgICAgIGFjY2Vzc2liaWxpdHk6IEFjY2Vzc2liaWxpdHk9YWxsXG4gICAgICApOiAke2ZpcnN0TGV0dGVyVXBwZXJDYXNlKGNmZy50eXBlKX1BZ2dyZWdhdGlvbmApLmpvaW4oJ1xcbicpfVxuICAgIH1cbiAgYDtcblxuLyoqXG4gKiBUaGlzIGlzIHRoZSBmdW5jdGlvbiBmb3IgZ2V0dGluZyBzY2hlbWFzIGZvciBhIHNpbmdsZSBuZXN0ZWQgaW5kZXguXG4gKiBNdWx0aS1sZXZlbCBuZXN0ZWQgZmllbGRzIGFyZSBcImZsYXR0ZW5lZFwiIGxldmVsIGJ5IGxldmVsLlxuICogRm9yIGVhY2ggbGV2ZWwgb2YgbmVzdGVkIGZpZWxkIGEgbmV3IHR5cGUgaW4gc2NoZW1hIGlzIGNyZWF0ZWQuXG4gKi9cbmNvbnN0IGdldEFnZ3JlZ2F0aW9uU2NoZW1hRm9yT25lTmVzdGVkSW5kZXggPSAoZXNJbnN0YW5jZSwgZXNEaWN0KSA9PiB7XG4gIGNvbnN0IGVzSW5kZXggPSBlc0RpY3QuaW5kZXg7XG4gIGNvbnN0IGZpZWxkR1FMVHlwZU1hcCA9IGdldEZpZWxkR1FMVHlwZU1hcEZvck9uZUluZGV4KGVzSW5zdGFuY2UsIGVzSW5kZXgpO1xuICBjb25zdCBmaWVsZEFnZ3NOZXN0ZWRUeXBlTWFwID0gZmllbGRHUUxUeXBlTWFwLmZpbHRlcigoZikgPT4gZi5lc1R5cGUgPT09ICduZXN0ZWQnKTtcbiAgY29uc3QgaW5jbHVkZUhpc3RvZ3JhbVByZWZpeCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlc0RpY3QsICd0aWVyX2FjY2Vzc19sZXZlbCcpICYmIGVzRGljdC50aWVyX2FjY2Vzc19sZXZlbCA9PT0gJ3JlZ3VsYXInO1xuICBsZXQgQWdnc05lc3RlZFR5cGVTY2hlbWEgPSAnJztcbiAgd2hpbGUgKGZpZWxkQWdnc05lc3RlZFR5cGVNYXAubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IGVudHJ5ID0gZmllbGRBZ2dzTmVzdGVkVHlwZU1hcC5zaGlmdCgpO1xuICAgIGlmIChlbnRyeS5maWVsZCAmJiBlbnRyeS5wcm9wZXJ0aWVzKSB7XG4gICAgICBBZ2dzTmVzdGVkVHlwZVNjaGVtYSArPSBgdHlwZSBOZXN0ZWRIaXN0b2dyYW1Gb3Ike2ZpcnN0TGV0dGVyVXBwZXJDYXNlKGVudHJ5LmZpZWxkKX0geyR7T2JqZWN0LmtleXMoZW50cnkucHJvcGVydGllcykubWFwKChwcm9wc0tleSkgPT4ge1xuICAgICAgICBjb25zdCBlbnRyeVR5cGUgPSBlbnRyeS5wcm9wZXJ0aWVzW3Byb3BzS2V5XS50eXBlO1xuICAgICAgICBpZiAoZW50cnlUeXBlID09PSAnbmVzdGVkJykge1xuICAgICAgICAgIGZpZWxkQWdnc05lc3RlZFR5cGVNYXAucHVzaCh7XG4gICAgICAgICAgICBmaWVsZDogcHJvcHNLZXksXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiBlbnRyeS5wcm9wZXJ0aWVzW3Byb3BzS2V5XS5wcm9wZXJ0aWVzLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBgXG4gICAgICAke3Byb3BzS2V5fTogTmVzdGVkSGlzdG9ncmFtRm9yJHtmaXJzdExldHRlclVwcGVyQ2FzZShwcm9wc0tleSl9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYFxuICAgICR7cHJvcHNLZXl9OiAkeyhpbmNsdWRlSGlzdG9ncmFtUHJlZml4ID8gaGlzdG9ncmFtVHlwZVByZWZpeCA6ICcnKSArIGdldEFnZ3NIaXN0b2dyYW1OYW1lKGVzZ3FsVHlwZU1hcHBpbmdbZW50cnlUeXBlXSl9YDtcbiAgICAgIH0pfVxufWA7XG4gICAgfVxuICB9XG4gIGxvZy5kZWJ1ZygnW1NDSEVNQV0gQWdnc05lc3RlZFR5cGVTY2hlbWE6ICcsIEFnZ3NOZXN0ZWRUeXBlU2NoZW1hKTtcbiAgcmV0dXJuIEFnZ3NOZXN0ZWRUeXBlU2NoZW1hO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEFnZ3JlZ2F0aW9uU2NoZW1hRm9yRWFjaFR5cGUgPSAoZXNDb25maWcsIGVzSW5zdGFuY2UpID0+IGVzQ29uZmlnLmluZGljZXMubWFwKChjZmcpID0+IGdldEFnZ3JlZ2F0aW9uU2NoZW1hRm9yT25lSW5kZXgoZXNJbnN0YW5jZSwgY2ZnKSkuam9pbignXFxuJyk7XG5cbmV4cG9ydCBjb25zdCBnZXRBZ2dyZWdhdGlvblNjaGVtYUZvckVhY2hOZXN0ZWRUeXBlID0gKGVzQ29uZmlnLCBlc0luc3RhbmNlKSA9PiBlc0NvbmZpZy5pbmRpY2VzLm1hcCgoY2ZnKSA9PiBnZXRBZ2dyZWdhdGlvblNjaGVtYUZvck9uZU5lc3RlZEluZGV4KGVzSW5zdGFuY2UsIGNmZykpLmpvaW4oJ1xcbicpO1xuXG5jb25zdCBnZXROdW1iZXJIaXN0b2dyYW1TY2hlbWEgPSAoaXNSZWd1bGFyQWNjZXNzKSA9PiBgXG4gICAgdHlwZSAkeyhpc1JlZ3VsYXJBY2Nlc3MgPyBoaXN0b2dyYW1UeXBlUHJlZml4IDogJycpICsgRW51bUFnZ3NIaXN0b2dyYW1OYW1lLkhJU1RPR1JBTV9GT1JfTlVNQkVSfSB7XG4gICAgICBfdG90YWxDb3VudDogSW50LFxuICAgICAgX2NhcmRpbmFsaXR5Q291bnQocHJlY2lzaW9uX3RocmVzaG9sZDogSW50ID0gMzAwMCk6IEludCxcbiAgICAgIGhpc3RvZ3JhbShcbiAgICAgICAgcmFuZ2VTdGFydDogSW50LFxuICAgICAgICByYW5nZUVuZDogSW50LFxuICAgICAgICByYW5nZVN0ZXA6IEludCxcbiAgICAgICAgYmluQ291bnQ6IEludCxcbiAgICAgICk6IFtCdWNrZXRzRm9yTmVzdGVkTnVtYmVyQWdnXSxcbiAgICAgIGFzVGV4dEhpc3RvZ3JhbTogW0J1Y2tldHNGb3JOZXN0ZWRTdHJpbmdBZ2ddXG4gICAgfVxuICBgO1xuXG5jb25zdCBnZXRUZXh0SGlzdG9ncmFtU2NoZW1hID0gKGlzUmVndWxhckFjY2VzcykgPT4gYFxuICAgIHR5cGUgJHsoaXNSZWd1bGFyQWNjZXNzID8gaGlzdG9ncmFtVHlwZVByZWZpeCA6ICcnKSArIEVudW1BZ2dzSGlzdG9ncmFtTmFtZS5ISVNUT0dSQU1fRk9SX1NUUklOR30ge1xuICAgICAgX3RvdGFsQ291bnQ6IEludCxcbiAgICAgIF9jYXJkaW5hbGl0eUNvdW50KHByZWNpc2lvbl90aHJlc2hvbGQ6IEludCA9IDMwMDApOiBJbnQsXG4gICAgICBoaXN0b2dyYW06IFtCdWNrZXRzRm9yTmVzdGVkU3RyaW5nQWdnXSxcbiAgICAgIGFzVGV4dEhpc3RvZ3JhbTogW0J1Y2tldHNGb3JOZXN0ZWRTdHJpbmdBZ2ddXG4gICAgfVxuICBgO1xuXG5leHBvcnQgY29uc3QgZ2V0TWFwcGluZ1NjaGVtYSA9IChlc0NvbmZpZykgPT4gYFxuICAgIHR5cGUgTWFwcGluZyB7XG4gICAgICAke2VzQ29uZmlnLmluZGljZXMubWFwKChjZmcpID0+IGAke2NmZy50eXBlfSAoXG4gICAgICAgIHNlYXJjaElucHV0OiBTdHJpbmdcbiAgICAgICk6IFtTdHJpbmddYCkuam9pbignXFxuJyl9XG4gICAgfVxuICBgO1xuXG5leHBvcnQgY29uc3QgZ2V0SGlzdG9ncmFtU2NoZW1hcyA9ICgpID0+IHtcbiAgY29uc3QgdGV4dEhpc3RvZ3JhbVNjaGVtYSA9IGdldFRleHRIaXN0b2dyYW1TY2hlbWEoZmFsc2UpO1xuXG4gIGNvbnN0IHJlZ3VsYXJBY2Nlc3NUZXh0SGlzdG9ncmFtU2NoZW1hID0gZ2V0VGV4dEhpc3RvZ3JhbVNjaGVtYSh0cnVlKTtcblxuICBjb25zdCBudW1iZXJIaXN0b2dyYW1TY2hlbWEgPSBnZXROdW1iZXJIaXN0b2dyYW1TY2hlbWEoZmFsc2UpO1xuXG4gIGNvbnN0IHJlZ3VsYXJBY2Nlc3NOdW1iZXJIaXN0b2dyYW1TY2hlbWEgPSBnZXROdW1iZXJIaXN0b2dyYW1TY2hlbWEodHJ1ZSk7XG5cbiAgY29uc3QgaGlzdG9ncmFtU2NoZW1hcyA9IFt0ZXh0SGlzdG9ncmFtU2NoZW1hLCByZWd1bGFyQWNjZXNzVGV4dEhpc3RvZ3JhbVNjaGVtYSwgbnVtYmVySGlzdG9ncmFtU2NoZW1hLCByZWd1bGFyQWNjZXNzTnVtYmVySGlzdG9ncmFtU2NoZW1hXS5qb2luKCdcXG4nKTtcblxuICByZXR1cm4gaGlzdG9ncmFtU2NoZW1hcztcbn07XG5cbmV4cG9ydCBjb25zdCBidWlsZFNjaGVtYVN0cmluZyA9IChlc0NvbmZpZywgZXNJbnN0YW5jZSkgPT4ge1xuICBjb25zdCBxdWVyeVNjaGVtYSA9IGdldFF1ZXJ5U2NoZW1hKGVzQ29uZmlnKTtcblxuICBjb25zdCBtYXRjaGVkSXRlbVNjaGVtYSA9IGBcbiAgICB0eXBlIE1hdGNoZWRJdGVtIHtcbiAgICAgIGZpZWxkOiBTdHJpbmdcbiAgICAgIGhpZ2hsaWdodHM6IFtTdHJpbmddXG4gICAgfVxuICBgO1xuXG4gIGNvbnN0IHR5cGVzU2NoZW1hcyA9IGdldFR5cGVzU2NoZW1hcyhlc0NvbmZpZywgZXNJbnN0YW5jZSk7XG5cbiAgY29uc3QgYWNjZXNzaWJpbGl0eUVudW0gPSBgXG4gICAgZW51bSBBY2Nlc3NpYmlsaXR5IHtcbiAgICAgIGFsbFxuICAgICAgYWNjZXNzaWJsZVxuICAgICAgdW5hY2Nlc3NpYmxlXG4gICAgfVxuICBgO1xuXG4gIGNvbnN0IGZvcm1hdEVudW0gPSBgXG4gICAgZW51bSBGb3JtYXQge1xuICAgICAganNvblxuICAgICAgdHN2XG4gICAgICBjc3ZcbiAgICB9XG4gIGA7XG5cbiAgY29uc3QgYWdncmVnYXRpb25TY2hlbWEgPSBnZXRBZ2dyZWdhdGlvblNjaGVtYShlc0NvbmZpZyk7XG5cbiAgY29uc3QgYWdncmVnYXRpb25TY2hlbWFzRm9yRWFjaFR5cGUgPSBnZXRBZ2dyZWdhdGlvblNjaGVtYUZvckVhY2hUeXBlKGVzQ29uZmlnLCBlc0luc3RhbmNlKTtcblxuICBjb25zdCBhZ2dyZWdhdGlvblNjaGVtYXNGb3JFYWNoTmVzdGVkVHlwZSA9IGdldEFnZ3JlZ2F0aW9uU2NoZW1hRm9yRWFjaE5lc3RlZFR5cGUoXG4gICAgZXNDb25maWcsXG4gICAgZXNJbnN0YW5jZSxcbiAgKTtcblxuICBjb25zdCBoaXN0b2dyYW1TY2hlbWFzID0gZ2V0SGlzdG9ncmFtU2NoZW1hcygpO1xuXG4gIGNvbnN0IHRleHRIaXN0b2dyYW1CdWNrZXRTY2hlbWEgPSBgXG4gICAgdHlwZSBCdWNrZXRzRm9yTmVzdGVkU3RyaW5nQWdnIHtcbiAgICAgIGtleTogU3RyaW5nXG4gICAgICBjb3VudDogSW50XG4gICAgICBtaXNzaW5nRmllbGRzOiBbQnVja2V0c0Zvck5lc3RlZE1pc3NpbmdGaWVsZHNdXG4gICAgICB0ZXJtc0ZpZWxkczogW0J1Y2tldHNGb3JOZXN0ZWRUZXJtc0ZpZWxkc11cbiAgICB9XG4gIGA7XG5cbiAgY29uc3QgbnVtYmVySGlzdG9ncmFtQnVja2V0U2NoZW1hID0gYFxuICAgIHR5cGUgQnVja2V0c0Zvck5lc3RlZE51bWJlckFnZyB7XG4gICAgICBcIlwiXCJMb3dlciBhbmQgaGlnaGVyIGJvdW5kcyBmb3IgdGhpcyBidWNrZXRcIlwiXCJcbiAgICAgIGtleTogW0Zsb2F0XVxuICAgICAgbWluOiBGbG9hdFxuICAgICAgbWF4OiBGbG9hdFxuICAgICAgYXZnOiBGbG9hdFxuICAgICAgc3VtOiBGbG9hdFxuICAgICAgY291bnQ6IEludFxuICAgICAgbWlzc2luZ0ZpZWxkczogW0J1Y2tldHNGb3JOZXN0ZWRNaXNzaW5nRmllbGRzXVxuICAgICAgdGVybXNGaWVsZHM6IFtCdWNrZXRzRm9yTmVzdGVkVGVybXNGaWVsZHNdXG4gICAgfVxuICBgO1xuXG4gIGNvbnN0IG5lc3RlZE1pc3NpbmdGaWVsZHNCdWNrZXRTY2hlbWEgPSBgXG4gICAgdHlwZSBCdWNrZXRzRm9yTmVzdGVkTWlzc2luZ0ZpZWxkcyB7XG4gICAgICBmaWVsZDogU3RyaW5nXG4gICAgICBjb3VudDogSW50XG4gICAgfVxuICBgO1xuXG4gIGNvbnN0IG5lc3RlZFRlcm1zRmllbGRzQnVja2V0U2NoZW1hID0gYFxuICAgIHR5cGUgQnVja2V0c0Zvck5lc3RlZFRlcm1zRmllbGRzIHtcbiAgICAgIGZpZWxkOiBTdHJpbmdcbiAgICAgIGNvdW50OiBJbnRcbiAgICAgIHRlcm1zOiBbQnVja2V0c0ZvclN0cmluZ11cbiAgICB9XG4gIGA7XG5cbiAgY29uc3Qgc3RyaW5nQnVja2V0U2NoZW1hID0gYFxuICAgIHR5cGUgQnVja2V0c0ZvclN0cmluZyB7XG4gICAgICBrZXk6IFN0cmluZ1xuICAgICAgY291bnQ6IEludFxuICAgIH1cbiAgYDtcblxuICBjb25zdCBtYXBwaW5nU2NoZW1hID0gZ2V0TWFwcGluZ1NjaGVtYShlc0NvbmZpZyk7XG5cbiAgY29uc3Qgc2NoZW1hU3RyID0gYFxuICBzY2FsYXIgSlNPTlxuICAke21hdGNoZWRJdGVtU2NoZW1hfVxuICAke3F1ZXJ5U2NoZW1hfVxuICAke2FjY2Vzc2liaWxpdHlFbnVtfVxuICAke2Zvcm1hdEVudW19XG4gICR7dHlwZXNTY2hlbWFzfVxuICAke2FnZ3JlZ2F0aW9uU2NoZW1hfVxuICAke2FnZ3JlZ2F0aW9uU2NoZW1hc0ZvckVhY2hUeXBlfVxuICAke2FnZ3JlZ2F0aW9uU2NoZW1hc0ZvckVhY2hOZXN0ZWRUeXBlfVxuICAke2hpc3RvZ3JhbVNjaGVtYXN9XG4gICR7dGV4dEhpc3RvZ3JhbUJ1Y2tldFNjaGVtYX1cbiAgJHtuZXN0ZWRNaXNzaW5nRmllbGRzQnVja2V0U2NoZW1hfVxuICAke25lc3RlZFRlcm1zRmllbGRzQnVja2V0U2NoZW1hfVxuICAke3N0cmluZ0J1Y2tldFNjaGVtYX1cbiAgJHtudW1iZXJIaXN0b2dyYW1CdWNrZXRTY2hlbWF9XG4gICR7bWFwcGluZ1NjaGVtYX1cbmA7XG4gIGxvZy5pbmZvKCdbc2NoZW1hXSBncmFwaHFsIHNjaGVtYSBnZW5lcmF0ZWQuJyk7XG4gIGxvZy5pbmZvKCdbc2NoZW1hXSBncmFwaHFsIHNjaGVtYScsIHNjaGVtYVN0cik7XG4gIHJldHVybiBzY2hlbWFTdHI7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBidWlsZFNjaGVtYVN0cmluZztcbiJdLCJtYXBwaW5ncyI6InFXQUFBLElBQUFBLE9BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLE1BQUEsR0FBQUQsT0FBQSxrQkFBcUQsU0FBQUQsdUJBQUFHLENBQUEsVUFBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7O0FBRXJELE1BQU1HLGdCQUFnQixHQUFHO0VBQ3ZCQyxJQUFJLEVBQUUsUUFBUTtFQUNkQyxPQUFPLEVBQUUsUUFBUTtFQUNqQkMsT0FBTyxFQUFFLEtBQUs7RUFDZEMsSUFBSSxFQUFFLE9BQU87RUFDYkMsS0FBSyxFQUFFLEtBQUs7RUFDWkMsSUFBSSxFQUFFLEtBQUs7RUFD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