"use strict";var _express = _interopRequireDefault(require("express"));
var _cors = _interopRequireDefault(require("cors"));
var _helmet = _interopRequireDefault(require("helmet"));
var _graphqlDepthLimit = _interopRequireDefault(require("graphql-depth-limit"));
var _server = require("@apollo/server");
var _express2 = require("@apollo/server/express4");
var _graphqlTools = require("graphql-tools");
var _graphqlMiddleware = require("graphql-middleware");
var _bodyParser = _interopRequireDefault(require("body-parser"));
var _index = _interopRequireDefault(require("./es/index"));
var _resolvers = _interopRequireDefault(require("./resolvers"));
var _schema = _interopRequireDefault(require("./schema"));
var _config = _interopRequireDefault(require("./config"));
var _logger = _interopRequireDefault(require("./logger"));
var _middlewares = _interopRequireDefault(require("./middlewares"));
var _headerParser = _interopRequireDefault(require("./utils/headerParser"));
var _authHelper = _interopRequireDefault(require("./auth/authHelper"));
var _download = _interopRequireDefault(require("./download"));
var _error = _interopRequireDefault(require("./utils/error"));
var _endpoints = require("./endpoints");function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}

let server;
const app = (0, _express.default)();
app.use((0, _cors.default)());
app.use((0, _helmet.default)());
app.use(_bodyParser.default.json({ limit: '50mb' }));

const startServer = async () => {
  // build schema and resolvers by parsing elastic search fields and types,
  const typeDefs = (0, _schema.default)(_config.default.esConfig, _index.default);
  const resolvers = (0, _resolvers.default)(_config.default.esConfig, _index.default);
  const schema = (0, _graphqlTools.makeExecutableSchema)({ typeDefs, resolvers });
  const schemaWithMiddleware = (0, _graphqlMiddleware.applyMiddleware)(schema, ..._middlewares.default);
  // create graphql server instance
  server = new _server.ApolloServer({
    mocks: false,
    schema: schemaWithMiddleware,
    validationRules: [(0, _graphqlDepthLimit.default)(10)]
  });

  await server.start();

  app.use(
    '/graphql',
    (0, _cors.default)(),
    (0, _express2.expressMiddleware)(server, {
      context: async ({ req }) => {
        const jwt = _headerParser.default.parseJWT(req);
        const authHelper = await (0, _authHelper.default)(jwt);
        return {
          authHelper
        };
      },
      // bind graphql server to express app at config.path
      path: _config.default.path
    })
  );
  _logger.default.info(`[Server] guppy listening on port ${_config.default.port}!`);
};

const initializeAndStartServer = async () => {
  await _index.default.initialize();
  await startServer();
};

const refreshRouter = async (req, res, next) => {
  res.setHeader('Content-Type', 'application/json; charset=utf-8');
  try {
    if (_config.default.allowRefresh === false) {
      const disabledRefresh = new _error.default(404, '[Refresh] guppy _refresh functionality is not enabled');
      throw disabledRefresh;
    } else {
      _logger.default.debug('[Refresh] ', JSON.stringify(req.body, null, 4));
      const jwt = _headerParser.default.parseJWT(req);
      if (!jwt) {
        const noJwtError = new _error.default(401, '[Refresh] no JWT user token provided to _refresh function');
        throw noJwtError;
      }
      const authHelper = await (0, _authHelper.default)(jwt);
      if (authHelper._canRefresh === undefined || authHelper._canRefresh === false) {
        const noPermsUser = new _error.default(401, '[Refresh] User cannot refresh Guppy without a valid token that has admin_access method on guppy service for resource path /guppy_admin');
        throw noPermsUser;
      }
      await server.stop();
      await initializeAndStartServer();
    }
    res.send('[Refresh] guppy refreshed successfully');
  } catch (err) {
    _logger.default.error(err);
    next(err);
  }
  return 0;
};

// simple health check endpoint
// eslint-disable-next-line no-unused-vars
app.get('/_status', _endpoints.statusRouter, (req, res, err, next) => {
  if (err instanceof _error.default) {
    // deepcode ignore ServerLeak: no important information exists in error
    res.status(err.code).send(err.msg);
  } else {
    // deepcode ignore ServerLeak: no important information exists in error
    res.status(500).send(err);
  }
});

app.get('/_version', _endpoints.versionRouter);

// download endpoint for fetching data directly from es
// eslint-disable-next-line no-unused-vars
app.post('/download', _download.default, (err, req, res, next) => {
  if (err instanceof _error.default) {
    // deepcode ignore ServerLeak: no important information exists in error
    res.status(err.code).send(err.msg);
  } else {
    // deepcode ignore ServerLeak: no important information exists in error
    res.status(500).send(err);
  }
});

// eslint-disable-next-line no-unused-vars
app.post('/_refresh', refreshRouter, (err, req, res, next) => {
  if (err instanceof _error.default) {
    res.status(err.code).send(err.msg);
  } else {
    res.status(500).send(err);
  }
});

// need to connect to ES and initialize before setting up a server
app.listen(_config.default.port, async () => {
  await initializeAndStartServer();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2NvcnMiLCJfaGVsbWV0IiwiX2dyYXBocWxEZXB0aExpbWl0IiwiX3NlcnZlciIsIl9leHByZXNzMiIsIl9ncmFwaHFsVG9vbHMiLCJfZ3JhcGhxbE1pZGRsZXdhcmUiLCJfYm9keVBhcnNlciIsIl9pbmRleCIsIl9yZXNvbHZlcnMiLCJfc2NoZW1hIiwiX2NvbmZpZyIsIl9sb2dnZXIiLCJfbWlkZGxld2FyZXMiLCJfaGVhZGVyUGFyc2VyIiwiX2F1dGhIZWxwZXIiLCJfZG93bmxvYWQiLCJfZXJyb3IiLCJfZW5kcG9pbnRzIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0Iiwic2VydmVyIiwiYXBwIiwiZXhwcmVzcyIsInVzZSIsImNvcnMiLCJoZWxtZXQiLCJib2R5UGFyc2VyIiwianNvbiIsImxpbWl0Iiwic3RhcnRTZXJ2ZXIiLCJ0eXBlRGVmcyIsImdldFNjaGVtYSIsImNvbmZpZyIsImVzQ29uZmlnIiwiZXNJbnN0YW5jZSIsInJlc29sdmVycyIsImdldFJlc29sdmVyIiwic2NoZW1hIiwibWFrZUV4ZWN1dGFibGVTY2hlbWEiLCJzY2hlbWFXaXRoTWlkZGxld2FyZSIsImFwcGx5TWlkZGxld2FyZSIsIm1pZGRsZXdhcmVzIiwiQXBvbGxvU2VydmVyIiwibW9ja3MiLCJ2YWxpZGF0aW9uUnVsZXMiLCJkZXB0aExpbWl0Iiwic3RhcnQiLCJleHByZXNzTWlkZGxld2FyZSIsImNvbnRleHQiLCJyZXEiLCJqd3QiLCJoZWFkZXJQYXJzZXIiLCJwYXJzZUpXVCIsImF1dGhIZWxwZXIiLCJnZXRBdXRoSGVscGVySW5zdGFuY2UiLCJwYXRoIiwibG9nIiwiaW5mbyIsInBvcnQiLCJpbml0aWFsaXplQW5kU3RhcnRTZXJ2ZXIiLCJpbml0aWFsaXplIiwicmVmcmVzaFJvdXRlciIsInJlcyIsIm5leHQiLCJzZXRIZWFkZXIiLCJhbGxvd1JlZnJlc2giLCJkaXNhYmxlZFJlZnJlc2giLCJDb2RlZEVycm9yIiwiZGVidWciLCJKU09OIiwic3RyaW5naWZ5IiwiYm9keSIsIm5vSnd0RXJyb3IiLCJfY2FuUmVmcmVzaCIsInVuZGVmaW5lZCIsIm5vUGVybXNVc2VyIiwic3RvcCIsInNlbmQiLCJlcnIiLCJlcnJvciIsImdldCIsInN0YXR1c1JvdXRlciIsInN0YXR1cyIsImNvZGUiLCJtc2ciLCJ2ZXJzaW9uUm91dGVyIiwicG9zdCIsImRvd25sb2FkUm91dGVyIiwibGlzdGVuIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZlci9zZXJ2ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgY29ycyBmcm9tICdjb3JzJztcbmltcG9ydCBoZWxtZXQgZnJvbSAnaGVsbWV0JztcbmltcG9ydCBkZXB0aExpbWl0IGZyb20gJ2dyYXBocWwtZGVwdGgtbGltaXQnO1xuaW1wb3J0IHsgQXBvbGxvU2VydmVyIH0gZnJvbSAnQGFwb2xsby9zZXJ2ZXInO1xuaW1wb3J0IHsgZXhwcmVzc01pZGRsZXdhcmUgfSBmcm9tICdAYXBvbGxvL3NlcnZlci9leHByZXNzNCc7XG5pbXBvcnQgeyBtYWtlRXhlY3V0YWJsZVNjaGVtYSB9IGZyb20gJ2dyYXBocWwtdG9vbHMnO1xuaW1wb3J0IHsgYXBwbHlNaWRkbGV3YXJlIH0gZnJvbSAnZ3JhcGhxbC1taWRkbGV3YXJlJztcbmltcG9ydCBib2R5UGFyc2VyIGZyb20gJ2JvZHktcGFyc2VyJztcbmltcG9ydCBlc0luc3RhbmNlIGZyb20gJy4vZXMvaW5kZXgnO1xuaW1wb3J0IGdldFJlc29sdmVyIGZyb20gJy4vcmVzb2x2ZXJzJztcbmltcG9ydCBnZXRTY2hlbWEgZnJvbSAnLi9zY2hlbWEnO1xuaW1wb3J0IGNvbmZpZyBmcm9tICcuL2NvbmZpZyc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBtaWRkbGV3YXJlcyBmcm9tICcuL21pZGRsZXdhcmVzJztcbmltcG9ydCBoZWFkZXJQYXJzZXIgZnJvbSAnLi91dGlscy9oZWFkZXJQYXJzZXInO1xuaW1wb3J0IGdldEF1dGhIZWxwZXJJbnN0YW5jZSBmcm9tICcuL2F1dGgvYXV0aEhlbHBlcic7XG5pbXBvcnQgZG93bmxvYWRSb3V0ZXIgZnJvbSAnLi9kb3dubG9hZCc7XG5pbXBvcnQgQ29kZWRFcnJvciBmcm9tICcuL3V0aWxzL2Vycm9yJztcbmltcG9ydCB7IHN0YXR1c1JvdXRlciwgdmVyc2lvblJvdXRlciB9IGZyb20gJy4vZW5kcG9pbnRzJztcblxubGV0IHNlcnZlcjtcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbmFwcC51c2UoY29ycygpKTtcbmFwcC51c2UoaGVsbWV0KCkpO1xuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oeyBsaW1pdDogJzUwbWInIH0pKTtcblxuY29uc3Qgc3RhcnRTZXJ2ZXIgPSBhc3luYyAoKSA9PiB7XG4gIC8vIGJ1aWxkIHNjaGVtYSBhbmQgcmVzb2x2ZXJzIGJ5IHBhcnNpbmcgZWxhc3RpYyBzZWFyY2ggZmllbGRzIGFuZCB0eXBlcyxcbiAgY29uc3QgdHlwZURlZnMgPSBnZXRTY2hlbWEoY29uZmlnLmVzQ29uZmlnLCBlc0luc3RhbmNlKTtcbiAgY29uc3QgcmVzb2x2ZXJzID0gZ2V0UmVzb2x2ZXIoY29uZmlnLmVzQ29uZmlnLCBlc0luc3RhbmNlKTtcbiAgY29uc3Qgc2NoZW1hID0gbWFrZUV4ZWN1dGFibGVTY2hlbWEoeyB0eXBlRGVmcywgcmVzb2x2ZXJzIH0pO1xuICBjb25zdCBzY2hlbWFXaXRoTWlkZGxld2FyZSA9IGFwcGx5TWlkZGxld2FyZShzY2hlbWEsIC4uLm1pZGRsZXdhcmVzKTtcbiAgLy8gY3JlYXRlIGdyYXBocWwgc2VydmVyIGluc3RhbmNlXG4gIHNlcnZlciA9IG5ldyBBcG9sbG9TZXJ2ZXIoe1xuICAgIG1vY2tzOiBmYWxzZSxcbiAgICBzY2hlbWE6IHNjaGVtYVdpdGhNaWRkbGV3YXJlLFxuICAgIHZhbGlkYXRpb25SdWxlczogW2RlcHRoTGltaXQoMTApXSxcbiAgfSk7XG5cbiAgYXdhaXQgc2VydmVyLnN0YXJ0KCk7XG5cbiAgYXBwLnVzZShcbiAgICAnL2dyYXBocWwnLFxuICAgIGNvcnMoKSxcbiAgICBleHByZXNzTWlkZGxld2FyZShzZXJ2ZXIsIHtcbiAgICAgIGNvbnRleHQ6IGFzeW5jICh7IHJlcSB9KSA9PiB7XG4gICAgICAgIGNvbnN0IGp3dCA9IGhlYWRlclBhcnNlci5wYXJzZUpXVChyZXEpO1xuICAgICAgICBjb25zdCBhdXRoSGVscGVyID0gYXdhaXQgZ2V0QXV0aEhlbHBlckluc3RhbmNlKGp3dCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYXV0aEhlbHBlcixcbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICAvLyBiaW5kIGdyYXBocWwgc2VydmVyIHRvIGV4cHJlc3MgYXBwIGF0IGNvbmZpZy5wYXRoXG4gICAgICBwYXRoOiBjb25maWcucGF0aCxcbiAgICB9KSxcbiAgKTtcbiAgbG9nLmluZm8oYFtTZXJ2ZXJdIGd1cHB5IGxpc3RlbmluZyBvbiBwb3J0ICR7Y29uZmlnLnBvcnR9IWApO1xufTtcblxuY29uc3QgaW5pdGlhbGl6ZUFuZFN0YXJ0U2VydmVyID0gYXN5bmMgKCkgPT4ge1xuICBhd2FpdCBlc0luc3RhbmNlLmluaXRpYWxpemUoKTtcbiAgYXdhaXQgc3RhcnRTZXJ2ZXIoKTtcbn07XG5cbmNvbnN0IHJlZnJlc2hSb3V0ZXIgPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnKTtcbiAgdHJ5IHtcbiAgICBpZiAoY29uZmlnLmFsbG93UmVmcmVzaCA9PT0gZmFsc2UpIHtcbiAgICAgIGNvbnN0IGRpc2FibGVkUmVmcmVzaCA9IG5ldyBDb2RlZEVycm9yKDQwNCwgJ1tSZWZyZXNoXSBndXBweSBfcmVmcmVzaCBmdW5jdGlvbmFsaXR5IGlzIG5vdCBlbmFibGVkJyk7XG4gICAgICB0aHJvdyBkaXNhYmxlZFJlZnJlc2g7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5kZWJ1ZygnW1JlZnJlc2hdICcsIEpTT04uc3RyaW5naWZ5KHJlcS5ib2R5LCBudWxsLCA0KSk7XG4gICAgICBjb25zdCBqd3QgPSBoZWFkZXJQYXJzZXIucGFyc2VKV1QocmVxKTtcbiAgICAgIGlmICghand0KSB7XG4gICAgICAgIGNvbnN0IG5vSnd0RXJyb3IgPSBuZXcgQ29kZWRFcnJvcig0MDEsICdbUmVmcmVzaF0gbm8gSldUIHVzZXIgdG9rZW4gcHJvdmlkZWQgdG8gX3JlZnJlc2ggZnVuY3Rpb24nKTtcbiAgICAgICAgdGhyb3cgbm9Kd3RFcnJvcjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGF1dGhIZWxwZXIgPSBhd2FpdCBnZXRBdXRoSGVscGVySW5zdGFuY2Uoand0KTtcbiAgICAgIGlmIChhdXRoSGVscGVyLl9jYW5SZWZyZXNoID09PSB1bmRlZmluZWQgfHwgYXV0aEhlbHBlci5fY2FuUmVmcmVzaCA9PT0gZmFsc2UpIHtcbiAgICAgICAgY29uc3Qgbm9QZXJtc1VzZXIgPSBuZXcgQ29kZWRFcnJvcig0MDEsICdbUmVmcmVzaF0gVXNlciBjYW5ub3QgcmVmcmVzaCBHdXBweSB3aXRob3V0IGEgdmFsaWQgdG9rZW4gdGhhdCBoYXMgYWRtaW5fYWNjZXNzIG1ldGhvZCBvbiBndXBweSBzZXJ2aWNlIGZvciByZXNvdXJjZSBwYXRoIC9ndXBweV9hZG1pbicpO1xuICAgICAgICB0aHJvdyBub1Blcm1zVXNlcjtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHNlcnZlci5zdG9wKCk7XG4gICAgICBhd2FpdCBpbml0aWFsaXplQW5kU3RhcnRTZXJ2ZXIoKTtcbiAgICB9XG4gICAgcmVzLnNlbmQoJ1tSZWZyZXNoXSBndXBweSByZWZyZXNoZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5lcnJvcihlcnIpO1xuICAgIG5leHQoZXJyKTtcbiAgfVxuICByZXR1cm4gMDtcbn07XG5cbi8vIHNpbXBsZSBoZWFsdGggY2hlY2sgZW5kcG9pbnRcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuYXBwLmdldCgnL19zdGF0dXMnLCBzdGF0dXNSb3V0ZXIsIChyZXEsIHJlcywgZXJyLCBuZXh0KSA9PiB7XG4gIGlmIChlcnIgaW5zdGFuY2VvZiBDb2RlZEVycm9yKSB7XG4gICAgLy8gZGVlcGNvZGUgaWdub3JlIFNlcnZlckxlYWs6IG5vIGltcG9ydGFudCBpbmZvcm1hdGlvbiBleGlzdHMgaW4gZXJyb3JcbiAgICByZXMuc3RhdHVzKGVyci5jb2RlKS5zZW5kKGVyci5tc2cpO1xuICB9IGVsc2Uge1xuICAgIC8vIGRlZXBjb2RlIGlnbm9yZSBTZXJ2ZXJMZWFrOiBubyBpbXBvcnRhbnQgaW5mb3JtYXRpb24gZXhpc3RzIGluIGVycm9yXG4gICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoZXJyKTtcbiAgfVxufSk7XG5cbmFwcC5nZXQoJy9fdmVyc2lvbicsIHZlcnNpb25Sb3V0ZXIpO1xuXG4vLyBkb3dubG9hZCBlbmRwb2ludCBmb3IgZmV0Y2hpbmcgZGF0YSBkaXJlY3RseSBmcm9tIGVzXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbmFwcC5wb3N0KCcvZG93bmxvYWQnLCBkb3dubG9hZFJvdXRlciwgKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgaWYgKGVyciBpbnN0YW5jZW9mIENvZGVkRXJyb3IpIHtcbiAgICAvLyBkZWVwY29kZSBpZ25vcmUgU2VydmVyTGVhazogbm8gaW1wb3J0YW50IGluZm9ybWF0aW9uIGV4aXN0cyBpbiBlcnJvclxuICAgIHJlcy5zdGF0dXMoZXJyLmNvZGUpLnNlbmQoZXJyLm1zZyk7XG4gIH0gZWxzZSB7XG4gICAgLy8gZGVlcGNvZGUgaWdub3JlIFNlcnZlckxlYWs6IG5vIGltcG9ydGFudCBpbmZvcm1hdGlvbiBleGlzdHMgaW4gZXJyb3JcbiAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChlcnIpO1xuICB9XG59KTtcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG5hcHAucG9zdCgnL19yZWZyZXNoJywgcmVmcmVzaFJvdXRlciwgKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgaWYgKGVyciBpbnN0YW5jZW9mIENvZGVkRXJyb3IpIHtcbiAgICByZXMuc3RhdHVzKGVyci5jb2RlKS5zZW5kKGVyci5tc2cpO1xuICB9IGVsc2Uge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKGVycik7XG4gIH1cbn0pO1xuXG4vLyBuZWVkIHRvIGNvbm5lY3QgdG8gRVMgYW5kIGluaXRpYWxpemUgYmVmb3JlIHNldHRpbmcgdXAgYSBzZXJ2ZXJcbmFwcC5saXN0ZW4oY29uZmlnLnBvcnQsIGFzeW5jICgpID0+IHtcbiAgYXdhaXQgaW5pdGlhbGl6ZUFuZFN0YXJ0U2VydmVyKCk7XG59KTtcbiJdLCJtYXBwaW5ncyI6ImFBQUEsSUFBQUEsUUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsS0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsT0FBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsa0JBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLE9BQUEsR0FBQUosT0FBQTtBQUNBLElBQUFLLFNBQUEsR0FBQUwsT0FBQTtBQUNBLElBQUFNLGFBQUEsR0FBQU4sT0FBQTtBQUNBLElBQUFPLGtCQUFBLEdBQUFQLE9BQUE7QUFDQSxJQUFBUSxXQUFBLEdBQUFULHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBUyxNQUFBLEdBQUFWLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBVSxVQUFBLEdBQUFYLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBVyxPQUFBLEdBQUFaLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBWSxPQUFBLEdBQUFiLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBYSxPQUFB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