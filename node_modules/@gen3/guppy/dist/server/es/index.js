"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _elasticsearch = require("@elastic/elasticsearch");
var _lodash = _interopRequireDefault(require("lodash"));
var _graphql = require("graphql");
var _config = _interopRequireDefault(require("../config"));
var _filter = _interopRequireDefault(require("./filter"));
var _sort = _interopRequireDefault(require("./sort"));
var esAggregator = _interopRequireWildcard(require("./aggs"));
var _logger = _interopRequireDefault(require("../logger"));
var _const = require("./const");
var _error = _interopRequireDefault(require("../utils/error"));
var _utils = require("../utils/utils");function _getRequireWildcardCache(e) {if ("function" != typeof WeakMap) return null;var r = new WeakMap(),t = new WeakMap();return (_getRequireWildcardCache = function (e) {return e ? t : r;})(e);}function _interopRequireWildcard(e, r) {if (!r && e && e.__esModule) return e;if (null === e || "object" != typeof e && "function" != typeof e) return { default: e };var t = _getRequireWildcardCache(r);if (t && t.has(e)) return t.get(e);var n = { __proto__: null },a = Object.defineProperty && Object.getOwnPropertyDescriptor;for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) {var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];}return n.default = e, t && t.set(e, n), n;}function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}

class ES {
  constructor(esConfig = _config.default.esConfig) {
    this.config = esConfig;
    this.client = new _elasticsearch.Client({
      node: this.config.host
      // log: 'trace'
    });
    this.client.ping({}, (error) => {
      if (error) {
        _logger.default.error(`[ES] elasticsearch cluster at ${this.config.host} is down!`);
      } else {
        _logger.default.info(`[ES] connected to elasticsearch at ${this.config.host}.`);
        this.connected = true;
      }
    });
  }

  /**
   * Query ES data (search API) by index, type, and queryBody
   * See https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/api-reference.html#_search
   * @param {string} esIndex
   * @param {string} esType
   * @param {object} queryBody
   */
  async query(esIndex, esType, queryBody) {
    const validatedQueryBody = {};
    Object.keys(queryBody).forEach((key) => {
      if (typeof queryBody[key] !== 'undefined' && queryBody[key] !== null) {
        validatedQueryBody[key] = queryBody[key];
      }
    });
    validatedQueryBody.highlight = {
      pre_tags: [
      `<${_config.default.matchedTextHighlightTagName}>`],

      post_tags: [
      `</${_config.default.matchedTextHighlightTagName}>`],

      fields: {
        [`*${_config.default.analyzedTextFieldSuffix}`]: {}
      }
    };
    validatedQueryBody.track_total_hits = true;

    const start = Date.now();
    return this.client.search({
      index: esIndex,
      body: validatedQueryBody
    }).then((resp) => resp.body, (err) => {
      _logger.default.error(`[ES.query] error during querying: ${err.message}`);
      throw new Error(err.message);
    }).finally(() => {
      const end = Date.now();
      const durationInMS = end - start;

      _logger.default.info(`[ES.query] DurationInMS:${durationInMS}. index, type, query body: `, esIndex, esType, JSON.stringify(validatedQueryBody));
    });
  }

  /**
   * Fetch elastic search data using scroll API
   * See https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-scroll.html
   * @param {string} esIndex
   * @param {string} esType
   * @param {Object} argument - arg object for filter, fields, and sort
   */
  async scrollQuery(esIndex, esType, {
    filter,
    fields,
    sort
  }) {
    if (!esIndex || !esType) {
      throw new _error.default(
        400,
        'Invalid es index or es type name'
      );
    }
    const allESFields = _lodash.default.flattenDeep(this.getESFields(esIndex).fields.map((f) => {
      if (f.nestedProps) {
        return (0, _utils.processNestedFieldNames)(f);
      }
      return f.name;
    }));
    const fieldsNotBelong = _lodash.default.difference(fields, allESFields);
    if (fieldsNotBelong.length > 0) {
      throw new _error.default(
        400,
        `Invalid fields: "${fieldsNotBelong.join('", "')}"`
      );
    }
    const validatedQueryBody = filter ? { query: filter } : {};
    _logger.default.debug('[ES.scrollQuery] scroll query body: ', JSON.stringify(validatedQueryBody, null, 4));

    let currentBatch;
    let scrollID;
    let totalData = [];
    let batchSize = 0;

    // This is really ridiculous that ES's JS library has it, but we need to
    // convert list of sort obj into comma separated strings to make it work
    // see https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/api-reference.html#_search
    const sortStringList = sort && sort.map((item) => `${Object.keys(item)[0]}:${Object.values(item)[0]}`);

    while (!currentBatch || batchSize > 0) {
      if (typeof scrollID === 'undefined') {// first batch
        const res = await this.client.search({ // eslint-disable-line no-await-in-loop
          index: esIndex,
          body: validatedQueryBody,
          scroll: '1m',
          size: _const.SCROLL_PAGE_SIZE,
          _source: fields,
          sort: sortStringList
        }).then((resp) => resp, (err) => {
          _logger.default.error('[ES.query] error when query', err.message);
          throw new Error(err.message);
        });
        currentBatch = res.body;
        _logger.default.debug('[ES scrollQuery] created scroll');
      } else {// following batches
        const res = await this.client.scroll({ // eslint-disable-line no-await-in-loop
          scroll_id: scrollID,
          scroll: '1m'
        });
        currentBatch = res.body;
      }

      // merge fetched batches
      scrollID = currentBatch._scroll_id;
      batchSize = currentBatch.hits.hits.length;
      _logger.default.debug('[ES scrollQuery] get batch size = ', batchSize, ' merging...');

      // TODO: change it to streaming
      totalData = totalData.concat(currentBatch.hits.hits.map((item) => item._source));
    }

    _logger.default.debug('[ES scrollQuery] end scrolling');
    await this.client.clearScroll({
      scroll_id: scrollID
    });
    _logger.default.debug('[ES scrollQuery] scroll cleaned');
    return totalData;
  }

  /**
   * Get mapping from ES with given index and type.
   * Return a Promise of an Object: { <field>: <type> }
   * If error, print error stack
   * @param {string} esIndex
   */
  async _getESFieldsTypes(esIndex) {
    const errMsg = `[ES.initialize] error getting mapping from ES index "${esIndex}"`;
    return this.client.indices.getMapping({
      index: esIndex
    }).then((resp) => {
      try {
        const esIndexAlias = Object.keys(resp.body)[0];
        _logger.default.info('Mapping response from ES: ', resp.body[esIndexAlias]);
        return resp.body[esIndexAlias].mappings.properties;
      } catch (err) {
        throw new Error(`${errMsg}: ${err}`);
      }
    }, (err) => {
      throw new Error(`${errMsg}: ${err.message}`);
    });
  }

  async _getMappingsForAllIndices() {
    if (!this.config.indices || this.config.indices === 0) {
      const errMsg = '[ES.initialize] Error when initializing: empty "config.indices" block';
      throw new Error(errMsg);
    }
    const fieldTypes = {};
    _logger.default.info('[ES.initialize] getting mapping from elasticsearch...');
    const promiseList = this.config.indices.
    map((cfg) => this._getESFieldsTypes(cfg.index).
    then((res) => ({ index: cfg.index, fieldTypes: res })));
    const resultList = await Promise.all(promiseList);
    _logger.default.info('[ES.initialize] got mapping from elasticsearch');
    resultList.forEach((res) => {
      fieldTypes[res.index] = res.fieldTypes;
    });
    _logger.default.debug('[ES.initialize]', JSON.stringify(fieldTypes, null, 4));
    return fieldTypes;
  }

  /**
   * Read array config and check if there's any array fields for each index.
   * Array fields are grouped and stored by index as a doc in array config,
   * and we set _id as index name for this doc.
   */
  async _getArrayFieldsFromConfigIndex() {
    if (typeof this.config.configIndex === 'undefined') {
      _logger.default.info('[ES.initialize] no array fields from es config index.');
      return Promise.resolve({});
    }
    if (!this.fieldTypes) {
      return {};
    }
    const arrayFields = {};
    _logger.default.info(`[ES.initialize] getting array fields from es config index "${this.config.configIndex}"...`);
    return this.client.search({
      index: this.config.configIndex,
      body: {
        query: {
          ids: {
            values: Object.keys(this.fieldTypes)
          }
        }
      }
    }).then((resp) => {
      try {
        resp.body.hits.hits.forEach((doc) => {
          const index = doc._id;
          if (!this.fieldTypes[index]) {
            const errMsg = `[ES.initialize] wrong array entry from config index: index "${index}" not found, skipped.`;
            _logger.default.error(errMsg);
            return;
          }
          const fields = doc._source.array;
          fields.forEach((field) => {
            const fieldArr = field.split('.');
            if (!(this.fieldTypes[index][field] ||

            fieldArr.length > 1 &&
            _lodash.default.has(
              this.fieldTypes[index],
              fieldArr.join('.properties.')
            )))

            {
              const errMsg = `[ES.initialize] wrong array entry from config: field "${field}" not found in index ${index}, skipped.`;
              _logger.default.error(errMsg);
              return;
            }
            if (!arrayFields[index]) arrayFields[index] = [];
            arrayFields[index].push(field);
          });
        });
        _logger.default.info('[ES.initialize] got array fields from es config index:', JSON.stringify(arrayFields, null, 4));
      } catch (err) {
        throw new Error(err);
      }
      return arrayFields;
    }, (err) => {
      throw new Error(err.message);
    });
  }

  /**
   * We do following things when initializing:
   * 1. get mappings from all indices, and save to "this.fieldTypes":
   * {
   *    <index1>: {
   *      <field1>: <type1>
   *      <field2>: <type2>
   *    }
   *    ...
   * }
   * 2. get configs from config index for array fields, save to "this.arrayFields":
   * {
   *    <index1>: [<field1>, <field2>],
   *    <index2>: [<field1>, <field2>],
   *    ...
   * }
   */
  async initialize() {
    this.fieldTypes = await this._getMappingsForAllIndices();
    this.arrayFields = await this._getArrayFieldsFromConfigIndex();
  }

  /**
   * Get ES fields' mapping type by es index name
   * Returns an object of field=>type mapping
   * @param {string} esIndex
   */
  getESFieldTypeMappingByIndex(esIndex) {
    return this.fieldTypes[esIndex];
  }

  /**
   * Get fields by esIndex
   * If esIndex is not set, return all fields grouped by index and types.
   * @param {string} esIndex
   */
  getESFields(esIndex) {
    const res = {};
    this.config.indices.forEach((cfg) => {
      res[cfg.index] = {
        index: cfg.index,
        type: cfg.type,
        fields: Object.entries(this.fieldTypes[cfg.index]).map(([key, value]) => {
          let r;
          if (value.type !== 'nested') {
            r = { name: key, type: value.type };
          } else {
            r = (0, _utils.buildNestedField)(key, value);
          }
          return r;
        })
      };
    });
    if (typeof esIndex === 'undefined') {
      return res;
    }
    return res[esIndex];
  }

  /**
   * Get es index by es type
   * Throw 400 error if there's no existing es type
   * @param {string} esType
   */
  getESIndexByType(esType) {
    const index = this.config.indices.find((i) => i.type === esType);
    if (index) return index.index;
    throw new _error.default(
      400,
      `Invalid es type: "${esType}"`
    );
  }

  /**
   * Get es indexConfig by es type
   * Throw 400 error if there's no existing es type
   * @param {string} esType
   */
  getESIndexConfigByType(esType) {
    const index = this.config.indices.find((i) => i.type === esType);
    if (index) return index;
    throw new _error.default(
      400,
      `Invalid es type: "${esType}"`
    );
  }

  /**
   * Get es index config by es index name
   * Throw 400 error if there's no existing es index of that name
   * @param {string} esIndexName
   */
  getESIndexConfigByName(esIndexName) {
    const indexConfig = this.config.indices.find((i) => i.index === esIndexName);
    if (indexConfig) return indexConfig;
    throw new _error.default(
      400,
      `Invalid es index name: "${esIndexName}"`
    );
  }

  /**
   * Get all es indices and their alias
   */
  getAllESIndices() {
    const indicesArray = this.config.indices.map((e) => e.index);
    if (this.config.configIndex) {
      indicesArray.push(this.config.configIndex);
    }
    return this.client.indices.getAlias({
      index: indicesArray
    }).then((resp) => {
      try {
        const indicesMetadata = resp.body;
        const indicesWithArrayFields = Object.keys(this.arrayFields);
        for (let i = 0; i < indicesWithArrayFields.length; i += 1) {
          const indexName = indicesWithArrayFields[i];
          if (!indicesMetadata[indexName]) {
            indicesMetadata[indexName] = {};
          }
          indicesMetadata[indexName].arrayFields = this.arrayFields[indexName];
        }
        return {
          statusCode: resp.statusCode,
          warnings: resp.warnings,
          indices: {
            ...indicesMetadata
          }
        };
      } catch (err) {
        throw new Error(err);
      }
    }, (err) => {
      throw new Error(err);
    });
  }

  /**
   * Check if the field is array
   */
  isArrayField(esIndex, field) {
    return this.arrayFields[esIndex] && this.arrayFields[esIndex].includes(field);
  }

  filterData(
  { esIndex, esType },
  {
    filter, fields, sort, offset = 0, size
  })
  {
    const queryBody = { from: offset };
    if (typeof filter !== 'undefined') {
      queryBody.query = (0, _filter.default)(this, esIndex, filter);
    }
    queryBody.sort = (0, _sort.default)(sort, this, esIndex);
    if (typeof size !== 'undefined') {
      queryBody.size = size;
    }
    if (fields !== undefined) {
      if (fields) {
        const esFields = (0, _utils.fromFieldsToSource)(fields);
        if (esFields.length > 0) queryBody._source = esFields;
      } else {
        queryBody._source = false;
      }
    }
    return this.query(esIndex, esType, queryBody);
  }

  async getCount(esIndex, esType, filter) {
    const result = await this.filterData(
      { esInstance: this, esIndex, esType },
      { filter, fields: false, size: 0 }
    );
    // Really shouldn't be getting this, but just in case
    if (result.hits.total.relation !== 'eq') {
      _logger.default.error(`The returned total count might be inaccurate. See hits.total object: ${result.hits.total}`);
    }
    return result.hits.total.value;
  }

  async getFieldCount(esIndex, esType, filter, field) {
    const queryBody = {
      size: 0,
      aggs: {
        [field]: {
          value_count: {
            field
          }
        }
      }
    };
    if (typeof filter !== 'undefined') {
      queryBody.query = (0, _filter.default)(this, esIndex, filter, field);
    }

    const result = await this.query(esIndex, esType, queryBody);
    return result.aggregations[field].value;
  }

  // eslint-disable-next-line camelcase
  async getCardinalityCount(esIndex, esType, filter, field, precision_threshold) {
    const queryBody = {
      size: 0,
      aggs: {
        cardinality_count: {
          cardinality: {
            field,
            precision_threshold // eslint-disable-line camelcase
          }
        }
      }
    };
    if (typeof filter !== 'undefined') {
      queryBody.query = (0, _filter.default)(this, esIndex, filter);
    }

    const result = await this.query(esIndex, esType, queryBody);
    return result.aggregations.cardinality_count.value;
  }

  async getData({
    esIndex, esType, fields, filter, sort, offset, size
  }) {
    if (typeof size !== 'undefined' && offset + size > _const.SCROLL_PAGE_SIZE) {
      throw new _graphql.GraphQLError(`Large graphql query forbidden for offset + size > ${_const.SCROLL_PAGE_SIZE},
      offset = ${offset} and size = ${size},
      please use download endpoint for large data queries instead.`, {
        extensions: {
          code: 'BAD_USER_INPUT'
        }
      });
    }
    const result = await this.filterData(
      { esInstance: this, esIndex, esType },
      {
        filter, fields, sort, offset, size
      }
    );
    const { hits } = result.hits;
    const hitsWithMatchedResults = hits.map((h) => {
      if (!('highlight' in h)) {
        // ES doesn't returns "highlight"
        return h._source;
      }
      // ES returns highlight, transfer them into "_matched" schema
      const matchedList = Object.keys(h.highlight).map((f) => {
        let field = f;
        if (f.endsWith(_config.default.analyzedTextFieldSuffix)) {
          // remove ".analyzed" suffix from field name
          field = f.substr(0, f.length - _config.default.analyzedTextFieldSuffix.length);
        }
        return {
          field,
          // just use ES highlights' format,
          // should be a list of string, with matched part emphasized with <
          highlights: h.highlight[f]
        };
      });
      return {
        ...h._source,
        _matched: matchedList
      };
    });
    return hitsWithMatchedResults;
  }

  downloadData({
    esIndex, esType, fields, filter, sort
  }) {
    const esFilterObj = filter ? (0, _filter.default)(this, esIndex, filter) : undefined;
    return this.scrollQuery(esIndex, esType, {
      filter: esFilterObj,
      fields,
      sort: (0, _sort.default)(sort, this, esIndex)
    });
  }

  numericAggregation({
    esIndex,
    esType,
    filter,
    field,
    rangeStart,
    rangeEnd,
    rangeStep,
    binCount,
    filterSelf,
    defaultAuthFilter,
    nestedAggFields,
    nestedPath
  }) {
    return esAggregator.numericAggregation(
      {
        esInstance: this,
        esIndex,
        esType
      },
      {
        esIndex,
        esType,
        filter,
        field,
        rangeStart,
        rangeEnd,
        rangeStep,
        binCount,
        filterSelf,
        defaultAuthFilter,
        nestedAggFields,
        nestedPath
      }
    );
  }

  textAggregation({
    esIndex,
    esType,
    filter,
    field,
    filterSelf,
    defaultAuthFilter,
    nestedAggFields,
    nestedPath,
    isNumericField
  }) {
    return esAggregator.textAggregation(
      {
        esInstance: this,
        esIndex,
        esType
      },
      {
        filter,
        field,
        filterSelf,
        defaultAuthFilter,
        nestedAggFields,
        nestedPath,
        isNumericField
      }
    );
  }
}

const es = new ES();var _default = exports.default =

es;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZWxhc3RpY3NlYXJjaCIsInJlcXVpcmUiLCJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9ncmFwaHFsIiwiX2NvbmZpZyIsIl9maWx0ZXIiLCJfc29ydCIsImVzQWdncmVnYXRvciIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX2xvZ2dlciIsIl9jb25zdCIsIl9lcnJvciIsIl91dGlscyIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsImUiLCJXZWFrTWFwIiwiciIsInQiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImhhcyIsImdldCIsIm4iLCJfX3Byb3RvX18iLCJhIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJ1IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaSIsInNldCIsIkVTIiwiY29uc3RydWN0b3IiLCJlc0NvbmZpZyIsImNvbmZpZyIsImNsaWVudCIsIkNsaWVudCIsIm5vZGUiLCJob3N0IiwicGluZyIsImVycm9yIiwibG9nIiwiaW5mbyIsImNvbm5lY3RlZCIsInF1ZXJ5IiwiZXNJbmRleCIsImVzVHlwZSIsInF1ZXJ5Qm9keSIsInZhbGlkYXRlZFF1ZXJ5Qm9keSIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwiaGlnaGxpZ2h0IiwicHJlX3RhZ3MiLCJtYXRjaGVkVGV4dEhpZ2hsaWdodFRhZ05hbWUiLCJwb3N0X3RhZ3MiLCJmaWVsZHMiLCJhbmFseXplZFRleHRGaWVsZFN1ZmZpeCIsInRyYWNrX3RvdGFsX2hpdHMiLCJzdGFydCIsIkRhdGUiLCJub3ciLCJzZWFyY2giLCJpbmRleCIsImJvZHkiLCJ0aGVuIiwicmVzcCIsImVyciIsIm1lc3NhZ2UiLCJFcnJvciIsImZpbmFsbHkiLCJlbmQiLCJkdXJhdGlvbkluTVMiLCJKU09OIiwic3RyaW5naWZ5Iiwic2Nyb2xsUXVlcnkiLCJmaWx0ZXIiLCJzb3J0IiwiQ29kZWRFcnJvciIsImFsbEVTRmllbGRzIiwiXyIsImZsYXR0ZW5EZWVwIiwiZ2V0RVNGaWVsZHMiLCJtYXAiLCJmIiwibmVzdGVkUHJvcHMiLCJwcm9jZXNzTmVzdGVkRmllbGROYW1lcyIsIm5hbWUiLCJmaWVsZHNOb3RCZWxvbmciLCJkaWZmZXJlbmNlIiwibGVuZ3RoIiwiam9pbiIsImRlYnVnIiwiY3VycmVudEJhdGNoIiwic2Nyb2xsSUQiLCJ0b3RhbERhdGEiLCJiYXRjaFNpemUiLCJzb3J0U3RyaW5nTGlzdCIsIml0ZW0iLCJ2YWx1ZXMiLCJyZXMiLCJzY3JvbGwiLCJzaXplIiwiU0NST0xMX1BBR0VfU0laRSIsIl9zb3VyY2UiLCJzY3JvbGxfaWQiLCJfc2Nyb2xsX2lkIiwiaGl0cyIsImNvbmNhdCIsImNsZWFyU2Nyb2xsIiwiX2dldEVTRmllbGRzVHlwZXMiLCJlcnJNc2ciLCJpbmRpY2VzIiwiZ2V0TWFwcGluZyIsImVzSW5kZXhBbGlhcyIsIm1hcHBpbmdzIiwicHJvcGVydGllcyIsIl9nZXRNYXBwaW5nc0ZvckFsbEluZGljZXMiLCJmaWVsZFR5cGVzIiwicHJvbWlzZUxpc3QiLCJjZmciLCJyZXN1bHRMaXN0IiwiUHJvbWlzZSIsImFsbCIsIl9nZXRBcnJheUZpZWxkc0Zyb21Db25maWdJbmRleCIsImNvbmZpZ0luZGV4IiwicmVzb2x2ZSIsImFycmF5RmllbGRzIiwiaWRzIiwiZG9jIiwiX2lkIiwiYXJyYXkiLCJmaWVsZCIsImZpZWxkQXJyIiwic3BsaXQiLCJwdXNoIiwiaW5pdGlhbGl6ZSIsImdldEVTRmllbGRUeXBlTWFwcGluZ0J5SW5kZXgiLCJ0eXBlIiwiZW50cmllcyIsInZhbHVlIiwiYnVpbGROZXN0ZWRGaWVsZCIsImdldEVTSW5kZXhCeVR5cGUiLCJmaW5kIiwiZ2V0RVNJbmRleENvbmZpZ0J5VHlwZSIsImdldEVTSW5kZXhDb25maWdCeU5hbWUiLCJlc0luZGV4TmFtZSIsImluZGV4Q29uZmlnIiwiZ2V0QWxsRVNJbmRpY2VzIiwiaW5kaWNlc0FycmF5IiwiZ2V0QWxpYXMiLCJpbmRpY2VzTWV0YWRhdGEiLCJpbmRpY2VzV2l0aEFycmF5RmllbGRzIiwiaW5kZXhOYW1lIiwic3RhdHVzQ29kZSIsIndhcm5pbmdzIiwiaXNBcnJheUZpZWxkIiwiaW5jbHVkZXMiLCJmaWx0ZXJEYXRhIiwib2Zmc2V0IiwiZnJvbSIsImdldEZpbHRlck9iaiIsImdldEVTU29ydEJvZHkiLCJ1bmRlZmluZWQiLCJlc0ZpZWxkcyIsImZyb21GaWVsZHNUb1NvdXJjZSIsImdldENvdW50IiwicmVzdWx0IiwiZXNJbnN0YW5jZSIsInRvdGFsIiwicmVsYXRpb24iLCJnZXRGaWVsZENvdW50IiwiYWdncyIsInZhbHVlX2NvdW50IiwiYWdncmVnYXRpb25zIiwiZ2V0Q2FyZGluYWxpdHlDb3VudCIsInByZWNpc2lvbl90aHJlc2hvbGQiLCJjYXJkaW5hbGl0eV9jb3VudCIsImNhcmRpbmFsaXR5IiwiZ2V0RGF0YSIsIkdyYXBoUUxFcnJvciIsImV4dGVuc2lvbnMiLCJjb2RlIiwiaGl0c1dpdGhNYXRjaGVkUmVzdWx0cyIsImgiLCJtYXRjaGVkTGlzdCIsImVuZHNXaXRoIiwic3Vic3RyIiwiaGlnaGxpZ2h0cyIsIl9tYXRjaGVkIiwiZG93bmxvYWREYXRhIiwiZXNGaWx0ZXJPYmoiLCJudW1lcmljQWdncmVnYXRpb24iLCJyYW5nZVN0YXJ0IiwicmFuZ2VFbmQiLCJyYW5nZVN0ZXAiLCJiaW5Db3VudCIsImZpbHRlclNlbGYiLCJkZWZhdWx0QXV0aEZpbHRlciIsIm5lc3RlZEFnZ0ZpZWxkcyIsIm5lc3RlZFBhdGgiLCJ0ZXh0QWdncmVnYXRpb24iLCJpc051bWVyaWNGaWVsZCIsImVzIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3NlcnZlci9lcy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDbGllbnQgfSBmcm9tICdAZWxhc3RpYy9lbGFzdGljc2VhcmNoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBHcmFwaFFMRXJyb3IgfSBmcm9tICdncmFwaHFsJztcbmltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uZmlnJztcbmltcG9ydCBnZXRGaWx0ZXJPYmogZnJvbSAnLi9maWx0ZXInO1xuaW1wb3J0IGdldEVTU29ydEJvZHkgZnJvbSAnLi9zb3J0JztcbmltcG9ydCAqIGFzIGVzQWdncmVnYXRvciBmcm9tICcuL2FnZ3MnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IHsgU0NST0xMX1BBR0VfU0laRSB9IGZyb20gJy4vY29uc3QnO1xuaW1wb3J0IENvZGVkRXJyb3IgZnJvbSAnLi4vdXRpbHMvZXJyb3InO1xuaW1wb3J0IHsgZnJvbUZpZWxkc1RvU291cmNlLCBidWlsZE5lc3RlZEZpZWxkLCBwcm9jZXNzTmVzdGVkRmllbGROYW1lcyB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcblxuY2xhc3MgRVMge1xuICBjb25zdHJ1Y3Rvcihlc0NvbmZpZyA9IGNvbmZpZy5lc0NvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gZXNDb25maWc7XG4gICAgdGhpcy5jbGllbnQgPSBuZXcgQ2xpZW50KHtcbiAgICAgIG5vZGU6IHRoaXMuY29uZmlnLmhvc3QsXG4gICAgICAvLyBsb2c6ICd0cmFjZSdcbiAgICB9KTtcbiAgICB0aGlzLmNsaWVudC5waW5nKHt9LCAoZXJyb3IpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBsb2cuZXJyb3IoYFtFU10gZWxhc3RpY3NlYXJjaCBjbHVzdGVyIGF0ICR7dGhpcy5jb25maWcuaG9zdH0gaXMgZG93biFgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5pbmZvKGBbRVNdIGNvbm5lY3RlZCB0byBlbGFzdGljc2VhcmNoIGF0ICR7dGhpcy5jb25maWcuaG9zdH0uYCk7XG4gICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBRdWVyeSBFUyBkYXRhIChzZWFyY2ggQVBJKSBieSBpbmRleCwgdHlwZSwgYW5kIHF1ZXJ5Qm9keVxuICAgKiBTZWUgaHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL2NsaWVudC9qYXZhc2NyaXB0LWFwaS9jdXJyZW50L2FwaS1yZWZlcmVuY2UuaHRtbCNfc2VhcmNoXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlc0luZGV4XG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlc1R5cGVcbiAgICogQHBhcmFtIHtvYmplY3R9IHF1ZXJ5Qm9keVxuICAgKi9cbiAgYXN5bmMgcXVlcnkoZXNJbmRleCwgZXNUeXBlLCBxdWVyeUJvZHkpIHtcbiAgICBjb25zdCB2YWxpZGF0ZWRRdWVyeUJvZHkgPSB7fTtcbiAgICBPYmplY3Qua2V5cyhxdWVyeUJvZHkpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBxdWVyeUJvZHlba2V5XSAhPT0gJ3VuZGVmaW5lZCcgJiYgcXVlcnlCb2R5W2tleV0gIT09IG51bGwpIHtcbiAgICAgICAgdmFsaWRhdGVkUXVlcnlCb2R5W2tleV0gPSBxdWVyeUJvZHlba2V5XTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB2YWxpZGF0ZWRRdWVyeUJvZHkuaGlnaGxpZ2h0ID0ge1xuICAgICAgcHJlX3RhZ3M6IFtcbiAgICAgICAgYDwke2NvbmZpZy5tYXRjaGVkVGV4dEhpZ2hsaWdodFRhZ05hbWV9PmAsXG4gICAgICBdLFxuICAgICAgcG9zdF90YWdzOiBbXG4gICAgICAgIGA8LyR7Y29uZmlnLm1hdGNoZWRUZXh0SGlnaGxpZ2h0VGFnTmFtZX0+YCxcbiAgICAgIF0sXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgW2AqJHtjb25maWcuYW5hbHl6ZWRUZXh0RmllbGRTdWZmaXh9YF06IHt9LFxuICAgICAgfSxcbiAgICB9O1xuICAgIHZhbGlkYXRlZFF1ZXJ5Qm9keS50cmFja190b3RhbF9oaXRzID0gdHJ1ZTtcblxuICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICByZXR1cm4gdGhpcy5jbGllbnQuc2VhcmNoKHtcbiAgICAgIGluZGV4OiBlc0luZGV4LFxuICAgICAgYm9keTogdmFsaWRhdGVkUXVlcnlCb2R5LFxuICAgIH0pLnRoZW4oKHJlc3ApID0+IHJlc3AuYm9keSwgKGVycikgPT4ge1xuICAgICAgbG9nLmVycm9yKGBbRVMucXVlcnldIGVycm9yIGR1cmluZyBxdWVyeWluZzogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnIubWVzc2FnZSk7XG4gICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICBjb25zdCBlbmQgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgZHVyYXRpb25Jbk1TID0gZW5kIC0gc3RhcnQ7XG5cbiAgICAgIGxvZy5pbmZvKGBbRVMucXVlcnldIER1cmF0aW9uSW5NUzoke2R1cmF0aW9uSW5NU30uIGluZGV4LCB0eXBlLCBxdWVyeSBib2R5OiBgLCBlc0luZGV4LCBlc1R5cGUsIEpTT04uc3RyaW5naWZ5KHZhbGlkYXRlZFF1ZXJ5Qm9keSkpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGVsYXN0aWMgc2VhcmNoIGRhdGEgdXNpbmcgc2Nyb2xsIEFQSVxuICAgKiBTZWUgaHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL3JlZmVyZW5jZS9jdXJyZW50L3NlYXJjaC1yZXF1ZXN0LXNjcm9sbC5odG1sXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlc0luZGV4XG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlc1R5cGVcbiAgICogQHBhcmFtIHtPYmplY3R9IGFyZ3VtZW50IC0gYXJnIG9iamVjdCBmb3IgZmlsdGVyLCBmaWVsZHMsIGFuZCBzb3J0XG4gICAqL1xuICBhc3luYyBzY3JvbGxRdWVyeShlc0luZGV4LCBlc1R5cGUsIHtcbiAgICBmaWx0ZXIsXG4gICAgZmllbGRzLFxuICAgIHNvcnQsXG4gIH0pIHtcbiAgICBpZiAoIWVzSW5kZXggfHwgIWVzVHlwZSkge1xuICAgICAgdGhyb3cgbmV3IENvZGVkRXJyb3IoXG4gICAgICAgIDQwMCxcbiAgICAgICAgJ0ludmFsaWQgZXMgaW5kZXggb3IgZXMgdHlwZSBuYW1lJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IGFsbEVTRmllbGRzID0gXy5mbGF0dGVuRGVlcCh0aGlzLmdldEVTRmllbGRzKGVzSW5kZXgpLmZpZWxkcy5tYXAoKGYpID0+IHtcbiAgICAgIGlmIChmLm5lc3RlZFByb3BzKSB7XG4gICAgICAgIHJldHVybiBwcm9jZXNzTmVzdGVkRmllbGROYW1lcyhmKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmLm5hbWU7XG4gICAgfSkpO1xuICAgIGNvbnN0IGZpZWxkc05vdEJlbG9uZyA9IF8uZGlmZmVyZW5jZShmaWVsZHMsIGFsbEVTRmllbGRzKTtcbiAgICBpZiAoZmllbGRzTm90QmVsb25nLmxlbmd0aCA+IDApIHtcbiAgICAgIHRocm93IG5ldyBDb2RlZEVycm9yKFxuICAgICAgICA0MDAsXG4gICAgICAgIGBJbnZhbGlkIGZpZWxkczogXCIke2ZpZWxkc05vdEJlbG9uZy5qb2luKCdcIiwgXCInKX1cImAsXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCB2YWxpZGF0ZWRRdWVyeUJvZHkgPSBmaWx0ZXIgPyB7IHF1ZXJ5OiBmaWx0ZXIgfSA6IHt9O1xuICAgIGxvZy5kZWJ1ZygnW0VTLnNjcm9sbFF1ZXJ5XSBzY3JvbGwgcXVlcnkgYm9keTogJywgSlNPTi5zdHJpbmdpZnkodmFsaWRhdGVkUXVlcnlCb2R5LCBudWxsLCA0KSk7XG5cbiAgICBsZXQgY3VycmVudEJhdGNoO1xuICAgIGxldCBzY3JvbGxJRDtcbiAgICBsZXQgdG90YWxEYXRhID0gW107XG4gICAgbGV0IGJhdGNoU2l6ZSA9IDA7XG5cbiAgICAvLyBUaGlzIGlzIHJlYWxseSByaWRpY3Vsb3VzIHRoYXQgRVMncyBKUyBsaWJyYXJ5IGhhcyBpdCwgYnV0IHdlIG5lZWQgdG9cbiAgICAvLyBjb252ZXJ0IGxpc3Qgb2Ygc29ydCBvYmogaW50byBjb21tYSBzZXBhcmF0ZWQgc3RyaW5ncyB0byBtYWtlIGl0IHdvcmtcbiAgICAvLyBzZWUgaHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL2NsaWVudC9qYXZhc2NyaXB0LWFwaS9jdXJyZW50L2FwaS1yZWZlcmVuY2UuaHRtbCNfc2VhcmNoXG4gICAgY29uc3Qgc29ydFN0cmluZ0xpc3QgPSBzb3J0ICYmIHNvcnQubWFwKChpdGVtKSA9PiBgJHtPYmplY3Qua2V5cyhpdGVtKVswXX06JHtPYmplY3QudmFsdWVzKGl0ZW0pWzBdfWApO1xuXG4gICAgd2hpbGUgKCFjdXJyZW50QmF0Y2ggfHwgYmF0Y2hTaXplID4gMCkge1xuICAgICAgaWYgKHR5cGVvZiBzY3JvbGxJRCA9PT0gJ3VuZGVmaW5lZCcpIHsgLy8gZmlyc3QgYmF0Y2hcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5jbGllbnQuc2VhcmNoKHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1hd2FpdC1pbi1sb29wXG4gICAgICAgICAgaW5kZXg6IGVzSW5kZXgsXG4gICAgICAgICAgYm9keTogdmFsaWRhdGVkUXVlcnlCb2R5LFxuICAgICAgICAgIHNjcm9sbDogJzFtJyxcbiAgICAgICAgICBzaXplOiBTQ1JPTExfUEFHRV9TSVpFLFxuICAgICAgICAgIF9zb3VyY2U6IGZpZWxkcyxcbiAgICAgICAgICBzb3J0OiBzb3J0U3RyaW5nTGlzdCxcbiAgICAgICAgfSkudGhlbigocmVzcCkgPT4gcmVzcCwgKGVycikgPT4ge1xuICAgICAgICAgIGxvZy5lcnJvcignW0VTLnF1ZXJ5XSBlcnJvciB3aGVuIHF1ZXJ5JywgZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnIubWVzc2FnZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjdXJyZW50QmF0Y2ggPSByZXMuYm9keTtcbiAgICAgICAgbG9nLmRlYnVnKCdbRVMgc2Nyb2xsUXVlcnldIGNyZWF0ZWQgc2Nyb2xsJyk7XG4gICAgICB9IGVsc2UgeyAvLyBmb2xsb3dpbmcgYmF0Y2hlc1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmNsaWVudC5zY3JvbGwoeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWF3YWl0LWluLWxvb3BcbiAgICAgICAgICBzY3JvbGxfaWQ6IHNjcm9sbElELFxuICAgICAgICAgIHNjcm9sbDogJzFtJyxcbiAgICAgICAgfSk7XG4gICAgICAgIGN1cnJlbnRCYXRjaCA9IHJlcy5ib2R5O1xuICAgICAgfVxuXG4gICAgICAvLyBtZXJnZSBmZXRjaGVkIGJhdGNoZXNcbiAgICAgIHNjcm9sbElEID0gY3VycmVudEJhdGNoLl9zY3JvbGxfaWQ7XG4gICAgICBiYXRjaFNpemUgPSBjdXJyZW50QmF0Y2guaGl0cy5oaXRzLmxlbmd0aDtcbiAgICAgIGxvZy5kZWJ1ZygnW0VTIHNjcm9sbFF1ZXJ5XSBnZXQgYmF0Y2ggc2l6ZSA9ICcsIGJhdGNoU2l6ZSwgJyBtZXJnaW5nLi4uJyk7XG5cbiAgICAgIC8vIFRPRE86IGNoYW5nZSBpdCB0byBzdHJlYW1pbmdcbiAgICAgIHRvdGFsRGF0YSA9IHRvdGFsRGF0YS5jb25jYXQoY3VycmVudEJhdGNoLmhpdHMuaGl0cy5tYXAoKGl0ZW0pID0+IGl0ZW0uX3NvdXJjZSkpO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZygnW0VTIHNjcm9sbFF1ZXJ5XSBlbmQgc2Nyb2xsaW5nJyk7XG4gICAgYXdhaXQgdGhpcy5jbGllbnQuY2xlYXJTY3JvbGwoe1xuICAgICAgc2Nyb2xsX2lkOiBzY3JvbGxJRCxcbiAgICB9KTtcbiAgICBsb2cuZGVidWcoJ1tFUyBzY3JvbGxRdWVyeV0gc2Nyb2xsIGNsZWFuZWQnKTtcbiAgICByZXR1cm4gdG90YWxEYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBtYXBwaW5nIGZyb20gRVMgd2l0aCBnaXZlbiBpbmRleCBhbmQgdHlwZS5cbiAgICogUmV0dXJuIGEgUHJvbWlzZSBvZiBhbiBPYmplY3Q6IHsgPGZpZWxkPjogPHR5cGU+IH1cbiAgICogSWYgZXJyb3IsIHByaW50IGVycm9yIHN0YWNrXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlc0luZGV4XG4gICAqL1xuICBhc3luYyBfZ2V0RVNGaWVsZHNUeXBlcyhlc0luZGV4KSB7XG4gICAgY29uc3QgZXJyTXNnID0gYFtFUy5pbml0aWFsaXplXSBlcnJvciBnZXR0aW5nIG1hcHBpbmcgZnJvbSBFUyBpbmRleCBcIiR7ZXNJbmRleH1cImA7XG4gICAgcmV0dXJuIHRoaXMuY2xpZW50LmluZGljZXMuZ2V0TWFwcGluZyh7XG4gICAgICBpbmRleDogZXNJbmRleCxcbiAgICB9KS50aGVuKChyZXNwKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBlc0luZGV4QWxpYXMgPSBPYmplY3Qua2V5cyhyZXNwLmJvZHkpWzBdO1xuICAgICAgICBsb2cuaW5mbygnTWFwcGluZyByZXNwb25zZSBmcm9tIEVTOiAnLCByZXNwLmJvZHlbZXNJbmRleEFsaWFzXSk7XG4gICAgICAgIHJldHVybiByZXNwLmJvZHlbZXNJbmRleEFsaWFzXS5tYXBwaW5ncy5wcm9wZXJ0aWVzO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtlcnJNc2d9OiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9LCAoZXJyKSA9PiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7ZXJyTXNnfTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIF9nZXRNYXBwaW5nc0ZvckFsbEluZGljZXMoKSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5pbmRpY2VzIHx8IHRoaXMuY29uZmlnLmluZGljZXMgPT09IDApIHtcbiAgICAgIGNvbnN0IGVyck1zZyA9ICdbRVMuaW5pdGlhbGl6ZV0gRXJyb3Igd2hlbiBpbml0aWFsaXppbmc6IGVtcHR5IFwiY29uZmlnLmluZGljZXNcIiBibG9jayc7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyTXNnKTtcbiAgICB9XG4gICAgY29uc3QgZmllbGRUeXBlcyA9IHt9O1xuICAgIGxvZy5pbmZvKCdbRVMuaW5pdGlhbGl6ZV0gZ2V0dGluZyBtYXBwaW5nIGZyb20gZWxhc3RpY3NlYXJjaC4uLicpO1xuICAgIGNvbnN0IHByb21pc2VMaXN0ID0gdGhpcy5jb25maWcuaW5kaWNlc1xuICAgICAgLm1hcCgoY2ZnKSA9PiB0aGlzLl9nZXRFU0ZpZWxkc1R5cGVzKGNmZy5pbmRleClcbiAgICAgICAgLnRoZW4oKHJlcykgPT4gKHsgaW5kZXg6IGNmZy5pbmRleCwgZmllbGRUeXBlczogcmVzIH0pKSk7XG4gICAgY29uc3QgcmVzdWx0TGlzdCA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VMaXN0KTtcbiAgICBsb2cuaW5mbygnW0VTLmluaXRpYWxpemVdIGdvdCBtYXBwaW5nIGZyb20gZWxhc3RpY3NlYXJjaCcpO1xuICAgIHJlc3VsdExpc3QuZm9yRWFjaCgocmVzKSA9PiB7XG4gICAgICBmaWVsZFR5cGVzW3Jlcy5pbmRleF0gPSByZXMuZmllbGRUeXBlcztcbiAgICB9KTtcbiAgICBsb2cuZGVidWcoJ1tFUy5pbml0aWFsaXplXScsIEpTT04uc3RyaW5naWZ5KGZpZWxkVHlwZXMsIG51bGwsIDQpKTtcbiAgICByZXR1cm4gZmllbGRUeXBlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWFkIGFycmF5IGNvbmZpZyBhbmQgY2hlY2sgaWYgdGhlcmUncyBhbnkgYXJyYXkgZmllbGRzIGZvciBlYWNoIGluZGV4LlxuICAgKiBBcnJheSBmaWVsZHMgYXJlIGdyb3VwZWQgYW5kIHN0b3JlZCBieSBpbmRleCBhcyBhIGRvYyBpbiBhcnJheSBjb25maWcsXG4gICAqIGFuZCB3ZSBzZXQgX2lkIGFzIGluZGV4IG5hbWUgZm9yIHRoaXMgZG9jLlxuICAgKi9cbiAgYXN5bmMgX2dldEFycmF5RmllbGRzRnJvbUNvbmZpZ0luZGV4KCkge1xuICAgIGlmICh0eXBlb2YgdGhpcy5jb25maWcuY29uZmlnSW5kZXggPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBsb2cuaW5mbygnW0VTLmluaXRpYWxpemVdIG5vIGFycmF5IGZpZWxkcyBmcm9tIGVzIGNvbmZpZyBpbmRleC4nKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe30pO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuZmllbGRUeXBlcykge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICBjb25zdCBhcnJheUZpZWxkcyA9IHt9O1xuICAgIGxvZy5pbmZvKGBbRVMuaW5pdGlhbGl6ZV0gZ2V0dGluZyBhcnJheSBmaWVsZHMgZnJvbSBlcyBjb25maWcgaW5kZXggXCIke3RoaXMuY29uZmlnLmNvbmZpZ0luZGV4fVwiLi4uYCk7XG4gICAgcmV0dXJuIHRoaXMuY2xpZW50LnNlYXJjaCh7XG4gICAgICBpbmRleDogdGhpcy5jb25maWcuY29uZmlnSW5kZXgsXG4gICAgICBib2R5OiB7XG4gICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgaWRzOiB7XG4gICAgICAgICAgICB2YWx1ZXM6IE9iamVjdC5rZXlzKHRoaXMuZmllbGRUeXBlcyksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSkudGhlbigocmVzcCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzcC5ib2R5LmhpdHMuaGl0cy5mb3JFYWNoKChkb2MpID0+IHtcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGRvYy5faWQ7XG4gICAgICAgICAgaWYgKCF0aGlzLmZpZWxkVHlwZXNbaW5kZXhdKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJNc2cgPSBgW0VTLmluaXRpYWxpemVdIHdyb25nIGFycmF5IGVudHJ5IGZyb20gY29uZmlnIGluZGV4OiBpbmRleCBcIiR7aW5kZXh9XCIgbm90IGZvdW5kLCBza2lwcGVkLmA7XG4gICAgICAgICAgICBsb2cuZXJyb3IoZXJyTXNnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgZmllbGRzID0gZG9jLl9zb3VyY2UuYXJyYXk7XG4gICAgICAgICAgZmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZEFyciA9IGZpZWxkLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICBpZiAoISh0aGlzLmZpZWxkVHlwZXNbaW5kZXhdW2ZpZWxkXVxuICAgICAgICAgICAgICB8fCAoXG4gICAgICAgICAgICAgICAgZmllbGRBcnIubGVuZ3RoID4gMVxuICAgICAgICAgICAgICAgICYmIF8uaGFzKFxuICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZFR5cGVzW2luZGV4XSxcbiAgICAgICAgICAgICAgICAgIGZpZWxkQXJyLmpvaW4oJy5wcm9wZXJ0aWVzLicpLFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICBjb25zdCBlcnJNc2cgPSBgW0VTLmluaXRpYWxpemVdIHdyb25nIGFycmF5IGVudHJ5IGZyb20gY29uZmlnOiBmaWVsZCBcIiR7ZmllbGR9XCIgbm90IGZvdW5kIGluIGluZGV4ICR7aW5kZXh9LCBza2lwcGVkLmA7XG4gICAgICAgICAgICAgIGxvZy5lcnJvcihlcnJNc2cpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWFycmF5RmllbGRzW2luZGV4XSkgYXJyYXlGaWVsZHNbaW5kZXhdID0gW107XG4gICAgICAgICAgICBhcnJheUZpZWxkc1tpbmRleF0ucHVzaChmaWVsZCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBsb2cuaW5mbygnW0VTLmluaXRpYWxpemVdIGdvdCBhcnJheSBmaWVsZHMgZnJvbSBlcyBjb25maWcgaW5kZXg6JywgSlNPTi5zdHJpbmdpZnkoYXJyYXlGaWVsZHMsIG51bGwsIDQpKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhcnJheUZpZWxkcztcbiAgICB9LCAoZXJyKSA9PiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyLm1lc3NhZ2UpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFdlIGRvIGZvbGxvd2luZyB0aGluZ3Mgd2hlbiBpbml0aWFsaXppbmc6XG4gICAqIDEuIGdldCBtYXBwaW5ncyBmcm9tIGFsbCBpbmRpY2VzLCBhbmQgc2F2ZSB0byBcInRoaXMuZmllbGRUeXBlc1wiOlxuICAgKiB7XG4gICAqICAgIDxpbmRleDE+OiB7XG4gICAqICAgICAgPGZpZWxkMT46IDx0eXBlMT5cbiAgICogICAgICA8ZmllbGQyPjogPHR5cGUyPlxuICAgKiAgICB9XG4gICAqICAgIC4uLlxuICAgKiB9XG4gICAqIDIuIGdldCBjb25maWdzIGZyb20gY29uZmlnIGluZGV4IGZvciBhcnJheSBmaWVsZHMsIHNhdmUgdG8gXCJ0aGlzLmFycmF5RmllbGRzXCI6XG4gICAqIHtcbiAgICogICAgPGluZGV4MT46IFs8ZmllbGQxPiwgPGZpZWxkMj5dLFxuICAgKiAgICA8aW5kZXgyPjogWzxmaWVsZDE+LCA8ZmllbGQyPl0sXG4gICAqICAgIC4uLlxuICAgKiB9XG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplKCkge1xuICAgIHRoaXMuZmllbGRUeXBlcyA9IGF3YWl0IHRoaXMuX2dldE1hcHBpbmdzRm9yQWxsSW5kaWNlcygpO1xuICAgIHRoaXMuYXJyYXlGaWVsZHMgPSBhd2FpdCB0aGlzLl9nZXRBcnJheUZpZWxkc0Zyb21Db25maWdJbmRleCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBFUyBmaWVsZHMnIG1hcHBpbmcgdHlwZSBieSBlcyBpbmRleCBuYW1lXG4gICAqIFJldHVybnMgYW4gb2JqZWN0IG9mIGZpZWxkPT50eXBlIG1hcHBpbmdcbiAgICogQHBhcmFtIHtzdHJpbmd9IGVzSW5kZXhcbiAgICovXG4gIGdldEVTRmllbGRUeXBlTWFwcGluZ0J5SW5kZXgoZXNJbmRleCkge1xuICAgIHJldHVybiB0aGlzLmZpZWxkVHlwZXNbZXNJbmRleF07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZpZWxkcyBieSBlc0luZGV4XG4gICAqIElmIGVzSW5kZXggaXMgbm90IHNldCwgcmV0dXJuIGFsbCBmaWVsZHMgZ3JvdXBlZCBieSBpbmRleCBhbmQgdHlwZXMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlc0luZGV4XG4gICAqL1xuICBnZXRFU0ZpZWxkcyhlc0luZGV4KSB7XG4gICAgY29uc3QgcmVzID0ge307XG4gICAgdGhpcy5jb25maWcuaW5kaWNlcy5mb3JFYWNoKChjZmcpID0+IHtcbiAgICAgIHJlc1tjZmcuaW5kZXhdID0ge1xuICAgICAgICBpbmRleDogY2ZnLmluZGV4LFxuICAgICAgICB0eXBlOiBjZmcudHlwZSxcbiAgICAgICAgZmllbGRzOiBPYmplY3QuZW50cmllcyh0aGlzLmZpZWxkVHlwZXNbY2ZnLmluZGV4XSkubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICBsZXQgcjtcbiAgICAgICAgICBpZiAodmFsdWUudHlwZSAhPT0gJ25lc3RlZCcpIHtcbiAgICAgICAgICAgIHIgPSB7IG5hbWU6IGtleSwgdHlwZTogdmFsdWUudHlwZSB9O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByID0gYnVpbGROZXN0ZWRGaWVsZChrZXksIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgIH0pLFxuICAgICAgfTtcbiAgICB9KTtcbiAgICBpZiAodHlwZW9mIGVzSW5kZXggPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH1cbiAgICByZXR1cm4gcmVzW2VzSW5kZXhdO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBlcyBpbmRleCBieSBlcyB0eXBlXG4gICAqIFRocm93IDQwMCBlcnJvciBpZiB0aGVyZSdzIG5vIGV4aXN0aW5nIGVzIHR5cGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGVzVHlwZVxuICAgKi9cbiAgZ2V0RVNJbmRleEJ5VHlwZShlc1R5cGUpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY29uZmlnLmluZGljZXMuZmluZCgoaSkgPT4gaS50eXBlID09PSBlc1R5cGUpO1xuICAgIGlmIChpbmRleCkgcmV0dXJuIGluZGV4LmluZGV4O1xuICAgIHRocm93IG5ldyBDb2RlZEVycm9yKFxuICAgICAgNDAwLFxuICAgICAgYEludmFsaWQgZXMgdHlwZTogXCIke2VzVHlwZX1cImAsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZXMgaW5kZXhDb25maWcgYnkgZXMgdHlwZVxuICAgKiBUaHJvdyA0MDAgZXJyb3IgaWYgdGhlcmUncyBubyBleGlzdGluZyBlcyB0eXBlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlc1R5cGVcbiAgICovXG4gIGdldEVTSW5kZXhDb25maWdCeVR5cGUoZXNUeXBlKSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmNvbmZpZy5pbmRpY2VzLmZpbmQoKGkpID0+IGkudHlwZSA9PT0gZXNUeXBlKTtcbiAgICBpZiAoaW5kZXgpIHJldHVybiBpbmRleDtcbiAgICB0aHJvdyBuZXcgQ29kZWRFcnJvcihcbiAgICAgIDQwMCxcbiAgICAgIGBJbnZhbGlkIGVzIHR5cGU6IFwiJHtlc1R5cGV9XCJgLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGVzIGluZGV4IGNvbmZpZyBieSBlcyBpbmRleCBuYW1lXG4gICAqIFRocm93IDQwMCBlcnJvciBpZiB0aGVyZSdzIG5vIGV4aXN0aW5nIGVzIGluZGV4IG9mIHRoYXQgbmFtZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXNJbmRleE5hbWVcbiAgICovXG4gIGdldEVTSW5kZXhDb25maWdCeU5hbWUoZXNJbmRleE5hbWUpIHtcbiAgICBjb25zdCBpbmRleENvbmZpZyA9IHRoaXMuY29uZmlnLmluZGljZXMuZmluZCgoaSkgPT4gaS5pbmRleCA9PT0gZXNJbmRleE5hbWUpO1xuICAgIGlmIChpbmRleENvbmZpZykgcmV0dXJuIGluZGV4Q29uZmlnO1xuICAgIHRocm93IG5ldyBDb2RlZEVycm9yKFxuICAgICAgNDAwLFxuICAgICAgYEludmFsaWQgZXMgaW5kZXggbmFtZTogXCIke2VzSW5kZXhOYW1lfVwiYCxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgZXMgaW5kaWNlcyBhbmQgdGhlaXIgYWxpYXNcbiAgICovXG4gIGdldEFsbEVTSW5kaWNlcygpIHtcbiAgICBjb25zdCBpbmRpY2VzQXJyYXkgPSB0aGlzLmNvbmZpZy5pbmRpY2VzLm1hcCgoZSkgPT4gZS5pbmRleCk7XG4gICAgaWYgKHRoaXMuY29uZmlnLmNvbmZpZ0luZGV4KSB7XG4gICAgICBpbmRpY2VzQXJyYXkucHVzaCh0aGlzLmNvbmZpZy5jb25maWdJbmRleCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNsaWVudC5pbmRpY2VzLmdldEFsaWFzKHtcbiAgICAgIGluZGV4OiBpbmRpY2VzQXJyYXksXG4gICAgfSkudGhlbigocmVzcCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW5kaWNlc01ldGFkYXRhID0gcmVzcC5ib2R5O1xuICAgICAgICBjb25zdCBpbmRpY2VzV2l0aEFycmF5RmllbGRzID0gT2JqZWN0LmtleXModGhpcy5hcnJheUZpZWxkcyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kaWNlc1dpdGhBcnJheUZpZWxkcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgIGNvbnN0IGluZGV4TmFtZSA9IGluZGljZXNXaXRoQXJyYXlGaWVsZHNbaV07XG4gICAgICAgICAgaWYgKCFpbmRpY2VzTWV0YWRhdGFbaW5kZXhOYW1lXSkge1xuICAgICAgICAgICAgaW5kaWNlc01ldGFkYXRhW2luZGV4TmFtZV0gPSB7fTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW5kaWNlc01ldGFkYXRhW2luZGV4TmFtZV0uYXJyYXlGaWVsZHMgPSB0aGlzLmFycmF5RmllbGRzW2luZGV4TmFtZV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0dXNDb2RlOiByZXNwLnN0YXR1c0NvZGUsXG4gICAgICAgICAgd2FybmluZ3M6IHJlc3Aud2FybmluZ3MsXG4gICAgICAgICAgaW5kaWNlczoge1xuICAgICAgICAgICAgLi4uaW5kaWNlc01ldGFkYXRhLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycik7XG4gICAgICB9XG4gICAgfSwgKGVycikgPT4ge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycik7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdGhlIGZpZWxkIGlzIGFycmF5XG4gICAqL1xuICBpc0FycmF5RmllbGQoZXNJbmRleCwgZmllbGQpIHtcbiAgICByZXR1cm4gKHRoaXMuYXJyYXlGaWVsZHNbZXNJbmRleF0gJiYgdGhpcy5hcnJheUZpZWxkc1tlc0luZGV4XS5pbmNsdWRlcyhmaWVsZCkpO1xuICB9XG5cbiAgZmlsdGVyRGF0YShcbiAgICB7IGVzSW5kZXgsIGVzVHlwZSB9LFxuICAgIHtcbiAgICAgIGZpbHRlciwgZmllbGRzLCBzb3J0LCBvZmZzZXQgPSAwLCBzaXplLFxuICAgIH0sXG4gICkge1xuICAgIGNvbnN0IHF1ZXJ5Qm9keSA9IHsgZnJvbTogb2Zmc2V0IH07XG4gICAgaWYgKHR5cGVvZiBmaWx0ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBxdWVyeUJvZHkucXVlcnkgPSBnZXRGaWx0ZXJPYmoodGhpcywgZXNJbmRleCwgZmlsdGVyKTtcbiAgICB9XG4gICAgcXVlcnlCb2R5LnNvcnQgPSBnZXRFU1NvcnRCb2R5KHNvcnQsIHRoaXMsIGVzSW5kZXgpO1xuICAgIGlmICh0eXBlb2Ygc2l6ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHF1ZXJ5Qm9keS5zaXplID0gc2l6ZTtcbiAgICB9XG4gICAgaWYgKGZpZWxkcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAoZmllbGRzKSB7XG4gICAgICAgIGNvbnN0IGVzRmllbGRzID0gZnJvbUZpZWxkc1RvU291cmNlKGZpZWxkcyk7XG4gICAgICAgIGlmIChlc0ZpZWxkcy5sZW5ndGggPiAwKSBxdWVyeUJvZHkuX3NvdXJjZSA9IGVzRmllbGRzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcXVlcnlCb2R5Ll9zb3VyY2UgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucXVlcnkoZXNJbmRleCwgZXNUeXBlLCBxdWVyeUJvZHkpO1xuICB9XG5cbiAgYXN5bmMgZ2V0Q291bnQoZXNJbmRleCwgZXNUeXBlLCBmaWx0ZXIpIHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmZpbHRlckRhdGEoXG4gICAgICB7IGVzSW5zdGFuY2U6IHRoaXMsIGVzSW5kZXgsIGVzVHlwZSB9LFxuICAgICAgeyBmaWx0ZXIsIGZpZWxkczogZmFsc2UsIHNpemU6IDAgfSxcbiAgICApO1xuICAgIC8vIFJlYWxseSBzaG91bGRuJ3QgYmUgZ2V0dGluZyB0aGlzLCBidXQganVzdCBpbiBjYXNlXG4gICAgaWYgKHJlc3VsdC5oaXRzLnRvdGFsLnJlbGF0aW9uICE9PSAnZXEnKSB7XG4gICAgICBsb2cuZXJyb3IoYFRoZSByZXR1cm5lZCB0b3RhbCBjb3VudCBtaWdodCBiZSBpbmFjY3VyYXRlLiBTZWUgaGl0cy50b3RhbCBvYmplY3Q6ICR7cmVzdWx0LmhpdHMudG90YWx9YCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQuaGl0cy50b3RhbC52YWx1ZTtcbiAgfVxuXG4gIGFzeW5jIGdldEZpZWxkQ291bnQoZXNJbmRleCwgZXNUeXBlLCBmaWx0ZXIsIGZpZWxkKSB7XG4gICAgY29uc3QgcXVlcnlCb2R5ID0ge1xuICAgICAgc2l6ZTogMCxcbiAgICAgIGFnZ3M6IHtcbiAgICAgICAgW2ZpZWxkXToge1xuICAgICAgICAgIHZhbHVlX2NvdW50OiB7XG4gICAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuICAgIGlmICh0eXBlb2YgZmlsdGVyICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgcXVlcnlCb2R5LnF1ZXJ5ID0gZ2V0RmlsdGVyT2JqKHRoaXMsIGVzSW5kZXgsIGZpbHRlciwgZmllbGQpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucXVlcnkoZXNJbmRleCwgZXNUeXBlLCBxdWVyeUJvZHkpO1xuICAgIHJldHVybiByZXN1bHQuYWdncmVnYXRpb25zW2ZpZWxkXS52YWx1ZTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2VcbiAgYXN5bmMgZ2V0Q2FyZGluYWxpdHlDb3VudChlc0luZGV4LCBlc1R5cGUsIGZpbHRlciwgZmllbGQsIHByZWNpc2lvbl90aHJlc2hvbGQpIHtcbiAgICBjb25zdCBxdWVyeUJvZHkgPSB7XG4gICAgICBzaXplOiAwLFxuICAgICAgYWdnczoge1xuICAgICAgICBjYXJkaW5hbGl0eV9jb3VudDoge1xuICAgICAgICAgIGNhcmRpbmFsaXR5OiB7XG4gICAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICAgIHByZWNpc2lvbl90aHJlc2hvbGQsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfTtcbiAgICBpZiAodHlwZW9mIGZpbHRlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHF1ZXJ5Qm9keS5xdWVyeSA9IGdldEZpbHRlck9iaih0aGlzLCBlc0luZGV4LCBmaWx0ZXIpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucXVlcnkoZXNJbmRleCwgZXNUeXBlLCBxdWVyeUJvZHkpO1xuICAgIHJldHVybiByZXN1bHQuYWdncmVnYXRpb25zLmNhcmRpbmFsaXR5X2NvdW50LnZhbHVlO1xuICB9XG5cbiAgYXN5bmMgZ2V0RGF0YSh7XG4gICAgZXNJbmRleCwgZXNUeXBlLCBmaWVsZHMsIGZpbHRlciwgc29ydCwgb2Zmc2V0LCBzaXplLFxuICB9KSB7XG4gICAgaWYgKHR5cGVvZiBzaXplICE9PSAndW5kZWZpbmVkJyAmJiBvZmZzZXQgKyBzaXplID4gU0NST0xMX1BBR0VfU0laRSkge1xuICAgICAgdGhyb3cgbmV3IEdyYXBoUUxFcnJvcihgTGFyZ2UgZ3JhcGhxbCBxdWVyeSBmb3JiaWRkZW4gZm9yIG9mZnNldCArIHNpemUgPiAke1NDUk9MTF9QQUdFX1NJWkV9LFxuICAgICAgb2Zmc2V0ID0gJHtvZmZzZXR9IGFuZCBzaXplID0gJHtzaXplfSxcbiAgICAgIHBsZWFzZSB1c2UgZG93bmxvYWQgZW5kcG9pbnQgZm9yIGxhcmdlIGRhdGEgcXVlcmllcyBpbnN0ZWFkLmAsIHtcbiAgICAgICAgZXh0ZW5zaW9uczoge1xuICAgICAgICAgIGNvZGU6ICdCQURfVVNFUl9JTlBVVCcsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5maWx0ZXJEYXRhKFxuICAgICAgeyBlc0luc3RhbmNlOiB0aGlzLCBlc0luZGV4LCBlc1R5cGUgfSxcbiAgICAgIHtcbiAgICAgICAgZmlsdGVyLCBmaWVsZHMsIHNvcnQsIG9mZnNldCwgc2l6ZSxcbiAgICAgIH0sXG4gICAgKTtcbiAgICBjb25zdCB7IGhpdHMgfSA9IHJlc3VsdC5oaXRzO1xuICAgIGNvbnN0IGhpdHNXaXRoTWF0Y2hlZFJlc3VsdHMgPSBoaXRzLm1hcCgoaCkgPT4ge1xuICAgICAgaWYgKCEoJ2hpZ2hsaWdodCcgaW4gaCkpIHtcbiAgICAgICAgLy8gRVMgZG9lc24ndCByZXR1cm5zIFwiaGlnaGxpZ2h0XCJcbiAgICAgICAgcmV0dXJuIGguX3NvdXJjZTtcbiAgICAgIH1cbiAgICAgIC8vIEVTIHJldHVybnMgaGlnaGxpZ2h0LCB0cmFuc2ZlciB0aGVtIGludG8gXCJfbWF0Y2hlZFwiIHNjaGVtYVxuICAgICAgY29uc3QgbWF0Y2hlZExpc3QgPSBPYmplY3Qua2V5cyhoLmhpZ2hsaWdodCkubWFwKChmKSA9PiB7XG4gICAgICAgIGxldCBmaWVsZCA9IGY7XG4gICAgICAgIGlmIChmLmVuZHNXaXRoKGNvbmZpZy5hbmFseXplZFRleHRGaWVsZFN1ZmZpeCkpIHtcbiAgICAgICAgICAvLyByZW1vdmUgXCIuYW5hbHl6ZWRcIiBzdWZmaXggZnJvbSBmaWVsZCBuYW1lXG4gICAgICAgICAgZmllbGQgPSBmLnN1YnN0cigwLCBmLmxlbmd0aCAtIGNvbmZpZy5hbmFseXplZFRleHRGaWVsZFN1ZmZpeC5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZmllbGQsXG4gICAgICAgICAgLy8ganVzdCB1c2UgRVMgaGlnaGxpZ2h0cycgZm9ybWF0LFxuICAgICAgICAgIC8vIHNob3VsZCBiZSBhIGxpc3Qgb2Ygc3RyaW5nLCB3aXRoIG1hdGNoZWQgcGFydCBlbXBoYXNpemVkIHdpdGggPFxuICAgICAgICAgIGhpZ2hsaWdodHM6IGguaGlnaGxpZ2h0W2ZdLFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5oLl9zb3VyY2UsXG4gICAgICAgIF9tYXRjaGVkOiBtYXRjaGVkTGlzdCxcbiAgICAgIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIGhpdHNXaXRoTWF0Y2hlZFJlc3VsdHM7XG4gIH1cblxuICBkb3dubG9hZERhdGEoe1xuICAgIGVzSW5kZXgsIGVzVHlwZSwgZmllbGRzLCBmaWx0ZXIsIHNvcnQsXG4gIH0pIHtcbiAgICBjb25zdCBlc0ZpbHRlck9iaiA9IGZpbHRlciA/IGdldEZpbHRlck9iaih0aGlzLCBlc0luZGV4LCBmaWx0ZXIpIDogdW5kZWZpbmVkO1xuICAgIHJldHVybiB0aGlzLnNjcm9sbFF1ZXJ5KGVzSW5kZXgsIGVzVHlwZSwge1xuICAgICAgZmlsdGVyOiBlc0ZpbHRlck9iaixcbiAgICAgIGZpZWxkcyxcbiAgICAgIHNvcnQ6IGdldEVTU29ydEJvZHkoc29ydCwgdGhpcywgZXNJbmRleCksXG4gICAgfSk7XG4gIH1cblxuICBudW1lcmljQWdncmVnYXRpb24oe1xuICAgIGVzSW5kZXgsXG4gICAgZXNUeXBlLFxuICAgIGZpbHRlcixcbiAgICBmaWVsZCxcbiAgICByYW5nZVN0YXJ0LFxuICAgIHJhbmdlRW5kLFxuICAgIHJhbmdlU3RlcCxcbiAgICBiaW5Db3VudCxcbiAgICBmaWx0ZXJTZWxmLFxuICAgIGRlZmF1bHRBdXRoRmlsdGVyLFxuICAgIG5lc3RlZEFnZ0ZpZWxkcyxcbiAgICBuZXN0ZWRQYXRoLFxuICB9KSB7XG4gICAgcmV0dXJuIGVzQWdncmVnYXRvci5udW1lcmljQWdncmVnYXRpb24oXG4gICAgICB7XG4gICAgICAgIGVzSW5zdGFuY2U6IHRoaXMsXG4gICAgICAgIGVzSW5kZXgsXG4gICAgICAgIGVzVHlwZSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGVzSW5kZXgsXG4gICAgICAgIGVzVHlwZSxcbiAgICAgICAgZmlsdGVyLFxuICAgICAgICBmaWVsZCxcbiAgICAgICAgcmFuZ2VTdGFydCxcbiAgICAgICAgcmFuZ2VFbmQsXG4gICAgICAgIHJhbmdlU3RlcCxcbiAgICAgICAgYmluQ291bnQsXG4gICAgICAgIGZpbHRlclNlbGYsXG4gICAgICAgIGRlZmF1bHRBdXRoRmlsdGVyLFxuICAgICAgICBuZXN0ZWRBZ2dGaWVsZHMsXG4gICAgICAgIG5lc3RlZFBhdGgsXG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICB0ZXh0QWdncmVnYXRpb24oe1xuICAgIGVzSW5kZXgsXG4gICAgZXNUeXBlLFxuICAgIGZpbHRlcixcbiAgICBmaWVsZCxcbiAgICBmaWx0ZXJTZWxmLFxuICAgIGRlZmF1bHRBdXRoRmlsdGVyLFxuICAgIG5lc3RlZEFnZ0ZpZWxkcyxcbiAgICBuZXN0ZWRQYXRoLFxuICAgIGlzTnVtZXJpY0ZpZWxkLFxuICB9KSB7XG4gICAgcmV0dXJuIGVzQWdncmVnYXRvci50ZXh0QWdncmVnYXRpb24oXG4gICAgICB7XG4gICAgICAgIGVzSW5zdGFuY2U6IHRoaXMsXG4gICAgICAgIGVzSW5kZXgsXG4gICAgICAgIGVzVHlwZSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGZpbHRlcixcbiAgICAgICAgZmllbGQsXG4gICAgICAgIGZpbHRlclNlbGYsXG4gICAgICAgIGRlZmF1bHRBdXRoRmlsdGVyLFxuICAgICAgICBuZXN0ZWRBZ2dGaWVsZHMsXG4gICAgICAgIG5lc3RlZFBhdGgsXG4gICAgICAgIGlzTnVtZXJpY0ZpZWxkLFxuICAgICAgfSxcbiAgICApO1xuICB9XG59XG5cbmNvbnN0IGVzID0gbmV3IEVTKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGVzO1xuIl0sIm1hcHBpbmdzIjoib0dBQUEsSUFBQUEsY0FBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsUUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBRixzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUssT0FBQSxHQUFBSCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQU0sS0FBQSxHQUFBSixzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQU8sWUFBQSxHQUFBQyx1QkFBQSxDQUFBUixPQUFBO0FBQ0EsSUFBQVMsT0FBQSxHQUFBUCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQVUsTUFBQSxHQUFBVixPQUFBO0FBQ0EsSUFBQVcsTUFBQSxHQUFBVCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQVksTUFBQSxHQUFBWixPQUFBLG1CQUErRixTQUFBYSx5QkFBQUMsQ0FBQSw0QkFBQUMsT0FBQSxrQkFBQUMsQ0FBQSxPQUFBRCxPQUFBLEdBQUFFLENBQUEsT0FBQUYsT0FBQSxXQUFBRix3QkFBQSxZQUFBQSxDQUFBQyxDQUFBLFVBQUFBLENBQUEsR0FBQUcsQ0FB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