"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.tierAccessResolver = exports.hideNumberResolver = void 0;var _lodash = _interopRequireDefault(require("lodash"));
var _assert = _interopRequireDefault(require("assert"));
var _graphql = require("graphql");
var _errors = require("@apollo/server/errors");
var _logger = _interopRequireDefault(require("../../logger"));
var _config = _interopRequireDefault(require("../../config"));
var _index = _interopRequireDefault(require("../../es/index"));
var _error = _interopRequireDefault(require("../../utils/error"));
var _utils = require("../../utils/utils");function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}

const ENCRYPT_COUNT = -1;

const resolverWithAccessibleFilterApplied = (
resolve,
root,
args,
context,
info,
authHelper,
filter) =>
{
  const appliedFilter = authHelper.applyAccessibleFilter(filter);
  const newArgs = {
    ...args,
    filter: appliedFilter,
    needEncryptAgg: false
  };
  return resolve(root, newArgs, context, info);
};

const resolverWithUnaccessibleFilterApplied = (
resolve,
root,
args,
context,
info,
authHelper,
filter) =>
{
  const appliedFilter = authHelper.applyUnaccessibleFilter(filter);
  const newArgs = {
    ...args,
    filter: appliedFilter,
    needEncryptAgg: true
  };
  return resolve(root, newArgs, context, info);
};

const tierAccessResolver = (
{
  isRawDataQuery,
  esType,
  esIndex
}) =>
async (resolve, root, args, context, info) => {
  try {
    // Assert that either this index is "regular" access or
    // that the index has no setting and site-wide config is "regular".
    const indexConfig = _index.default.getESIndexConfigByName(esIndex);
    const indexIsRegularAccess = indexConfig.tier_access_level === 'regular';
    const siteIsRegularAccess = _config.default.tierAccessLevel === 'regular';
    (0, _assert.default)(indexIsRegularAccess || siteIsRegularAccess, 'Tier access middleware layer only for "regular" tier access level');

    const { authHelper } = context;
    const { filter, filterSelf, accessibility } = args;

    const outOfScopeResourceList = await authHelper.getOutOfScopeResourceList(
      esIndex,
      esType,
      filter,
      filterSelf
    );
    // if requesting resources is within allowed resources, return result
    if (outOfScopeResourceList.length === 0) {
      // unless it's requesting for `unaccessible` data, just resolve this
      switch (accessibility) {
        case 'accessible':
          return resolve(root, { ...args, needEncryptAgg: false }, context, info);
        case 'unaccessible':
          return resolverWithUnaccessibleFilterApplied(
            resolve,
            root,
            args,
            context,
            info,
            authHelper,
            filter
          );
        default:
          return resolve(root, { ...args, needEncryptAgg: true }, context, info);
      }
    }
    // else, check if it's raw data query or aggs query
    if (isRawDataQuery) {// raw data query for out-of-scope resources are forbidden
      if (accessibility === 'accessible') {
        return resolverWithAccessibleFilterApplied(
          resolve,
          root,
          args,
          context,
          info,
          authHelper,
          filter
        );
      }
      _logger.default.info('[tierAccessResolver] requesting out-of-scope resources, return 401');
      _logger.default.info(`[tierAccessResolver] the following resources are out-of-scope: [${outOfScopeResourceList.join(', ')}]`);
      throw new _graphql.GraphQLError('You don\'t have access to all the data you are querying. Try using \'accessibility: accessible\' in your query', {
        extensions: {
          code: 401
        }
      });
    }

    /**
     * Here we have a bypass for `regular`-tier-access-leveled commons:
     * `accessibility` has 3 options: `all`, `accessible`, and `unaccessible`.
     * For `all`, behavior is the same as usual
     * For `accessible`, we will apply auth filter on top of filter argument
     * For `unaccessible`, we apply unaccessible filters on top of filter argument
     */
    const sensitiveRecordExclusionEnabled = !!_config.default.tierAccessSensitiveRecordExclusionField;
    if (accessibility === 'all') {
      if (sensitiveRecordExclusionEnabled) {
        // Sensitive study exclusion is enabled: For all of the projects user does
        // not have access to, hide the studies marked 'sensitive' from the aggregation.
        // (See doc/queries.md#Tiered_Access_sensitive_record_exclusion)
        const projectsUserHasAccessTo = authHelper.getAccessibleResources();
        const sensitiveStudiesFilter = {
          OR: [
          {
            IN: {
              [_config.default.esConfig.authFilterField]: projectsUserHasAccessTo
            }
          },
          {
            '!=': {
              [_config.default.tierAccessSensitiveRecordExclusionField]: 'true'
            }
          }]

        };
        return resolve(
          root,
          {
            ...args,
            filter: (0, _utils.addTwoFilters)(filter, sensitiveStudiesFilter),
            needEncryptAgg: true
          },
          context,
          info
        );
      }

      return resolve(
        root,
        {
          ...args,
          filter,
          needEncryptAgg: true
        },
        context,
        info
      );
    }
    if (accessibility === 'accessible') {
      // We do not need to apply sensitive studies filter here, because
      // user has access to all of these projects.
      _logger.default.debug('[tierAccessResolver] applying "accessible" to resolver');
      return resolverWithAccessibleFilterApplied(
        resolve,
        root,
        args,
        context,
        info,
        authHelper,
        filter
      );
    }
    // The below code executes if accessibility === 'unaccessible'.
    if (sensitiveRecordExclusionEnabled) {
      // Apply sensitive studies filter. Hide the studies marked 'sensitive' from
      // the aggregation.
      const sensitiveStudiesFilter = {
        '!=': {
          [_config.default.tierAccessSensitiveRecordExclusionField]: 'true'
        }
      };
      return resolverWithUnaccessibleFilterApplied(
        resolve,
        root,
        args,
        context,
        info,
        authHelper,
        (0, _utils.addTwoFilters)(filter, sensitiveStudiesFilter)
      );
    }
    return resolverWithUnaccessibleFilterApplied(
      resolve,
      root,
      args,
      context,
      info,
      authHelper,
      filter
    );
  } catch (err) {
    if (err instanceof _graphql.GraphQLError) {
      if (_errors.ApolloServerErrorCode[err.extensions.code]) {
        console.trace(err); // eslint-disable-line no-console
      }
    } else if (err instanceof _error.default) {
      if (err.code >= 500) {
        console.trace(err); // eslint-disable-line no-console
      }
    }
    throw err;
  }
};

/**
 * This resolver middleware is appended after aggregation resolvers,
 * it hide number that is less than allowed visible number for regular tier access
 * @param {bool} isGettingTotalCount
 */exports.tierAccessResolver = tierAccessResolver;
const hideNumberResolver = (isGettingTotalCount) => async (
resolve,
root,
args,
context,
info) =>
{
  // for aggregations, hide all counts that are greater than limited number
  const { needEncryptAgg } = root;
  const result = await resolve(root, args, context, info);
  _logger.default.debug('[hideNumberResolver] result: ', result);
  if (!needEncryptAgg) return result;

  const newRoot = root;
  newRoot.accessibility = 'unaccessible';
  const { authHelper } = context;
  newRoot.filter = authHelper.applyUnaccessibleFilter(newRoot.filter);
  const unaccessibleResult = await resolve(newRoot, args, context, info);
  _logger.default.debug('[hideNumberResolver] unaccessibleResult: ', unaccessibleResult);

  // if getting total count, only encrypt if unaccessibleResult is between (0, tierAccessLimit)
  if (isGettingTotalCount) {
    return unaccessibleResult > 0 &&
    unaccessibleResult < _config.default.tierAccessLimit ? ENCRYPT_COUNT : result;
  }

  const encryptedResult = result.map((item) => {
    // we don't encrypt whitelisted results or if result is not found in unaccessibleResult
    if ((0, _utils.isWhitelisted)(item.key) || !unaccessibleResult.some((e) => e.key === item.key)) {
      return item;
    }
    // we only encrypt if count from no-access item is small
    const unaccessibleResultItem = _lodash.default.find(unaccessibleResult, (e) => e.key === item.key);
    if (unaccessibleResultItem.count < _config.default.tierAccessLimit) {
      return {
        key: item.key,
        count: ENCRYPT_COUNT
      };
    }
    return item;
  });
  return encryptedResult;
};exports.hideNumberResolver = hideNumberResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfYXNzZXJ0IiwiX2dyYXBocWwiLCJfZXJyb3JzIiwiX2xvZ2dlciIsIl9jb25maWciLCJfaW5kZXgiLCJfZXJyb3IiLCJfdXRpbHMiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJFTkNSWVBUX0NPVU5UIiwicmVzb2x2ZXJXaXRoQWNjZXNzaWJsZUZpbHRlckFwcGxpZWQiLCJyZXNvbHZlIiwicm9vdCIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsImF1dGhIZWxwZXIiLCJmaWx0ZXIiLCJhcHBsaWVkRmlsdGVyIiwiYXBwbHlBY2Nlc3NpYmxlRmlsdGVyIiwibmV3QXJncyIsIm5lZWRFbmNyeXB0QWdnIiwicmVzb2x2ZXJXaXRoVW5hY2Nlc3NpYmxlRmlsdGVyQXBwbGllZCIsImFwcGx5VW5hY2Nlc3NpYmxlRmlsdGVyIiwidGllckFjY2Vzc1Jlc29sdmVyIiwiaXNSYXdEYXRhUXVlcnkiLCJlc1R5cGUiLCJlc0luZGV4IiwiaW5kZXhDb25maWciLCJlc0luc3RhbmNlIiwiZ2V0RVNJbmRleENvbmZpZ0J5TmFtZSIsImluZGV4SXNSZWd1bGFyQWNjZXNzIiwidGllcl9hY2Nlc3NfbGV2ZWwiLCJzaXRlSXNSZWd1bGFyQWNjZXNzIiwiY29uZmlnIiwidGllckFjY2Vzc0xldmVsIiwiYXNzZXJ0IiwiZmlsdGVyU2VsZiIsImFjY2Vzc2liaWxpdHkiLCJvdXRPZlNjb3BlUmVzb3VyY2VMaXN0IiwiZ2V0T3V0T2ZTY29wZVJlc291cmNlTGlzdCIsImxlbmd0aCIsImxvZyIsImpvaW4iLCJHcmFwaFFMRXJyb3IiLCJleHRlbnNpb25zIiwiY29kZSIsInNlbnNpdGl2ZVJlY29yZEV4Y2x1c2lvbkVuYWJsZWQiLCJ0aWVyQWNjZXNzU2Vuc2l0aXZlUmVjb3JkRXhjbHVzaW9uRmllbGQiLCJwcm9qZWN0c1VzZXJIYXNBY2Nlc3NUbyIsImdldEFjY2Vzc2libGVSZXNvdXJjZXMiLCJzZW5zaXRpdmVTdHVkaWVzRmlsdGVyIiwiT1IiLCJJTiIsImVzQ29uZmlnIiwiYXV0aEZpbHRlckZpZWxkIiwiYWRkVHdvRmlsdGVycyIsImRlYnVnIiwiZXJyIiwiQXBvbGxvU2VydmVyRXJyb3JDb2RlIiwiY29uc29sZSIsInRyYWNlIiwiQ29kZWRFcnJvciIsImV4cG9ydHMiLCJoaWRlTnVtYmVyUmVzb2x2ZXIiLCJpc0dldHRpbmdUb3RhbENvdW50IiwicmVzdWx0IiwibmV3Um9vdCIsInVuYWNjZXNzaWJsZVJlc3VsdCIsInRpZXJBY2Nlc3NMaW1pdCIsImVuY3J5cHRlZFJlc3VsdCIsIm1hcCIsIml0ZW0iLCJpc1doaXRlbGlzdGVkIiwia2V5Iiwic29tZSIsInVuYWNjZXNzaWJsZVJlc3VsdEl0ZW0iLCJfIiwiZmluZCIsImNvdW50Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3NlcnZlci9taWRkbGV3YXJlcy90aWVyQWNjZXNzTWlkZGxld2FyZS9yZXNvbHZlcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBhc3NlcnQgZnJvbSAnYXNzZXJ0JztcbmltcG9ydCB7IEdyYXBoUUxFcnJvciB9IGZyb20gJ2dyYXBocWwnO1xuaW1wb3J0IHsgQXBvbGxvU2VydmVyRXJyb3JDb2RlIH0gZnJvbSAnQGFwb2xsby9zZXJ2ZXIvZXJyb3JzJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vLi4vbG9nZ2VyJztcbmltcG9ydCBjb25maWcgZnJvbSAnLi4vLi4vY29uZmlnJztcbmltcG9ydCBlc0luc3RhbmNlIGZyb20gJy4uLy4uL2VzL2luZGV4JztcbmltcG9ydCBDb2RlZEVycm9yIGZyb20gJy4uLy4uL3V0aWxzL2Vycm9yJztcbmltcG9ydCB7IGlzV2hpdGVsaXN0ZWQsIGFkZFR3b0ZpbHRlcnMgfSBmcm9tICcuLi8uLi91dGlscy91dGlscyc7XG5cbmNvbnN0IEVOQ1JZUFRfQ09VTlQgPSAtMTtcblxuY29uc3QgcmVzb2x2ZXJXaXRoQWNjZXNzaWJsZUZpbHRlckFwcGxpZWQgPSAoXG4gIHJlc29sdmUsXG4gIHJvb3QsXG4gIGFyZ3MsXG4gIGNvbnRleHQsXG4gIGluZm8sXG4gIGF1dGhIZWxwZXIsXG4gIGZpbHRlcixcbikgPT4ge1xuICBjb25zdCBhcHBsaWVkRmlsdGVyID0gYXV0aEhlbHBlci5hcHBseUFjY2Vzc2libGVGaWx0ZXIoZmlsdGVyKTtcbiAgY29uc3QgbmV3QXJncyA9IHtcbiAgICAuLi5hcmdzLFxuICAgIGZpbHRlcjogYXBwbGllZEZpbHRlcixcbiAgICBuZWVkRW5jcnlwdEFnZzogZmFsc2UsXG4gIH07XG4gIHJldHVybiByZXNvbHZlKHJvb3QsIG5ld0FyZ3MsIGNvbnRleHQsIGluZm8pO1xufTtcblxuY29uc3QgcmVzb2x2ZXJXaXRoVW5hY2Nlc3NpYmxlRmlsdGVyQXBwbGllZCA9IChcbiAgcmVzb2x2ZSxcbiAgcm9vdCxcbiAgYXJncyxcbiAgY29udGV4dCxcbiAgaW5mbyxcbiAgYXV0aEhlbHBlcixcbiAgZmlsdGVyLFxuKSA9PiB7XG4gIGNvbnN0IGFwcGxpZWRGaWx0ZXIgPSBhdXRoSGVscGVyLmFwcGx5VW5hY2Nlc3NpYmxlRmlsdGVyKGZpbHRlcik7XG4gIGNvbnN0IG5ld0FyZ3MgPSB7XG4gICAgLi4uYXJncyxcbiAgICBmaWx0ZXI6IGFwcGxpZWRGaWx0ZXIsXG4gICAgbmVlZEVuY3J5cHRBZ2c6IHRydWUsXG4gIH07XG4gIHJldHVybiByZXNvbHZlKHJvb3QsIG5ld0FyZ3MsIGNvbnRleHQsIGluZm8pO1xufTtcblxuZXhwb3J0IGNvbnN0IHRpZXJBY2Nlc3NSZXNvbHZlciA9IChcbiAge1xuICAgIGlzUmF3RGF0YVF1ZXJ5LFxuICAgIGVzVHlwZSxcbiAgICBlc0luZGV4LFxuICB9LFxuKSA9PiBhc3luYyAocmVzb2x2ZSwgcm9vdCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICB0cnkge1xuICAgIC8vIEFzc2VydCB0aGF0IGVpdGhlciB0aGlzIGluZGV4IGlzIFwicmVndWxhclwiIGFjY2VzcyBvclxuICAgIC8vIHRoYXQgdGhlIGluZGV4IGhhcyBubyBzZXR0aW5nIGFuZCBzaXRlLXdpZGUgY29uZmlnIGlzIFwicmVndWxhclwiLlxuICAgIGNvbnN0IGluZGV4Q29uZmlnID0gZXNJbnN0YW5jZS5nZXRFU0luZGV4Q29uZmlnQnlOYW1lKGVzSW5kZXgpO1xuICAgIGNvbnN0IGluZGV4SXNSZWd1bGFyQWNjZXNzID0gaW5kZXhDb25maWcudGllcl9hY2Nlc3NfbGV2ZWwgPT09ICdyZWd1bGFyJztcbiAgICBjb25zdCBzaXRlSXNSZWd1bGFyQWNjZXNzID0gY29uZmlnLnRpZXJBY2Nlc3NMZXZlbCA9PT0gJ3JlZ3VsYXInO1xuICAgIGFzc2VydChpbmRleElzUmVndWxhckFjY2VzcyB8fCBzaXRlSXNSZWd1bGFyQWNjZXNzLCAnVGllciBhY2Nlc3MgbWlkZGxld2FyZSBsYXllciBvbmx5IGZvciBcInJlZ3VsYXJcIiB0aWVyIGFjY2VzcyBsZXZlbCcpO1xuXG4gICAgY29uc3QgeyBhdXRoSGVscGVyIH0gPSBjb250ZXh0O1xuICAgIGNvbnN0IHsgZmlsdGVyLCBmaWx0ZXJTZWxmLCBhY2Nlc3NpYmlsaXR5IH0gPSBhcmdzO1xuXG4gICAgY29uc3Qgb3V0T2ZTY29wZVJlc291cmNlTGlzdCA9IGF3YWl0IGF1dGhIZWxwZXIuZ2V0T3V0T2ZTY29wZVJlc291cmNlTGlzdChcbiAgICAgIGVzSW5kZXgsXG4gICAgICBlc1R5cGUsXG4gICAgICBmaWx0ZXIsXG4gICAgICBmaWx0ZXJTZWxmLFxuICAgICk7XG4gICAgLy8gaWYgcmVxdWVzdGluZyByZXNvdXJjZXMgaXMgd2l0aGluIGFsbG93ZWQgcmVzb3VyY2VzLCByZXR1cm4gcmVzdWx0XG4gICAgaWYgKG91dE9mU2NvcGVSZXNvdXJjZUxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyB1bmxlc3MgaXQncyByZXF1ZXN0aW5nIGZvciBgdW5hY2Nlc3NpYmxlYCBkYXRhLCBqdXN0IHJlc29sdmUgdGhpc1xuICAgICAgc3dpdGNoIChhY2Nlc3NpYmlsaXR5KSB7XG4gICAgICAgIGNhc2UgJ2FjY2Vzc2libGUnOlxuICAgICAgICAgIHJldHVybiByZXNvbHZlKHJvb3QsIHsgLi4uYXJncywgbmVlZEVuY3J5cHRBZ2c6IGZhbHNlIH0sIGNvbnRleHQsIGluZm8pO1xuICAgICAgICBjYXNlICd1bmFjY2Vzc2libGUnOlxuICAgICAgICAgIHJldHVybiByZXNvbHZlcldpdGhVbmFjY2Vzc2libGVGaWx0ZXJBcHBsaWVkKFxuICAgICAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgICAgIHJvb3QsXG4gICAgICAgICAgICBhcmdzLFxuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIGluZm8sXG4gICAgICAgICAgICBhdXRoSGVscGVyLFxuICAgICAgICAgICAgZmlsdGVyLFxuICAgICAgICAgICk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUocm9vdCwgeyAuLi5hcmdzLCBuZWVkRW5jcnlwdEFnZzogdHJ1ZSB9LCBjb250ZXh0LCBpbmZvKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gZWxzZSwgY2hlY2sgaWYgaXQncyByYXcgZGF0YSBxdWVyeSBvciBhZ2dzIHF1ZXJ5XG4gICAgaWYgKGlzUmF3RGF0YVF1ZXJ5KSB7IC8vIHJhdyBkYXRhIHF1ZXJ5IGZvciBvdXQtb2Ytc2NvcGUgcmVzb3VyY2VzIGFyZSBmb3JiaWRkZW5cbiAgICAgIGlmIChhY2Nlc3NpYmlsaXR5ID09PSAnYWNjZXNzaWJsZScpIHtcbiAgICAgICAgcmV0dXJuIHJlc29sdmVyV2l0aEFjY2Vzc2libGVGaWx0ZXJBcHBsaWVkKFxuICAgICAgICAgIHJlc29sdmUsXG4gICAgICAgICAgcm9vdCxcbiAgICAgICAgICBhcmdzLFxuICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgaW5mbyxcbiAgICAgICAgICBhdXRoSGVscGVyLFxuICAgICAgICAgIGZpbHRlcixcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGxvZy5pbmZvKCdbdGllckFjY2Vzc1Jlc29sdmVyXSByZXF1ZXN0aW5nIG91dC1vZi1zY29wZSByZXNvdXJjZXMsIHJldHVybiA0MDEnKTtcbiAgICAgIGxvZy5pbmZvKGBbdGllckFjY2Vzc1Jlc29sdmVyXSB0aGUgZm9sbG93aW5nIHJlc291cmNlcyBhcmUgb3V0LW9mLXNjb3BlOiBbJHtvdXRPZlNjb3BlUmVzb3VyY2VMaXN0LmpvaW4oJywgJyl9XWApO1xuICAgICAgdGhyb3cgbmV3IEdyYXBoUUxFcnJvcignWW91IGRvblxcJ3QgaGF2ZSBhY2Nlc3MgdG8gYWxsIHRoZSBkYXRhIHlvdSBhcmUgcXVlcnlpbmcuIFRyeSB1c2luZyBcXCdhY2Nlc3NpYmlsaXR5OiBhY2Nlc3NpYmxlXFwnIGluIHlvdXIgcXVlcnknLCB7XG4gICAgICAgIGV4dGVuc2lvbnM6IHtcbiAgICAgICAgICBjb2RlOiA0MDEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIZXJlIHdlIGhhdmUgYSBieXBhc3MgZm9yIGByZWd1bGFyYC10aWVyLWFjY2Vzcy1sZXZlbGVkIGNvbW1vbnM6XG4gICAgICogYGFjY2Vzc2liaWxpdHlgIGhhcyAzIG9wdGlvbnM6IGBhbGxgLCBgYWNjZXNzaWJsZWAsIGFuZCBgdW5hY2Nlc3NpYmxlYC5cbiAgICAgKiBGb3IgYGFsbGAsIGJlaGF2aW9yIGlzIHRoZSBzYW1lIGFzIHVzdWFsXG4gICAgICogRm9yIGBhY2Nlc3NpYmxlYCwgd2Ugd2lsbCBhcHBseSBhdXRoIGZpbHRlciBvbiB0b3Agb2YgZmlsdGVyIGFyZ3VtZW50XG4gICAgICogRm9yIGB1bmFjY2Vzc2libGVgLCB3ZSBhcHBseSB1bmFjY2Vzc2libGUgZmlsdGVycyBvbiB0b3Agb2YgZmlsdGVyIGFyZ3VtZW50XG4gICAgICovXG4gICAgY29uc3Qgc2Vuc2l0aXZlUmVjb3JkRXhjbHVzaW9uRW5hYmxlZCA9ICEhY29uZmlnLnRpZXJBY2Nlc3NTZW5zaXRpdmVSZWNvcmRFeGNsdXNpb25GaWVsZDtcbiAgICBpZiAoYWNjZXNzaWJpbGl0eSA9PT0gJ2FsbCcpIHtcbiAgICAgIGlmIChzZW5zaXRpdmVSZWNvcmRFeGNsdXNpb25FbmFibGVkKSB7XG4gICAgICAgIC8vIFNlbnNpdGl2ZSBzdHVkeSBleGNsdXNpb24gaXMgZW5hYmxlZDogRm9yIGFsbCBvZiB0aGUgcHJvamVjdHMgdXNlciBkb2VzXG4gICAgICAgIC8vIG5vdCBoYXZlIGFjY2VzcyB0bywgaGlkZSB0aGUgc3R1ZGllcyBtYXJrZWQgJ3NlbnNpdGl2ZScgZnJvbSB0aGUgYWdncmVnYXRpb24uXG4gICAgICAgIC8vIChTZWUgZG9jL3F1ZXJpZXMubWQjVGllcmVkX0FjY2Vzc19zZW5zaXRpdmVfcmVjb3JkX2V4Y2x1c2lvbilcbiAgICAgICAgY29uc3QgcHJvamVjdHNVc2VySGFzQWNjZXNzVG8gPSBhdXRoSGVscGVyLmdldEFjY2Vzc2libGVSZXNvdXJjZXMoKTtcbiAgICAgICAgY29uc3Qgc2Vuc2l0aXZlU3R1ZGllc0ZpbHRlciA9IHtcbiAgICAgICAgICBPUjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBJTjoge1xuICAgICAgICAgICAgICAgIFtjb25maWcuZXNDb25maWcuYXV0aEZpbHRlckZpZWxkXTogcHJvamVjdHNVc2VySGFzQWNjZXNzVG8sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAnIT0nOiB7XG4gICAgICAgICAgICAgICAgW2NvbmZpZy50aWVyQWNjZXNzU2Vuc2l0aXZlUmVjb3JkRXhjbHVzaW9uRmllbGRdOiAndHJ1ZScsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiByZXNvbHZlKFxuICAgICAgICAgIHJvb3QsXG4gICAgICAgICAge1xuICAgICAgICAgICAgLi4uYXJncyxcbiAgICAgICAgICAgIGZpbHRlcjogYWRkVHdvRmlsdGVycyhmaWx0ZXIsIHNlbnNpdGl2ZVN0dWRpZXNGaWx0ZXIpLFxuICAgICAgICAgICAgbmVlZEVuY3J5cHRBZ2c6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgIGluZm8sXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXNvbHZlKFxuICAgICAgICByb290LFxuICAgICAgICB7XG4gICAgICAgICAgLi4uYXJncyxcbiAgICAgICAgICBmaWx0ZXIsXG4gICAgICAgICAgbmVlZEVuY3J5cHRBZ2c6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIGluZm8sXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoYWNjZXNzaWJpbGl0eSA9PT0gJ2FjY2Vzc2libGUnKSB7XG4gICAgICAvLyBXZSBkbyBub3QgbmVlZCB0byBhcHBseSBzZW5zaXRpdmUgc3R1ZGllcyBmaWx0ZXIgaGVyZSwgYmVjYXVzZVxuICAgICAgLy8gdXNlciBoYXMgYWNjZXNzIHRvIGFsbCBvZiB0aGVzZSBwcm9qZWN0cy5cbiAgICAgIGxvZy5kZWJ1ZygnW3RpZXJBY2Nlc3NSZXNvbHZlcl0gYXBwbHlpbmcgXCJhY2Nlc3NpYmxlXCIgdG8gcmVzb2x2ZXInKTtcbiAgICAgIHJldHVybiByZXNvbHZlcldpdGhBY2Nlc3NpYmxlRmlsdGVyQXBwbGllZChcbiAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgcm9vdCxcbiAgICAgICAgYXJncyxcbiAgICAgICAgY29udGV4dCxcbiAgICAgICAgaW5mbyxcbiAgICAgICAgYXV0aEhlbHBlcixcbiAgICAgICAgZmlsdGVyLFxuICAgICAgKTtcbiAgICB9XG4gICAgLy8gVGhlIGJlbG93IGNvZGUgZXhlY3V0ZXMgaWYgYWNjZXNzaWJpbGl0eSA9PT0gJ3VuYWNjZXNzaWJsZScuXG4gICAgaWYgKHNlbnNpdGl2ZVJlY29yZEV4Y2x1c2lvbkVuYWJsZWQpIHtcbiAgICAgIC8vIEFwcGx5IHNlbnNpdGl2ZSBzdHVkaWVzIGZpbHRlci4gSGlkZSB0aGUgc3R1ZGllcyBtYXJrZWQgJ3NlbnNpdGl2ZScgZnJvbVxuICAgICAgLy8gdGhlIGFnZ3JlZ2F0aW9uLlxuICAgICAgY29uc3Qgc2Vuc2l0aXZlU3R1ZGllc0ZpbHRlciA9IHtcbiAgICAgICAgJyE9Jzoge1xuICAgICAgICAgIFtjb25maWcudGllckFjY2Vzc1NlbnNpdGl2ZVJlY29yZEV4Y2x1c2lvbkZpZWxkXTogJ3RydWUnLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIHJldHVybiByZXNvbHZlcldpdGhVbmFjY2Vzc2libGVGaWx0ZXJBcHBsaWVkKFxuICAgICAgICByZXNvbHZlLFxuICAgICAgICByb290LFxuICAgICAgICBhcmdzLFxuICAgICAgICBjb250ZXh0LFxuICAgICAgICBpbmZvLFxuICAgICAgICBhdXRoSGVscGVyLFxuICAgICAgICBhZGRUd29GaWx0ZXJzKGZpbHRlciwgc2Vuc2l0aXZlU3R1ZGllc0ZpbHRlciksXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gcmVzb2x2ZXJXaXRoVW5hY2Nlc3NpYmxlRmlsdGVyQXBwbGllZChcbiAgICAgIHJlc29sdmUsXG4gICAgICByb290LFxuICAgICAgYXJncyxcbiAgICAgIGNvbnRleHQsXG4gICAgICBpbmZvLFxuICAgICAgYXV0aEhlbHBlcixcbiAgICAgIGZpbHRlcixcbiAgICApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAoZXJyIGluc3RhbmNlb2YgR3JhcGhRTEVycm9yKSB7XG4gICAgICBpZiAoQXBvbGxvU2VydmVyRXJyb3JDb2RlW2Vyci5leHRlbnNpb25zLmNvZGVdKSB7XG4gICAgICAgIGNvbnNvbGUudHJhY2UoZXJyKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlXG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChlcnIgaW5zdGFuY2VvZiBDb2RlZEVycm9yKSB7XG4gICAgICBpZiAoZXJyLmNvZGUgPj0gNTAwKSB7XG4gICAgICAgIGNvbnNvbGUudHJhY2UoZXJyKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlXG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IGVycjtcbiAgfVxufTtcblxuLyoqXG4gKiBUaGlzIHJlc29sdmVyIG1pZGRsZXdhcmUgaXMgYXBwZW5kZWQgYWZ0ZXIgYWdncmVnYXRpb24gcmVzb2x2ZXJzLFxuICogaXQgaGlkZSBudW1iZXIgdGhhdCBpcyBsZXNzIHRoYW4gYWxsb3dlZCB2aXNpYmxlIG51bWJlciBmb3IgcmVndWxhciB0aWVyIGFjY2Vzc1xuICogQHBhcmFtIHtib29sfSBpc0dldHRpbmdUb3RhbENvdW50XG4gKi9cbmV4cG9ydCBjb25zdCBoaWRlTnVtYmVyUmVzb2x2ZXIgPSAoaXNHZXR0aW5nVG90YWxDb3VudCkgPT4gYXN5bmMgKFxuICByZXNvbHZlLFxuICByb290LFxuICBhcmdzLFxuICBjb250ZXh0LFxuICBpbmZvLFxuKSA9PiB7XG4gIC8vIGZvciBhZ2dyZWdhdGlvbnMsIGhpZGUgYWxsIGNvdW50cyB0aGF0IGFyZSBncmVhdGVyIHRoYW4gbGltaXRlZCBudW1iZXJcbiAgY29uc3QgeyBuZWVkRW5jcnlwdEFnZyB9ID0gcm9vdDtcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzb2x2ZShyb290LCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcbiAgbG9nLmRlYnVnKCdbaGlkZU51bWJlclJlc29sdmVyXSByZXN1bHQ6ICcsIHJlc3VsdCk7XG4gIGlmICghbmVlZEVuY3J5cHRBZ2cpIHJldHVybiByZXN1bHQ7XG5cbiAgY29uc3QgbmV3Um9vdCA9IHJvb3Q7XG4gIG5ld1Jvb3QuYWNjZXNzaWJpbGl0eSA9ICd1bmFjY2Vzc2libGUnO1xuICBjb25zdCB7IGF1dGhIZWxwZXIgfSA9IGNvbnRleHQ7XG4gIG5ld1Jvb3QuZmlsdGVyID0gYXV0aEhlbHBlci5hcHBseVVuYWNjZXNzaWJsZUZpbHRlcihuZXdSb290LmZpbHRlcik7XG4gIGNvbnN0IHVuYWNjZXNzaWJsZVJlc3VsdCA9IGF3YWl0IHJlc29sdmUobmV3Um9vdCwgYXJncywgY29udGV4dCwgaW5mbyk7XG4gIGxvZy5kZWJ1ZygnW2hpZGVOdW1iZXJSZXNvbHZlcl0gdW5hY2Nlc3NpYmxlUmVzdWx0OiAnLCB1bmFjY2Vzc2libGVSZXN1bHQpO1xuXG4gIC8vIGlmIGdldHRpbmcgdG90YWwgY291bnQsIG9ubHkgZW5jcnlwdCBpZiB1bmFjY2Vzc2libGVSZXN1bHQgaXMgYmV0d2VlbiAoMCwgdGllckFjY2Vzc0xpbWl0KVxuICBpZiAoaXNHZXR0aW5nVG90YWxDb3VudCkge1xuICAgIHJldHVybiAodW5hY2Nlc3NpYmxlUmVzdWx0ID4gMFxuICAgICAgJiYgdW5hY2Nlc3NpYmxlUmVzdWx0IDwgY29uZmlnLnRpZXJBY2Nlc3NMaW1pdCkgPyBFTkNSWVBUX0NPVU5UIDogcmVzdWx0O1xuICB9XG5cbiAgY29uc3QgZW5jcnlwdGVkUmVzdWx0ID0gcmVzdWx0Lm1hcCgoaXRlbSkgPT4ge1xuICAgIC8vIHdlIGRvbid0IGVuY3J5cHQgd2hpdGVsaXN0ZWQgcmVzdWx0cyBvciBpZiByZXN1bHQgaXMgbm90IGZvdW5kIGluIHVuYWNjZXNzaWJsZVJlc3VsdFxuICAgIGlmIChpc1doaXRlbGlzdGVkKGl0ZW0ua2V5KSB8fCAhKHVuYWNjZXNzaWJsZVJlc3VsdC5zb21lKChlKSA9PiBlLmtleSA9PT0gaXRlbS5rZXkpKSkge1xuICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfVxuICAgIC8vIHdlIG9ubHkgZW5jcnlwdCBpZiBjb3VudCBmcm9tIG5vLWFjY2VzcyBpdGVtIGlzIHNtYWxsXG4gICAgY29uc3QgdW5hY2Nlc3NpYmxlUmVzdWx0SXRlbSA9IF8uZmluZCh1bmFjY2Vzc2libGVSZXN1bHQsIChlKSA9PiBlLmtleSA9PT0gaXRlbS5rZXkpO1xuICAgIGlmICh1bmFjY2Vzc2libGVSZXN1bHRJdGVtLmNvdW50IDwgY29uZmlnLnRpZXJBY2Nlc3NMaW1pdCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2V5OiBpdGVtLmtleSxcbiAgICAgICAgY291bnQ6IEVOQ1JZUFRfQ09VTlQsXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gaXRlbTtcbiAgfSk7XG4gIHJldHVybiBlbmNyeXB0ZWRSZXN1bHQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiNElBQUEsSUFBQUEsT0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsUUFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsT0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUssT0FBQSxHQUFBTixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQU0sTUFBQSxHQUFBUCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQU8sTUFBQSxHQUFBUixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQVEsTUFBQSxHQUFBUixPQUFBLHNCQUFpRSxTQUFBRCx1QkFBQVUsQ0FBQSxVQUFBQSxDQUFBLElBQUFBLENBQUEsQ0FBQUMsVUFBQSxHQUFBRCxDQUFBLEtBQUFFLE9BQUEsRUFBQUYsQ0FBQTs7QUFFakUsTUFBTUcsYUFBYSxHQUFHLENBQUMsQ0FBQzs7QUFFeEIsTUFBTUMsbUNBQW1DLEdBQUdBO0FBQzFDQyxPQUFPO0FBQ1BDLElBQUk7QUFDSkMsSUFBSTtBQUNKQyxPQUFPO0FBQ1BDLElBQUk7QUFDSkMsVUFBVTtBQUNWQyxNQUFNO0FBQ0g7RUFDSCxNQUFNQyxhQUFhLEdBQUdGLFVBQVUsQ0FBQ0cscUJBQXFCLENBQUNGLE1BQU0sQ0FBQztFQUM5RCxNQUFNRyxPQUFPLEdBQUc7SUFDZCxHQUFHUCxJQUFJO0lBQ1BJLE1BQU0sRUFBRUMsYUFBYTtJQUNyQkcsY0FBYyxFQUFFO0VBQ2xCLENBQUM7RUFDRCxPQUFPVixPQUFPLENBQUNDLElBQUksRUFBRVEsT0FBTyxFQUFFTixPQUFPLEVBQUVDLElBQUksQ0FBQztBQUM5QyxDQUFDOztBQUVELE1BQU1PLHFDQUFxQyxHQUFHQTtBQUM1Q1gsT0FBTztBQUNQQyxJQUFJO0FBQ0pDLElBQUk7QUFDSkMsT0FBTztBQUNQQyxJQUFJO0FBQ0pDLFVBQVU7QUFDVkMsTUFBTTtBQUNIO0VBQ0gsTUFBTUMsYUFBYSxHQUFHRixVQUFVLENBQUNPLHVCQUF1QixDQUFDTixNQUFNLENBQUM7RUFDaEUsTUFBTUcsT0FBTyxHQUFHO0lBQ2QsR0FBR1AsSUFBSTtJQUNQSSxNQUFNLEVBQUVDLGFBQWE7SUFDckJHLGNBQWMsRUFBRTtFQUNsQixDQUFDO0VBQ0QsT0FBT1YsT0FBTyxDQUFDQyxJQUFJLEVBQUVRLE9BQU8sRUFBRU4sT0FBTyxFQUFFQyxJQUFJLENBQUM7QUFDOUMsQ0FBQzs7QUFFTSxNQUFNUyxrQkFBa0IsR0FBR0E7QUFDaEM7RUFDRUMsY0FBYztFQUNkQyxNQUFNO0VBQ05DO0FBQ0YsQ0FBQztBQUNFLE9BQU9oQixPQUFPLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxPQUFPLEVBQUVDLElBQUksS0FBSztFQUNqRCxJQUFJO0lBQ0Y7SUFDQTtJQUNBLE1BQU1hLFdBQVcsR0FBR0MsY0FBVSxDQUFDQyxzQkFBc0IsQ0FBQ0gsT0FBTyxDQUFDO0lBQzlELE1BQU1JLG9CQUFvQixHQUFHSCxXQUFXLENBQUNJLGlCQUFpQixLQUFLLFNBQVM7SUFDeEUsTUFBTUMsbUJBQW1CLEdBQUdDLGVBQU0sQ0FBQ0MsZUFBZSxLQUFLLFNBQVM7SUFDaEUsSUFBQUMsZUFBTSxFQUFDTCxvQkFBb0IsSUFBSUUsbUJBQW1CLEVBQUUsbUVBQW1FLENBQUM7O0lBRXhILE1BQU0sRUFBRWpCLFVBQVUsQ0FBQyxDQUFDLEdBQUdGLE9BQU87SUFDOUIsTUFBTSxFQUFFRyxNQUFNLEVBQUVvQixVQUFVLEVBQUVDLGFBQWEsQ0FBQyxDQUFDLEdBQUd6QixJQUFJOztJQUVsRCxNQUFNMEIsc0JBQXNCLEdBQUcsTUFBTXZCLFVBQVUsQ0FBQ3dCLHlCQUF5QjtNQUN2RWIsT0FBTztNQUNQRCxNQUFNO01BQ05ULE1BQU07TUFDTm9CO0lBQ0YsQ0FBQztJQUNEO0lBQ0EsSUFBSUUsc0JBQXNCLENBQUNFLE1BQU0sS0FBSyxDQUFDLEVBQUU7TUFDdkM7TUFDQSxRQUFRSCxhQUFhO1FBQ25CLEtBQUssWUFBWTtVQUNmLE9BQU8zQixPQUFPLENBQUNDLElBQUksRUFBRSxFQUFFLEdBQUdDLElBQUksRUFBRVEsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFDLEVBQUVQLE9BQU8sRUFBRUMsSUFBSSxDQUFDO1FBQ3pFLEtBQUssY0FBYztVQUNqQixPQUFPTyxxQ0FBcUM7WUFDMUNYLE9BQU87WUFDUEMsSUFBSTtZQUNKQyxJQUFJO1lBQ0pDLE9BQU87WUFDUEMsSUFBSTtZQUNKQyxVQUFVO1lBQ1ZDO1VBQ0YsQ0FBQztRQUNIO1VBQ0UsT0FBT04sT0FBTyxDQUFDQyxJQUFJLEVBQUUsRUFBRSxHQUFHQyxJQUFJLEVBQUVRLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFFUCxPQUFPLEVBQUVDLElBQUksQ0FBQztNQUMxRTtJQUNGO0lBQ0E7SUFDQSxJQUFJVSxjQUFjLEVBQUUsQ0FBRTtNQUNwQixJQUFJYSxhQUFhLEtBQUssWUFBWSxFQUFFO1FBQ2xDLE9BQU81QixtQ0FBbUM7VUFDeENDLE9BQU87VUFDUEMsSUFBSTtVQUNKQyxJQUFJO1VBQ0pDLE9BQU87VUFDUEMsSUFBSTtVQUNKQyxVQUFVO1VBQ1ZDO1FBQ0YsQ0FBQztNQUNIO01BQ0F5QixlQUFHLENBQUMzQixJQUFJLENBQUMsb0VBQW9FLENBQUM7TUFDOUUyQixlQUFHLENBQUMzQixJQUFJLENBQUMsbUVBQW1Fd0Isc0JBQXNCLENBQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO01BQ2pILE1BQU0sSUFBSUMscUJBQVksQ0FBQyxnSEFBZ0gsRUFBRTtRQUN2SUMsVUFBVSxFQUFFO1VBQ1ZDLElBQUksRUFBRTtRQUNSO01BQ0YsQ0FBQyxDQUFDO0lBQ0o7O0lBRUE7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7SUFDSSxNQUFNQywrQkFBK0IsR0FBRyxDQUFDLENBQUNiLGVBQU0sQ0FBQ2MsdUNBQXVDO0lBQ3hGLElBQUlWLGFBQWEsS0FBSyxLQUFLLEVBQUU7TUFDM0IsSUFBSVMsK0JBQStCLEVBQUU7UUFDbkM7UUFDQTtRQUNBO1FBQ0EsTUFBTUUsdUJBQXVCLEdBQUdqQyxVQUFVLENBQUNrQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ25FLE1BQU1DLHNCQUFzQixHQUFHO1VBQzdCQyxFQUFFLEVBQUU7VUFDRjtZQUNFQyxFQUFFLEVBQUU7Y0FDRixDQUFDbkIsZUFBTSxDQUFDb0IsUUFBUSxDQUFDQyxlQUFlLEdBQUdOO1lBQ3JDO1VBQ0YsQ0FBQztVQUNEO1lBQ0UsSUFBSSxFQUFFO2NBQ0osQ0FBQ2YsZUFBTSxDQUFDYyx1Q0FBdUMsR0FBRztZQUNwRDtVQUNGLENBQUM7O1FBRUwsQ0FBQztRQUNELE9BQU9yQyxPQUFPO1VBQ1pDLElBQUk7VUFDSjtZQUNFLEdBQUdDLElBQUk7WUFDUEksTUFBTSxFQUFFLElBQUF1QyxvQkFBYSxFQUFDdkMsTUFBTSxFQUFFa0Msc0JBQXNCLENBQUM7WUFDckQ5QixjQUFjLEVBQUU7VUFDbEIsQ0FBQztVQUNEUCxPQUFPO1VBQ1BDO1FBQ0YsQ0FBQztNQUNIOztNQUVBLE9BQU9KLE9BQU87UUFDWkMsSUFBSTtRQUNKO1VBQ0UsR0FBR0MsSUFBSTtVQUNQSSxNQUFNO1VBQ05JLGNBQWMsRUFBRTtRQUNsQixDQUFDO1FBQ0RQLE9BQU87UUFDUEM7TUFDRixDQUFDO0lBQ0g7SUFDQSxJQUFJdUIsYUFBYSxLQUFLLFlBQVksRUFBRTtNQUNsQztNQUNBO01BQ0FJLGVBQUcsQ0FBQ2UsS0FBSyxDQUFDLHdEQUF3RCxDQUFDO01BQ25FLE9BQU8vQyxtQ0FBbUM7UUFDeENDLE9BQU87UUFDUEMsSUFBSTtRQUNKQyxJQUFJO1FBQ0pDLE9BQU87UUFDUEMsSUFBSTtRQUNKQyxVQUFVO1FBQ1ZDO01BQ0YsQ0FBQztJQUNIO0lBQ0E7SUFDQSxJQUFJOEIsK0JBQStCLEVBQUU7TUFDbkM7TUFDQTtNQUNBLE1BQU1JLHNCQUFzQixHQUFHO1FBQzdCLElBQUksRUFBRTtVQUNKLENBQUNqQixlQUFNLENBQUNjLHVDQUF1QyxHQUFHO1FBQ3BEO01BQ0YsQ0FBQztNQUNELE9BQU8xQixxQ0FBcUM7UUFDMUNYLE9BQU87UUFDUEMsSUFBSTtRQUNKQyxJQUFJO1FBQ0pDLE9BQU87UUFDUEMsSUFBSTtRQUNKQyxVQUFVO1FBQ1YsSUFBQXdDLG9CQUFhLEVBQUN2QyxNQUFNLEVBQUVrQyxzQkFBc0I7TUFDOUMsQ0FBQztJQUNIO0lBQ0EsT0FBTzdCLHFDQUFxQztNQUMxQ1gsT0FBTztNQUNQQyxJQUFJO01BQ0pDLElBQUk7TUFDSkMsT0FBTztNQUNQQyxJQUFJO01BQ0pDLFVBQVU7TUFDVkM7SUFDRixDQUFDO0VBQ0gsQ0FBQyxDQUFDLE9BQU95QyxHQUFHLEVBQUU7SUFDWixJQUFJQSxHQUFHLFlBQVlkLHFCQUFZLEVBQUU7TUFDL0IsSUFBSWUsNkJBQXFCLENBQUNELEdBQUcsQ0FBQ2IsVUFBVSxDQUFDQyxJQUFJLENBQUMsRUFBRTtRQUM5Q2MsT0FBTyxDQUFDQyxLQUFLLENBQUNILEdBQUcsQ0FBQyxDQUFDLENBQUM7TUFDdEI7SUFDRixDQUFDLE1BQU0sSUFBSUEsR0FBRyxZQUFZSSxjQUFVLEVBQUU7TUFDcEMsSUFBSUosR0FBRyxDQUFDWixJQUFJLElBQUksR0FBRyxFQUFFO1FBQ25CYyxPQUFPLENBQUNDLEtBQUssQ0FBQ0gsR0FBRyxDQUFDLENBQUMsQ0FBQztNQUN0QjtJQUNGO0lBQ0EsTUFBTUEsR0FBRztFQUNYO0FBQ0YsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBSkFLLE9BQUEsQ0FBQXZDLGtCQUFBLEdBQUFBLGtCQUFBO0FBS08sTUFBTXdDLGtCQUFrQixHQUFHQSxDQUFDQyxtQkFBbUIsS0FBSztBQUN6RHRELE9BQU87QUFDUEMsSUFBSTtBQUNKQyxJQUFJO0FBQ0pDLE9BQU87QUFDUEMsSUFBSTtBQUNEO0VBQ0g7RUFDQSxNQUFNLEVBQUVNLGNBQWMsQ0FBQyxDQUFDLEdBQUdULElBQUk7RUFDL0IsTUFBTXNELE1BQU0sR0FBRyxNQUFNdkQsT0FBTyxDQUFDQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsT0FBTyxFQUFFQyxJQUFJLENBQUM7RUFDdkQyQixlQUFHLENBQUNlLEtBQUssQ0FBQywrQkFBK0IsRUFBRVMsTUFBTSxDQUFDO0VBQ2xELElBQUksQ0FBQzdDLGNBQWMsRUFBRSxPQUFPNkMsTUFBTTs7RUFFbEMsTUFBTUMsT0FBTyxHQUFHdkQsSUFBSTtFQUNwQnVELE9BQU8sQ0FBQzdCLGFBQWEsR0FBRyxjQUFjO0VBQ3RDLE1BQU0sRUFBRXRCLFVBQVUsQ0FBQyxDQUFDLEdBQUdGLE9BQU87RUFDOUJxRCxPQUFPLENBQUNsRCxNQUFNLEdBQUdELFVBQVUsQ0FBQ08sdUJBQXVCLENBQUM0QyxPQUFPLENBQUNsRCxNQUFNLENBQUM7RUFDbkUsTUFBTW1ELGtCQUFrQixHQUFHLE1BQU16RCxPQUFPLENBQUN3RCxPQUFPLEVBQUV0RCxJQUFJLEVBQUVDLE9BQU8sRUFBRUMsSUFBSSxDQUFDO0VBQ3RFMkIsZUFBRyxDQUFDZSxLQUFLLENBQUMsMkNBQTJDLEVBQUVXLGtCQUFrQixDQUFDOztFQUUxRTtFQUNBLElBQUlILG1CQUFtQixFQUFFO0lBQ3ZCLE9BQVFHLGtCQUFrQixHQUFHLENBQUM7SUFDekJBLGtCQUFrQixHQUFHbEMsZUFBTSxDQUFDbUMsZUFBZSxHQUFJNUQsYUFBYSxHQUFHeUQsTUFBTTtFQUM1RTs7RUFFQSxNQUFNSSxlQUFlLEdBQUdKLE1BQU0sQ0FBQ0ssR0FBRyxDQUFDLENBQUNDLElBQUksS0FBSztJQUMzQztJQUNBLElBQUksSUFBQUMsb0JBQWEsRUFBQ0QsSUFBSSxDQUFDRSxHQUFHLENBQUMsSUFBSSxDQUFFTixrQkFBa0IsQ0FBQ08sSUFBSSxDQUFDLENBQUNyRSxDQUFDLEtBQUtBLENBQUMsQ0FBQ29FLEdBQUcsS0FBS0YsSUFBSSxDQUFDRSxHQUFHLENBQUUsRUFBRTtNQUNwRixPQUFPRixJQUFJO0lBQ2I7SUFDQTtJQUNBLE1BQU1JLHNCQUFzQixHQUFHQyxlQUFDLENBQUNDLElBQUksQ0FBQ1Ysa0JBQWtCLEVBQUUsQ0FBQzlELENBQUMsS0FBS0EsQ0FBQyxDQUFDb0UsR0FBRyxLQUFLRixJQUFJLENBQUNFLEdBQUcsQ0FBQztJQUNwRixJQUFJRSxzQkFBc0IsQ0FBQ0csS0FBSyxHQUFHN0MsZUFBTSxDQUFDbUMsZUFBZSxFQUFFO01BQ3pELE9BQU87UUFDTEssR0FBRyxFQUFFRixJQUFJLENBQUNFLEdBQUc7UUFDYkssS0FBSyxFQUFFdEU7TUFDVCxDQUFDO0lBQ0g7SUFDQSxPQUFPK0QsSUFBSTtFQUNiLENBQUMsQ0FBQztFQUNGLE9BQU9GLGVBQWU7QUFDeEIsQ0FBQyxDQUFDUCxPQUFBLENBQUFDLGtCQUFBLEdBQUFBLGtCQUFBIiwiaWdub3JlTGlzdCI6W119