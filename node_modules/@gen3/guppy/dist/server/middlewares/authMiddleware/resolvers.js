"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _logger = _interopRequireDefault(require("../../logger"));
var _config = _interopRequireDefault(require("../../config"));function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}

const authMWResolver = async (resolve, root, args, context, info) => {
  const { authHelper } = context;

  // if mock arborist endpoint, just skip auth middleware
  if (!_config.default.internalLocalTest) {
    if (_config.default.arboristEndpoint === 'mock') {
      _logger.default.debug('[authMiddleware] using mock arborist endpoint, skip auth middleware');
      return resolve(root, args, context, info);
    }
  }

  // asking arborist for auth resource list, and add to filter args
  const parsedFilter = args.filter;
  const appliedFilter = await authHelper.applyAccessibleFilter(parsedFilter);
  const newArgs = {
    ...args,
    filter: appliedFilter
  };
  if (typeof newArgs.filter === 'undefined') {
    delete newArgs.filter;
  }
  return resolve(root, newArgs, context, info);
};var _default = exports.default =

authMWResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9nZ2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfY29uZmlnIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiYXV0aE1XUmVzb2x2ZXIiLCJyZXNvbHZlIiwicm9vdCIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsImF1dGhIZWxwZXIiLCJjb25maWciLCJpbnRlcm5hbExvY2FsVGVzdCIsImFyYm9yaXN0RW5kcG9pbnQiLCJsb2ciLCJkZWJ1ZyIsInBhcnNlZEZpbHRlciIsImZpbHRlciIsImFwcGxpZWRGaWx0ZXIiLCJhcHBseUFjY2Vzc2libGVGaWx0ZXIiLCJuZXdBcmdzIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3NlcnZlci9taWRkbGV3YXJlcy9hdXRoTWlkZGxld2FyZS9yZXNvbHZlcnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuLi8uLi9sb2dnZXInO1xuaW1wb3J0IGNvbmZpZyBmcm9tICcuLi8uLi9jb25maWcnO1xuXG5jb25zdCBhdXRoTVdSZXNvbHZlciA9IGFzeW5jIChyZXNvbHZlLCByb290LCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XG4gIGNvbnN0IHsgYXV0aEhlbHBlciB9ID0gY29udGV4dDtcblxuICAvLyBpZiBtb2NrIGFyYm9yaXN0IGVuZHBvaW50LCBqdXN0IHNraXAgYXV0aCBtaWRkbGV3YXJlXG4gIGlmICghY29uZmlnLmludGVybmFsTG9jYWxUZXN0KSB7XG4gICAgaWYgKGNvbmZpZy5hcmJvcmlzdEVuZHBvaW50ID09PSAnbW9jaycpIHtcbiAgICAgIGxvZy5kZWJ1ZygnW2F1dGhNaWRkbGV3YXJlXSB1c2luZyBtb2NrIGFyYm9yaXN0IGVuZHBvaW50LCBza2lwIGF1dGggbWlkZGxld2FyZScpO1xuICAgICAgcmV0dXJuIHJlc29sdmUocm9vdCwgYXJncywgY29udGV4dCwgaW5mbyk7XG4gICAgfVxuICB9XG5cbiAgLy8gYXNraW5nIGFyYm9yaXN0IGZvciBhdXRoIHJlc291cmNlIGxpc3QsIGFuZCBhZGQgdG8gZmlsdGVyIGFyZ3NcbiAgY29uc3QgcGFyc2VkRmlsdGVyID0gYXJncy5maWx0ZXI7XG4gIGNvbnN0IGFwcGxpZWRGaWx0ZXIgPSBhd2FpdCBhdXRoSGVscGVyLmFwcGx5QWNjZXNzaWJsZUZpbHRlcihwYXJzZWRGaWx0ZXIpO1xuICBjb25zdCBuZXdBcmdzID0ge1xuICAgIC4uLmFyZ3MsXG4gICAgZmlsdGVyOiBhcHBsaWVkRmlsdGVyLFxuICB9O1xuICBpZiAodHlwZW9mIG5ld0FyZ3MuZmlsdGVyID09PSAndW5kZWZpbmVkJykge1xuICAgIGRlbGV0ZSBuZXdBcmdzLmZpbHRlcjtcbiAgfVxuICByZXR1cm4gcmVzb2x2ZShyb290LCBuZXdBcmdzLCBjb250ZXh0LCBpbmZvKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGF1dGhNV1Jlc29sdmVyO1xuIl0sIm1hcHBpbmdzIjoib0dBQUEsSUFBQUEsT0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBLGtCQUFrQyxTQUFBRCx1QkFBQUcsQ0FBQSxVQUFBQSxDQUFBLElBQUFBLENBQUEsQ0FBQUMsVUFBQSxHQUFBRCxDQUFBLEtBQUFFLE9BQUEsRUFBQUYsQ0FBQTs7QUFFbEMsTUFBTUcsY0FBYyxHQUFHLE1BQUFBLENBQU9DLE9BQU8sRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLE9BQU8sRUFBRUMsSUFBSSxLQUFLO0VBQ25FLE1BQU0sRUFBRUMsVUFBVSxDQUFDLENBQUMsR0FBR0YsT0FBTzs7RUFFOUI7RUFDQSxJQUFJLENBQUNHLGVBQU0sQ0FBQ0MsaUJBQWlCLEVBQUU7SUFDN0IsSUFBSUQsZUFBTSxDQUFDRSxnQkFBZ0IsS0FBSyxNQUFNLEVBQUU7TUFDdENDLGVBQUcsQ0FBQ0MsS0FBSyxDQUFDLHFFQUFxRSxDQUFDO01BQ2hGLE9BQU9WLE9BQU8sQ0FBQ0MsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLE9BQU8sRUFBRUMsSUFBSSxDQUFDO0lBQzNDO0VBQ0Y7O0VBRUE7RUFDQSxNQUFNTyxZQUFZLEdBQUdULElBQUksQ0FBQ1UsTUFBTTtFQUNoQyxNQUFNQyxhQUFhLEdBQUcsTUFBTVIsVUFBVSxDQUFDUyxxQkFBcUIsQ0FBQ0gsWUFBWSxDQUFDO0VBQzFFLE1BQU1JLE9BQU8sR0FBRztJQUNkLEdBQUdiLElBQUk7SUFDUFUsTUFBTSxFQUFFQztFQUNWLENBQUM7RUFDRCxJQUFJLE9BQU9FLE9BQU8sQ0FBQ0gsTUFBTSxLQUFLLFdBQVcsRUFBRTtJQUN6QyxPQUFPRyxPQUFPLENBQUNILE1BQU07RUFDdkI7RUFDQSxPQUFPWixPQUFPLENBQUNDLElBQUksRUFBRWMsT0FBTyxFQUFFWixPQUFPLEVBQUVDLElBQUksQ0FBQztBQUM5QyxDQUFDLENBQUMsSUFBQVksUUFBQSxHQUFBQyxPQUFBLENBQUFuQixPQUFBOztBQUVhQyxjQUFjIiwiaWdub3JlTGlzdCI6W119